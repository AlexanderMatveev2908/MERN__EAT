import{r as f,j as s,u as ae,a as A,N as G,C as Xe,b as D,c as Q,d as U,e as R,F as $s,f as Ae,G as fn,T as Vs,I as wt,M as hn,g as B,h as bt,i as yn,k as jn,L as ps,l as qs,m as vt,n as Nt,o as St,p as Bs,B as Ct,q as Et,s as It,t as _n,v as wn,w as Ye,x as Pt,y as bn,K as Rt,S as At,U as Dt,z as Tt,A as vn,H as Nn,D as mt,E as Sn,J as Cn,O as Ft,P as Mt,Q as En,R as xs,V as In,W as Pn,X as De,Y as W,Z as Rn,_ as An,$ as Dn,a0 as kt,a1 as Tn,a2 as Fn,a3 as Mn,a4 as kn,a5 as Qs,a6 as Ln,a7 as On,a8 as ne,a9 as Un,aa as $n,ab as Lt,ac as Vn,ad as Ot,ae as re,af as qn,ag as Bn,ah as Qn,ai as gs,aj as Gn,ak as Ut,al as $t,am as pt,an as Vt,ao as qt,ap as zn,aq as Bt,ar as Yn,as as Hn,at as Kn,au as Qt,av as Wn,aw as Gt,ax as pe,ay as zt,az as Yt,aA as Ce,aB as Zn,aC as Xn,aD as Jn,aE as er,aF as sr,aG as xe,aH as Gs,aI as tr,aJ as ar,aK as nr,aL as Ht,aM as Kt,aN as rr,aO as Wt,aP as lr,aQ as ir,aR as cr,aS as Zt,aT as or,aU as dr,aV as ur,aW as mr,aX as pr,aY as xr,aZ as gr,a_ as fr,a$ as Xt,b0 as Jt,b1 as hr,b2 as yr,b3 as jr,b4 as _r,b5 as P,b6 as wr,b7 as br,b8 as vr}from"./vendor-react-DRST4msj.js";import{a as Nr,v as Sr,l as Cr,_ as Er,p as Ir,b as Pr,c as Rr}from"./vendor-CuJU41tZ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}})();const k=()=>{f.useEffect(()=>{setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},200)},[])},Ar=()=>(k(),s.jsx("div",{className:"w-full flex flex-col items-center gap-y-5",children:s.jsxs("div",{className:"w-full flex flex-col items-start gap-y-3",children:[s.jsx("span",{className:"txt__04 text-[whitesmoke]",children:"Order Comfortably From Home"}),s.jsx("span",{className:"txt__04 text-[whitesmoke]",children:"Or Manage Your Business From Anywhere"})]})})),Ie=(e,t)=>e&&t.test(e),ve=(e,t)=>e.includes(t??""),V=e=>!!Object.keys(e??{}).length,Dr=()=>{var i;const[e]=ae(),t=A(),a=e.get("type"),n=(i=t==null?void 0:t.state)==null?void 0:i.from;return{canStay:ve(["verify-account","recover-pwd","sentEmailUnsubscribe","change-email","change-pwd"],a??"")&&ve(["/auth/register","/auth/login","/newsletter/notice-unsubscribe-with-retry","/user/manage-account"],n),txt:a==="verify-account"?"to verify your account":a==="recover-pwd"?"with a link to recover your password":a==="change-email"?"to verify your new email":"with a link to unsubscribe from our newsletter"}},Tr=()=>{k();const{canStay:e,txt:t}=Dr();return e?s.jsxs("div",{className:"w-full flex flex-col items-center gap-y-14",children:[s.jsx("div",{className:"w-full flex justify-center",children:s.jsx("span",{className:"txt__04 leading-10 lg:leading-16",children:`We've sent you an email ${t}! If you don't see it, check your
          spam folder, it might be partying there`})}),s.jsx("div",{className:"w-full flex justify-center items-center",children:s.jsx(Xe,{className:"w-[200px] sm:w-[300px] h-[200px] sm:h-[300px] md:w-[400px] md:h-[400px] text-green-600"})})]}):s.jsx(G,{to:"/",replace:!0})},Je=({register:e,errors:t,field:a,custom:n})=>{var r,l;return s.jsxs("label",{className:"grid grid-cols-1 gap-y-3",children:[s.jsx("span",{className:"txt__01",children:a.label}),s.jsxs("div",{className:"w-full relative",children:[s.jsx("input",{type:a.type,className:"input__auth_field ",placeholder:`Your ${a.label}...`,...e(a.field,{required:`${a.label} is required`,validate:i=>!i||!a.reg.test(i)?a.msg:n?n==null?void 0:n(i):!0})}),s.jsx(a.svg,{className:"svg__auth_field"})]}),((r=t==null?void 0:t[a.field])==null?void 0:r.message)&&s.jsx("span",{className:"txt__00 text-red-600",children:(l=t==null?void 0:t[a.field])==null?void 0:l.message})]})},ea=f.createContext(null),fe=()=>{const e=f.useContext(ea);if(!e)throw new Error("useGlobal must be used within a GlobalProvider");return e},he=()=>fe().toastState,L=()=>fe().userState,Te=()=>fe().popupState,ue=()=>fe().formsState,zs=()=>fe().sideState,ye=()=>fe().cartState,Fr=()=>fe().noticeState,Fe=()=>fe().infoPopState,Mr=()=>fe().stripePromise,kr=!1,E=Nr.create({baseURL:"/api/v1",withCredentials:!0});E.interceptors.request.use(e=>{const t=sessionStorage.getItem("accessToken");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e));const Lr=async()=>{const{data:e}=await E.get("/user/info-basic");return e},Or=async()=>{const{data:e}=await E.get("/user/profile-details");return e},Ur=async e=>{const{data:t}=await E.patch("/user/profile-details",e);return t},$r=async e=>{const{data:t}=await E.post("/user/manage-account",{password:e});return t},Vr=async e=>{const{data:t}=await E.patch("/user/change-email",{...e});return t},qr=async e=>{const{data:t}=await E.post("/user/verify-new-email",e);return t},Br=async e=>{const{data:t}=await E.patch("/user/change-old-pwd",e);return t},Qr=async e=>{const{data:t}=await E.delete("/user/delete-account",{data:{manageAccountToken:e}});return t},Gr=async({type:e})=>{const{data:t}=await E.patch("/newsletter/toggle-logged",{type:e});return t},zr=async e=>{const{data:t}=await E.post("/newsletter/subscribe-non-logged",{email:e});return t},Yr=async e=>{const{data:t}=await E.patch("/newsletter/unsubscribe-via-link-logged",e);return t},Hr=async e=>{const{data:t}=await E.delete("/newsletter/unsubscribe-via-link-non-logged",{data:e});return t},Kr=async({email:e})=>{const{data:t}=await E.post("/newsletter/send-email-unsubscribe",{email:e});return t},Wr=async e=>{const{data:t}=await E.post("/my-restaurants",e);return t},Zr=async e=>{const{data:t}=await E.get(`/my-restaurants?${e}`);return t},Xr=async e=>{const{data:t}=await E.get(`/my-restaurants/info-restaurant/${e}`);return t},Jr=async({id:e,formData:t})=>{const{data:a}=await E.patch(`/my-restaurants/${e}`,t);return a},el=async e=>{const{data:t}=await E.delete(`/my-restaurants/${e}`);return t},sl=async e=>{const{data:t}=await E.get(`/my-restaurants/${e}`);return t},tl=async e=>{const{data:t}=await E.post("/auth/register",{...e});return t},al=async({email:e,password:t})=>{const{data:a}=await E.post("/auth/login",{email:e,password:t});return a},nl=async()=>{const{data:e}=await E.post("/auth/logout");return e},rl=async({email:e,type:t})=>{const{data:a}=await E.post(`/auth/send-email?type=${t}`,{email:e});return a},ll=async({...e})=>{const{data:t}=await E.post("/auth/verify-account",e);return t},il=async({...e})=>{const{data:t}=await E.post("/auth/verify-recover-pwd",e);return t},cl=async({...e})=>{const{data:t}=await E.patch("/auth/recover-pwd",e);return t},ol=async()=>{const{data:e}=await E.get("/auth/refresh");return e},M=async e=>{const{data:t}=await e();return t},Pe=e=>{setTimeout(()=>{e()},250)},dl=()=>M(()=>E.get("/my-cart")),ul=({dishId:e})=>M(()=>E.post(`/my-cart?dishId=${e}`)),ml=({dishId:e})=>M(()=>E.patch(`/my-cart?dishId=${e}`)),pl=({dishId:e})=>M(()=>E.patch(`/my-cart/del-item?dishId=${e}`)),xl=async()=>M(()=>E.delete("/my-cart/del-cart")),gl=({dishId:e,quantity:t})=>M(()=>E.patch(`/my-cart/put-input?dishId=${e}`,{quantity:t})),fl=({dishId:e,quantity:t})=>M(()=>E.patch(`/my-cart/put-int?dishId=${e}`,{quantity:t})),sa=({dishId:e})=>M(()=>E.get(`/my-cart/dish-info?dishId=${e}`)),hl=({dishId:e})=>M(()=>E.put(`/my-cart/switch-logged?dishId=${e}`)),yl=e=>M(()=>E.put("/my-cart/switch-storage",{cart:e})),jl=e=>M(()=>E.post("/my-cart/save-db-cart",{cart:e})),_l=()=>{const e=f.useRef(!1),t=D(),a=Q(),{logoutUser:n,isLogged:r,setUserLogged:l}=L(),{showToastMsg:i}=he();return{refreshTokenAndUI:f.useCallback(async()=>{if(!e.current){e.current=!0;try{const{accessToken:o}=await ol();l(o),a.cancelQueries(),a.clear()}catch{i(r?"SESSION EXPIRED":"UNAUTHORIZED","ERROR"),n(),t("/auth/login",{replace:!0})}}},[r,n,t,a,l,i])}},ta=["ACCESS TOKEN EXPIRED","ACCESS TOKEN INVALID","ACCESS TOKEN NOT PROVIDED"],je=()=>{const e=Q(),t=D(),{showToastMsg:a}=he(),{setUserLogged:n}=L(),{refreshTokenAndUI:r}=_l();return{handleErrAPI:f.useCallback(({err:i,push:c=!1,toast:o=!0})=>{var p,m,g;if(console.log(i),!i)return;const d=((m=(p=i==null?void 0:i.response)==null?void 0:p.data)==null?void 0:m.msg)||(i==null?void 0:i.message),u=(g=i==null?void 0:i.response)==null?void 0:g.status;[401,403,429].includes(u??400)?ta.includes(d)?r():(["USER DOES NOT EXIST","USER NOT VERIFIED"].includes(d)&&(n(!1),e.removeQueries({queryKey:["myCart"]})),t("/",{replace:!0}),a(d,"ERROR")):(c&&t("/",{replace:!0}),o&&a(d,"ERROR"))},[t,a,n,e,r])}},F=()=>({showToastMsg:he().showToastMsg,handleErrAPI:je().handleErrAPI}),wl=()=>{const{setUserLogged:e}=L(),{showToastMsg:t,handleErrAPI:a}=F(),n=D(),{register:r,handleSubmit:l,reset:i,formState:{errors:c},setFocus:o}=U({mode:"onSubmit"});f.useEffect(()=>{o("email")},[o]);const{mutate:d,isPending:u}=R({mutationFn:m=>al(m),onSuccess:m=>{i(),e(m.accessToken),t("User logged in successfully","SUCCESS"),n("/")},onError:m=>{var g,x,y;[401,403].includes(((g=m==null?void 0:m.response)==null?void 0:g.status)??400)?t(((y=(x=m==null?void 0:m.response)==null?void 0:x.data)==null?void 0:y.msg)??"","ERROR"):a({err:m})}}),p=l(m=>{d({...m})});return{register:r,errors:c,handleLoginUser:p,isPending:u}},us=/^[A-Z][a-zA-ZÀ-ÿ`'-_\d\s]*$/,aa=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_])[A-Za-zÀ-ÿ\d\W_]{8,}$/,Ys=/^(?![.-])(?!.*[.-]$)(?!.*\.\.)(?!.*@.*@)[A-Za-zÀ-ÿ0-9._%+-]+@[A-Za-zÀ-ÿ0-9]+\.[A-Za-z]{2,}$/,z=/^[a-f0-9]{24}$/,fs=/^[a-f0-9]{128}$/,bl=/^[a-f0-9]{16}$/,vl=/^[A-Za-zÀ-ÿ\d\s_]{2,50}$/,Nl=/^[A-Za-zÀ-ÿ\d\s-_]{2,50}$/,Sl=/^[A-Za-zÀ-ÿ\d\s-_]{2,50}$/,Cl=/^[A-Za-zÀ-ÿ0-9\s,._#-]{5,100}$/,El=/^\d{5}(-\d{4})?$/,na=/^\+?\d{1,4}[\s-]?\(?\d{2,3}\)?[\s-]?\d{3,4}[\s-]?\d{3,4}$/,Il=/^[A-Za-zÀ-ÿ0-9\s_\-!@#$%^&*()+=.,'"_]{2,50}$/,Pl=/^(https?:\/\/)?(www\.)?[A-Za-z0-9-]+(\.[A-Za-z]{2,})(\/[A-Za-z0-9-/]*)?(\?[A-Za-z0-9=&]*)?(#[A-Za-z0-9-_]*)?$/,Rs=/^([01]?[0-9]|2[0-3]):([0-5]?[0-9])$/,Oe=/^\d+(\.\d{1,2})?$/,ra=/^\d+$/,hs=/^[A-Za-zÀ-ÿ0-9\s,&!`'_-]*$/,As=/^\d*$/,la=/^\d+$/,Rl=/^[A-Za-zÀ-ÿ0-9\s_\-!@#$%^&*()+=.,'"_]{2,30}$/,He=/^\/search\/?$/,Re=/^\/search\/[a-f0-9]{24}$/,ys=/^\/my-dishes\/?$/,Hs=/^\/my-restaurants\/?$/,Ks=/^\/my-orders\/?$/,es=/^\/manage-orders\/?$/,Al=/^\/my-reviews\/add\/[a-f0-9]{24}?$/,Dl=/^\/my-reviews\/put\/[a-f0-9]{24}?$/,Tl=/^[\w\d\s.,'!?()"-]{4,100}$/,Fl=/^[\w\d\s.,'"\n\-!?()]{11,1000}$/,ia=(e,t)=>{var a,n;return!(!e[1]||["search","searchVals"].includes(e[0])&&(!((a=t.searchVals)!=null&&a.length)||!t.search||!hs.test(t.search)||["id","restaurantId"].includes((n=t.searchVals)==null?void 0:n[0])&&!z.test(t.search)))},Ml=e=>{var a;const t=new URLSearchParams;for(const n of Object.entries(e??{}))ia(n,e)&&(Array.isArray(n[1])?(a=n[1])!=null&&a.length&&t.append(n[0],n[1].join(",")):t.append(n[0],n[1]));return t},Ws=e=>{var a;const t=new URLSearchParams;if(!e)return t;for(const n of Object.entries(e??{}))if(n[1]&&ia(n,e))if(Array.isArray(n[1]))(a=n[1])!=null&&a.length&&t.append(n[0],n[1].join(","));else{if(["minPrice","maxPrice"].includes(n[0])&&(!Oe.test(n[1]??"")||e!=null&&e.minPrice&&(e!=null&&e.maxPrice)&&(n[0]==="minPrice"&&+n[1]>+e.maxPrice||n[0]==="maxPrice"&&+n[1]<e.minPrice))||["minQuantity","maxQuantity"].includes(n[0])&&(!As.test(n[1]??"")||e!=null&&e.minQuantity&&(e!=null&&e.maxQuantity)&&(n[0]==="minQuantity"&&+n[1]>+e.maxQuantity||n[0]==="maxQuantity"&&+n[1]<+e.minQuantity)))continue;t.append(n[0],n[1])}return t},kl=e=>{var a;const t=new URLSearchParams;for(const n of Object.entries(e))if(n[1]&&!(Array.isArray(n[1])&&!n[1].length)&&n[0]!=="searchVals")if(n[0]==="items")for(const r of n[1])r.search&&hs.test(r.search)&&((a=e.searchVals)!=null&&a.length)&&t.append(r.searchVal,r.search);else t.append(n[0],n[1]);return t},Ll=e=>{var t,a;return((t=e.firstName.slice(0,1))==null?void 0:t.toUpperCase())+((a=e.lastName.slice(0,1))==null?void 0:a.toUpperCase())},Ds=e=>{if(!ra.test(e+""))return"00:00";const t=Math.floor(e/60),a=e%60;return`${(t+"").padStart(2,"0")}:${(a+"").padStart(2,"0")}`},Ke=e=>{if(!e||!Rs.test(e))return 0;const[t,a]=e.split(":").map(n=>+n);return t*60+a},Ss=(e,t)=>(Ke(e)-Ke(t))/60,ms=e=>new Intl.DateTimeFormat("us",{day:"numeric",weekday:"short",hour:"numeric",minute:"numeric",hour12:!1}).format(new Date(e)),Zs=e=>{const t=Math.floor(e/60),a=Math.floor(e%60);return`${t?`${t} hour${t>1?"s":""}${a?" and ":""}`:""}${a?`${a} minute${a>1?"s":""}`:""}`},Ol=e=>{const t=new Date(e.timeConfirmed).getTime(),a=new Date(e.timeConfirmed).getTime()+e.restaurantId.delivery.estTimeDelivery*60*1e3,n=new Date().getTime(),r=a-t,i=(n-t)*100/r;return i>100?100:i},Ul=(e,t)=>e?"bg-green-600":t>=100?"bg-red-600":t>=75?"bg-orange-600":t>=50?"bg-yellow-600":"bg-blue-600",$l=(e,t)=>{const n=new Date(e).getTime()+t*60*1e3,r=new Date().getTime(),l=Math.floor((r-n)/1e3/60),i=Math.floor(l/60),c=l%60,o=Math.floor((r-n)/1e3)%60;return l<0?null:!i&&!c&&!o?"0 seconds":`${i?`${i} hour${i>1?"s":""}`:""} ${c?`${i?"and ":""}${c} minute${c>1?"s":""}`:""} ${o?`${c?"and ":""}${o} second${o>1?"s":""}`:""}`},ca=e=>{const t=new FormData,{images:a,categories:n,...r}=e;[...a].every(i=>i instanceof File)?[...a].forEach(i=>t.append("restaurantImages",i)):t.append("restaurantImages",JSON.stringify(a)),n.forEach(i=>t.append("categories",i));for(const i in r)r[i]&&(["openTime","closeTime"].includes(i)?t.append(i,`${Ke(r[i])+""}`):t.append(i,r[i]));return t},Vl=e=>{const t=new FormData;let a=0;for(;a<e.items.length;){const{images:n,...r}=e.items[a],l=[...n].every(i=>i instanceof File);n!=null&&n.length&&l?[...n].forEach(i=>{t.append(`images_${a}`,i)}):t.append(`images_${a}`,JSON.stringify(n));for(const i in r)t.append(`dishes[${a}][${i}]`,r[i]);a++}return t},ql=e=>{const t=new FormData,{images:a,...n}=e.items[0],r=[...a].every(l=>l instanceof File);a!=null&&a.length&&r?[...a].forEach(l=>{t.append("images",l)}):t.append("images",JSON.stringify(a));for(const l in n)t.append(l,n[l]);return t.append("restaurant",e.restaurant),t},oa=e=>{const t=new FormData,{images:a,...n}=e;a.length&&(a[0]instanceof File?[...a].forEach(i=>{t.append("images",i)}):t.append("images",JSON.stringify(a)));const r=Object.entries(n);let l=0;do{const i=r[l];i[1]&&t.append(i[0],typeof i[1]=="string"?i[1]:i[1]+""),l++}while(l<r.length);return{formData:t}},Z=({price:e,showStr:t=!1})=>{const a=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e??0);return!e&&t?"Free":a},js=e=>Z({price:e.quantity*e.price}),Bl=(e,t)=>Z({price:e+t}),Ql=e=>+((e.totPrice+e.delivery-e.discount)*100).toFixed(2),da=({location:e,el:t,type:a})=>t!=null&&t.from&&a?a===t.path.split("=")[1]?"active":"":e.pathname===t.path?"active":"",xt={full:$s,empty:Ae},Gl=e=>{const t=[];for(let a=0;a<5;a++)e>=a+1?t.push(xt.full):t.push(xt.empty);return t},j=()=>Sr(),zl=e=>[{label:"Update",path:`/my-restaurants/update/${e}`,icon:fn},{label:"Delete",path:"",icon:Vs},{label:"Add dish",path:"/my-dishes/add-dish",icon:wt},{label:"My dishes",path:"/my-dishes",icon:hn},{label:"My orders",path:"/my-orders",icon:B},{label:"My reviews",path:"/my-reviews",icon:bt}].map(t=>({...t,id:j()})),ua=["italian","chinese","japanese","mexican","indian","french","mediterranean","fast-food","vegetarian","vegan","seafood","steakhouse"],be=ua.map(e=>({field:e,id:j(),label:e==="fast-food"?"Fast-Food":e[0].toUpperCase()+e.slice(1)})),Yl=["0-19","20-39","40-59","60-79","80-100"],ma=Yl.map((e,t,a)=>({field:e,id:j(),label:`$${e}${t===a.length-1?"+":""}`})),Hl=["0-1","1.1-2","2.1-3","3.1-4","4.1-5"],pa=Hl.map(e=>({field:e,id:j(),label:`⭐ ${e}`})),$e=[{field:"asc",icon:yn},{field:"desc",icon:jn}],Kl=["name","country","state","city","id"],xa=Kl.map(e=>({field:e,id:j(),label:e[0].toUpperCase()+e.slice(1)})),Ue=["pending","confirmed","processing","shipped","delivered","cancelled"],Wl=[...Ue].map(e=>({field:e,id:j(),label:e[0].toUpperCase()+e.slice(1)})),Zl=["0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80-89","90-100"].map((e,t,a)=>({id:j(),label:t===a.length-1?"100+":e,field:e})),ga=[{field:"ordersStatus",label:"Orders status",subFields:Wl,icon:B},{field:"avgRatingRange",label:"Avg rating",subFields:[...pa],icon:Ae},{field:"categories",label:"Category",subFields:[...be],icon:ps},{field:"avgPriceRange",label:"Avg price dish",subFields:[...ma],icon:qs},{field:"avgQuantityRange",label:"Avg quantity dish",subFields:Zl,icon:B}].map(e=>({...e,id:j()})),fa=[{field:"createdAtSort",label:"Created at",icon:vt},{field:"updatedAtSort",label:"Updated at",icon:Nt},{field:"avgRatingSort",label:"Avg rating",icon:Ae},{field:"pendingOrdersSort",label:"Pending orders",icon:B},{field:"processingOrdersSort",label:"Processing orders",icon:B},{field:"shippedOrdersSort",label:"Shipped orders",icon:B},{field:"deliveredOrdersSort",label:"Delivered orders",icon:B},{field:"cancelledOrdersSort",label:"Cancelled orders",icon:B},{field:"ordersCountSort",label:"No. of orders",icon:St},{field:"reviewCountsSort",label:"No. of reviews",icon:bt},{field:"avgPriceSort",label:"Avg price dish",icon:qs},{field:"avgQuantitySort",label:"Avg quantity dish",icon:B},{field:"dishesCountSort",label:"No. of dishes",icon:Bs}],Xl=fa.map(e=>({...e,id:j(),subFields:[...$e.map(t=>({...t,id:j()}))]}));[...ga.map(e=>e.field),...fa.map(e=>e.field)];const Jl={search:"",searchVals:["name"],categories:[],ordersStatus:[],avgPriceRange:[],avgQuantityRange:[],avgRatingRange:[],avgRatingSort:[],reviewsCountSort:[],avgPriceSort:[],dishesCountSort:[],avgQuantitySort:[],ordersCountSort:[],createdAtSort:[],updatedAtSort:[],pendingOrdersSort:[],processingOrdersSort:[],shippedOrdersSort:[],deliveredOrdersSort:[],cancelledOrdersSort:[],page:"1"},ei=(...e)=>[{id:j(),label:"Location",vals:e[0],icon:Ct},{id:j(),label:"Contact",vals:e[1],icon:Et},{id:j(),label:"Categories",vals:e[2],icon:Bs}],si={id:j(),label:"Open Hours",icon:It},ti=(...e)=>[{id:j(),icon:_n,val:Ds(e[0])},{id:j(),icon:wn,val:Ds(e[1])}],ai={id:j(),label:"Delivery",icon:Ye},ni=(...e)=>[{id:j(),label:"Time",val:Zs(e[0])},{id:j(),label:"Price",val:e[1]},{id:j(),label:"Free meal",val:e[2]}],ri=(...e)=>[...Ue].map((t,a)=>{var n;return{id:j(),label:((n=t.at(0))==null?void 0:n.toUpperCase())+t.slice(1),val:e[a].count}}),li={id:j(),icon:St,label:"Orders"},ha={id:j(),label:"Reviews",icon:Pt},ii=(...e)=>Array.from({length:5}).map((t,a)=>({id:j(),val:e[a].count,stars:Gl(a+1)})),ya={id:j(),label:"Dishes",icon:bn},ci=(...e)=>[{label:"Avg price",field:Z({price:e[0]})},{label:"Avg quantity",field:e[1].toFixed(0)},{label:"Dishes count",field:e[2]}],ja=(...e)=>[{label:"Avg rating",field:+e[0].toFixed(2)},{label:"Reviews count",field:e[1]}].map(t=>({...t,id:j()})),oi=[{id:j(),label:"Forgot password",svg:Rt,type:"login"},{id:j(),label:"Verify account",svg:At,type:"register"}],di=[{id:j(),label:"Create account",svg:Dt,type:"login"},{id:j(),label:"Login in your account",svg:Tt,type:"register"}],_s=[{id:j(),field:"firstName",label:"First Name",reg:us,msg:"First Name should start with a capital letter and can only contains letters and apostrophe "},{id:j(),field:"lastName",label:"Last Name",reg:us,msg:"Last Name should start with a capital letter and can only contains letters and apostrophe"}],ss=[{id:j(),field:"country",label:"Country",reg:vl,msg:"Country can only contains letters, and must be at least 2 chars"},{id:j(),field:"state",label:"State",reg:Nl,msg:"State can only contains can only contains letters and hyphens if needed, and must be at least 2 chars "},{id:j(),field:"city",label:"City",reg:Sl,msg:"City can only contains letters and hyphens if needed, and must be at least 2 chars"}],ts=[{id:j(),field:"street",label:"Street",reg:Cl,msg:"Street can only contains letters, numbers, and spaces, and must be at least 5 chars"},{id:j(),field:"zipCode",label:"Zip Code",reg:El,msg:"Zip Code can only contains numbers, at least 5 up to 10 digits"},{id:j(),field:"phone",label:"Phone",reg:na,msg:"Phone can only contains numbers,and including country prefix up to 15 digits "}],ui=[..._s,...ss,...ts],mi=[[..._s],[...ss],[...ts]],Xs=3,pi=/(?=.*[A-Z])/,xi=/[a-z]+/,gi=/(?=.*\d)/,fi=/(?=.*[\W_])/,hi=[{id:j(),msg:"Uppercase letters",reg:pi,label:"ABC..."},{id:j(),msg:"Lowercase letters",reg:xi,label:"abc..."},{id:j(),msg:"Numbers",reg:gi,label:"123..."},{id:j(),msg:"Symbols",reg:fi,label:"!@#$..."}],yi="/assets/hero-C0USUQ76.avif",ji="/assets/hero_2-My4mLI9C.avif",_i="/assets/hero_5-DfOWyyJE.avif",wi="/assets/hero_6-B4eY8YHC.avif",bi=[{id:j(),img:yi},{id:j(),img:ji},{id:j(),img:_i},{id:j(),img:wi}],vi=[{id:j(),label:"About",path:"/"},{id:j(),label:"Privacy Policy",path:"/"},{id:j(),label:"Terms & Conditions",path:"/"},{id:j(),label:"Contact",path:"/"}],Ni=[{id:j(),label:"Source Code",svg:vn,url:"https://github.com/AlexanderMatveev2908/FOOD_APP"},{id:j(),label:"Hotels App",svg:Nn,url:"https://mern-booking-app-0w8v.onrender.com/"}],Ve={id:j(),field:"email",label:"Email",reg:Ys,msg:"Email must follow this pattern /^(?![.-])(?!.*[.-]$)(?!.*\\.\\.)(?!.*@.*@)[A-Za-z0-9._%+-]+@[A-Za-z0-9]+\\.[A-Za-z]{2,}$/ 🧐",svg:Sn,type:"email"},Si={...Ve,label:"New Email",field:"newEmail"},Ci=[{id:j(),field:"firstName",label:"First Name",reg:us,msg:"A First Name must start with uppercase letter, and can include only letters and apostrophe.",svg:mt,type:"text"},{id:j(),field:"lastName",label:"Last Name",reg:us,msg:"A Last Name must start with uppercase letter, and can include only letters and apostrophe",svg:mt,type:"text"}],Js={id:j(),field:"password",label:"Password",place:"Your password",msg:"Invalid password",reg:/.*/},et={...Js,reg:aa,msg:"Password must follow this pattern /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[\\W_])[A-Za-z\\d\\W_]{8,}$/ 🧐"},Ei={...et,label:"New Password",place:"Your new password",field:"newPassword"},st={id:j(),field:"confirmPassword",label:"Confirm Password",place:"Confirm your password",msg:"",reg:/.*/},Ii={id:j(),label:"Name",field:"name",required:!0,reg:Il,msg:"Restaurant name must be between 2 and 50 characters"},_a=[...ss.map(e=>({...e,required:!0,id:j()}))],wa=ts.filter(e=>e.field!=="phone").map(e=>({...e,required:!0,id:j()})),We=[[..._a],[...wa]],Cs=2,Pi=[{id:j(),field:"email",label:"Email (if different from personal)",place:"Your email address...",required:!1,reg:Ys,msg:"Email must follow this pattern /^(?![.-])(?!.*[.-]$)(?!.*\\.\\.)(?!.*@.*@)[A-Za-z0-9._%+-]+@[A-Za-z0-9]+\\.[A-Za-z]{2,}$/ 🧐",type:"email"},{id:j(),field:"phone",label:"Phone (if different from personal)",place:"Your phone number...",required:!1,reg:na,msg:"Phone can only contains numbers,and including country prefix up to 15 digits"},{id:j(),field:"website",label:"Website (if you have one)",place:"Your website url...",required:!1,reg:Pl,msg:"A URL can have optionally the protocol, subdomain, must have main domain and eventually path query or fragment",type:"url"}],Ri=[{id:j(),field:"openTime",label:"Open time",place:"Open time (8:00 e.g)",reg:Rs,required:!0,msg:"Follow format HH:MM"},{id:j(),field:"closeTime",label:"Close time",place:"Close time (21:00 e.g)",reg:Rs,required:!0,msg:"Follow the format HH:MM"}],Me=Math.ceil(ua.length/6),ba=[];for(let e=0;e<(be==null?void 0:be.length);e++)e%6===0&&ba.push([...be.slice(e,e+6)]);const Ai=[{id:j(),type:"number",field:"estTimeDelivery",label:"Delivery time",msg:"Invalid format, write delivery time in minutes (e.g 20)",required:!0,place:"Delivery time...",reg:ra},{id:j(),type:"number",field:"price",label:"Charge for delivery",msg:"Delivery charge must be a positive decimal number with at most 2 decimal places.",required:!1,place:"Leave empty if no charge",reg:Oe},{id:j(),type:"number",field:"freeDeliveryPrice",label:"Amount free delivery",msg:"The value must be a positive decimal number with at most 2 decimal places.",required:!1,place:"Leave empty if no amount",reg:Oe}],Di=[{path:"/",label:"Home",svg:Cn},{path:"/search",label:"Restaurants",svg:Ft}].map(e=>({...e,id:j()})),va=[{path:"/user/profile",label:"Profile",svg:Mt},{path:"/user/manage-account",label:"Manage Account",svg:En},{path:"/my-orders",label:"My Orders",svg:B}].map(e=>({...e,id:j()})),Ti=[{path:"/my-restaurants",label:"My restaurants",svg:Ft},{path:"/my-restaurants/add-restaurant",label:"Create restaurant",svg:xs},{path:"/my-dishes",label:"My dishes",svg:In},{label:"Add dish",path:"/my-dishes/add-dish",svg:wt},{path:"/manage-orders",label:"Manage orders",svg:B}].map(e=>({...e,id:j()})),Fi={id:j(),label:"Admin menu",icon:De},Mi=va.slice(0,2).map(e=>({...e,id:j()})),ki={id:j(),label:"Account",icon:Pn},Na=[{path:"/auth/login",label:"Login",svg:Tt},{path:"/auth/send-email?type=recover-pwd",label:"Recover Password",from:"/auth/login",svg:Rt},{path:"/auth/register",label:"Register",svg:Dt},{path:"/auth/send-email?type=verify-account",label:"Verify Account",from:"/auth/register",svg:At}].map(e=>({...e,id:j()})),Sa=({type:e})=>{const t=D(),a=A();return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-y-5 sm:grid-cols-2",children:[s.jsx("button",{type:"button",onClick:()=>t(`/auth/send-email?type=${e==="login"?"recover-pwd":"verify-account"}`,{state:{from:a.pathname}}),className:"w-full flex items-center gap-3 group el__after_below cursor-pointer",children:oi.map(n=>n.type===e&&s.jsxs(f.Fragment,{children:[s.jsx(n.svg,{className:"svg__switch_form"})," ",s.jsx("span",{className:"el__flow group-hover:text-orange-500 txt__00",children:n.label})]},n.id))}),s.jsx(W,{to:e==="login"?"/auth/register":"/auth/login",className:"w-full flex items-center gap-3 group el__after_below sm:justify-self-end",children:di.map(n=>n.type===e&&s.jsxs(f.Fragment,{children:[s.jsx(n.svg,{className:"svg__switch_form"}),s.jsx("span",{className:"el__flow group-hover:text-orange-500 txt__00",children:n.label})]},n.id))})]})},Ne=({register:e,errors:t,isVisible:a,handleChangeVisibility:n,field:r,custom:l})=>{var c,o;const i={required:"Password is required",pattern:{value:r.reg,message:r.msg},validate:d=>l?l(d):!0};return s.jsxs("label",{className:"grid grid-cols-1 gap-y-3 relative",children:[s.jsx("span",{className:"txt__01",children:r.label}),s.jsxs("div",{className:"w-full relative",children:[s.jsx("input",{type:a?"text":"password",className:"input__auth_field ",placeholder:r.place,...e(r.field,i)}),s.jsx("span",{onClick:()=>n(),className:"w-fit flex justify-center items-center",children:a?s.jsx(Rn,{className:"svg__auth_field"}):s.jsx(An,{className:"svg__auth_field"})})]}),((c=t==null?void 0:t[r.field])==null?void 0:c.message)&&s.jsx("span",{className:"txt__00 text-red-600",children:(o=t==null?void 0:t[r.field])==null?void 0:o.message})]})},Li=()=>s.jsx("div",{className:"w-full spinner_btn flex justify-center gap-4",children:Array.from({length:4}).map((e,t)=>s.jsx("span",{className:"spinner_tbn__el",style:{"--i":t+1}},t))}),_e=()=>s.jsx("div",{className:"w-full flex justify-self-center",children:s.jsx(Li,{})}),J=({isDisabled:e,label:t,type:a="button",handleClick:n,styleTxt:r,isPending:l})=>l?s.jsx(_e,{}):s.jsxs("button",{onClick:n,type:a,disabled:e,className:"btn_container outline-none",children:[s.jsxs("div",{className:"btn_container__content",children:[s.jsx("div",{className:"content__btn",children:s.jsx("span",{className:`relative z-40 ${r??"btn__txt"}`,children:t??"BUTTON"})}),s.jsx("span",{className:"btn__ref_1"}),s.jsx("span",{className:"btn__ref_2"})]}),s.jsx("span",{className:"btn_container__shadow"}),s.jsx(Dn,{className:"btn_container__svg_1"}),s.jsx(kt,{className:"btn_container__svg_2"}),s.jsx(Tn,{className:"btn_container__svg_3"}),s.jsx(Fn,{className:"btn_container__svg_4"}),s.jsx(Mn,{className:"btn_container__svg_5"}),s.jsx(kn,{className:"btn_container__svg_6"})]}),Oi=()=>{k();const{register:e,errors:t,isPending:a,handleLoginUser:n}=wl(),[r,l]=f.useState(!1);return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-y-10 items-center",children:[s.jsx("div",{className:"w-full flex justify-center",children:s.jsx("span",{className:"txt__04",children:"Login"})}),s.jsx("div",{className:"w-full justify-self-center max-w-[600px] grid grid-cols-1 border-2 border-orange-500 rounded-xl p-10",children:s.jsx("div",{className:"w-full grid grid-cols-1",children:s.jsxs("form",{onSubmit:n,className:"grid grid-cols-1 w-full gap-y-8",children:[s.jsx(Je,{register:e,errors:t,field:Ve}),s.jsx(Ne,{register:e,errors:t,isVisible:r,handleChangeVisibility:()=>l(!r),field:Js}),s.jsx("div",{className:"w-full mt-2 max-w-[225px] md:max-w-[250px] justify-self-center flex justify-center",children:s.jsx(J,{styleTxt:"txt__02",label:"Login",type:"submit",isPending:a})}),s.jsx("div",{className:"w-full",children:s.jsx(Sa,{type:"login"})})]})})})]})},Ui=({register:e,errors:t,valTerms:a})=>{var c,o;const n=!!((c=t==null?void 0:t.acceptedTerms)!=null&&c.message),r=f.useRef(null),[l,i]=f.useState(!1);return f.useEffect(()=>{const d=u=>{var p;if(!(!r.current||a===void 0)&&(p=r.current)!=null&&p.contains(u.target)){const m=document.getElementById("squareCheck");m==null||m.classList.remove("register__checkbox"),requestAnimationFrame(()=>{m==null||m.classList.add("register__checkbox")})}};return document.addEventListener("click",d),()=>{document.removeEventListener("click",d)}},[a,l]),s.jsxs("div",{className:"w-full grid grid-cols-1 gap-2 ",children:[s.jsxs("label",{ref:r,className:"w-full flex gap-10 max-w-fit justify-start relative py-2 cursor-pointer items-center",children:[s.jsx("input",{type:"checkbox",className:"opacity-0",...e("acceptedTerms",{required:"You must accept terms and conditions"})}),s.jsx("span",{id:"squareCheck",onClick:()=>i(!0),className:`absolute top-1 left-0 border-[3px] rounded-xl w-[30px] sm:w-[35px] h-[30px] sm:h-[35px] cursor-pointer ${a?"border-green-600":a===void 0||!l?"border-white":"border-red-600"}`}),s.jsx("span",{className:`absolute delay-75 -top-2 sm:-top-3 left-4 w-3 sm:w-4 h-8 sm:h-10 border-r-4 border-b-4 rotate-45 border-green-600 el__flow cursor-pointer ${a?"scale-100":"scale-0"}`}),s.jsx("span",{className:`txt__01 el__flow ${a?"hover:text-green-600":a===void 0?"border-white":"hover:text-red-600"}`,children:"I Accept Terms And Conditions"})]}),n&&s.jsx("span",{className:"txt__00 text-red-600",children:(o=t==null?void 0:t.acceptedTerms)==null?void 0:o.message})]})},tt=({isConfirmPwdVisible:e,setIsConfirmPwdVisible:t,isPwdVisible:a,setIsPwdVisible:n})=>({handleChangePwdVisibility:()=>{e?(t(!1),n(!0)):n(!a)},handleChangeConfirmPwdVisibility:()=>{a?(n(!1),t(!0)):t(!e)}}),$i=()=>{const[e,t]=f.useState(!1),[a,n]=f.useState(!1),r=D(),l=A(),{handleChangePwdVisibility:i,handleChangeConfirmPwdVisibility:c}=tt({isPwdVisible:e,setIsPwdVisible:t,isConfirmPwdVisible:a,setIsConfirmPwdVisible:n}),{showToastMsg:o}=he(),{register:d,handleSubmit:u,reset:p,watch:m,trigger:g,formState:{errors:x},setFocus:y}=U({mode:"onChange"});f.useEffect(()=>{y("firstName")},[y]);const _=m("password");f.useEffect(()=>{_&&g("confirmPassword")},[_,g]);const{mutate:h,isPending:w}=R({mutationFn:C=>tl(C),onSuccess:()=>{p(),o("Account created successfully","SUCCESS"),r("/notice-email?type=verify-account",{state:{from:l.pathname}})},onError:C=>{var S,I;o(((I=(S=C==null?void 0:C.response)==null?void 0:S.data)==null?void 0:I.msg)||(C==null?void 0:C.message),"ERROR")}}),b=u(C=>{const{confirmPassword:S,...I}=C;h(I)});return{register:d,errors:x,watch:m,trigger:g,isPwdVisible:e,isConfirmPwdVisible:a,handleChangePwdVisibility:i,handleChangeConfirmPwdVisibility:c,isPending:w,handleRegister:b,customPwd:C=>C===m("email")?"Password must be different from email":!0,customConfirmPwd:C=>C!==m("password")?"Passwords do not match 🤔":!0}},at=({watch:e})=>{const t=e("password"),a=(t==null?void 0:t.length)>=8;return s.jsxs("div",{className:"w-full col-span-2 grid grid-cols-[35px_70px_1fr] items-center",children:[s.jsx("span",{children:a?s.jsx(Xe,{className:"w-[30px] h-[30px] text-green-600"}):s.jsx(Qs,{className:"w-[30px] h-[30px] text-red-600"})}),s.jsx("span",{className:`txt__00 ml-2 px-3 py-1 border-2 rounded-xl ${a?"text-green-600 border-green-600":"text-red-600 border-red-600"}`,children:s.jsx(Ln,{})}),s.jsxs("span",{className:`txt__01 ml-4 ${a?"text-green-600":"text-red-600"}`,children:[(t==null?void 0:t.length)??0," / 8"]})]})},nt=({watch:e})=>hi.map(t=>{const a=Ie(e("password"),t.reg);return s.jsxs("div",{className:"w-full grid grid-cols-[35px_70px_1fr] items-center",children:[s.jsx("span",{children:a?s.jsx(Xe,{className:"w-[30px] h-[30px] text-green-600"}):s.jsx(Qs,{className:"w-[30px] h-[30px] text-red-600"})}),s.jsx("span",{className:`txt__00 ml-2 px-3 py-1 border-2 rounded-xl ${a?"text-green-600 border-green-600":"text-red-600 border-red-600"}`,children:t.label}),s.jsx("span",{className:`txt__00 hidden ml-4 ${a?"text-green-600":"text-red-600"}`,children:t.msg})]},t.id)}),Vi=()=>{const[e,t]=f.useState(""),a=f.useRef(null);f.useEffect(()=>{const o=d=>{var u;if(a.current&&(u=a.current)!=null&&u.contains(d.target)){const p=document.getElementById("tooltip");p==null||p.classList.remove("generate_password__tooltip"),requestAnimationFrame(()=>p==null?void 0:p.classList.add("generate_password__tooltip"))}};return document.addEventListener("click",o),()=>document.removeEventListener("click",o)},[]);const n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+{}[]<>-+~/$\\|",r=()=>{const o=n.split("");for(let d=o.length-1;d>0;d--){const u=Math.floor(Math.random()*(d+1));[o[d],o[u]]=[o[u],o[d]]}return o.join("")},l=()=>{const o=new Uint8Array(24);window.crypto.getRandomValues(o);const d=r();return Array.from(o,u=>d[u%d.length]).join("")};return{generatePwd:async()=>{let o="";for(;!aa.test(o);)o=await l();t(o)},handleCopyPwd:async()=>{if(e)try{await navigator.clipboard.writeText(e)}catch{}},strongPwd:e,tooltipRef:a}},rt=()=>{const{strongPwd:e,generatePwd:t,handleCopyPwd:a,tooltipRef:n}=Vi();return s.jsxs("div",{className:"w-full max-w-full grid grid-cols-1 gap-3",children:[s.jsx("div",{className:"w-full max-w-fit flex hover:text-orange-500 btn__pseudo",children:s.jsxs("button",{onClick:t,type:"button",className:"justify-self-start flex gap-4 items-center cursor-pointer",children:[s.jsx(On,{className:"w-[30px] h-[30px]"}),s.jsx("span",{className:"txt__00",children:"Generate strong password"})]})}),!!e&&s.jsxs("div",{className:"relative group w-full flex max-w-fit",children:[s.jsx("button",{type:"button",ref:n,onClick:a,className:"txt__00 btn__pseudo border-2 border-orange-500 rounded-xl w-full max-w-fit px-6 py-1 cursor-pointer hover:text-orange-500 break-all text-start",children:e}),s.jsx("span",{id:"tooltip",className:"absolute text-sm lg:text-base px-4 py-1 -top-1/2 left-1/2 border-2 border-orange-500 rounded-xl w-full whitespace-nowrap bg-[#111] pointer-events-none z-10 txt__00 max-w-fit px-6 min-w-[150px] opacity-0",children:"Password Copied"})]})]})},qi=()=>{k();const{register:e,errors:t,watch:a,isPwdVisible:n,isConfirmPwdVisible:r,handleChangePwdVisibility:l,handleChangeConfirmPwdVisibility:i,isPending:c,handleRegister:o,customPwd:d,customConfirmPwd:u}=$i();return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-y-10 items-center",children:[s.jsx("div",{className:"w-full flex justify-center",children:s.jsx("span",{className:"txt__04",children:"Register"})}),s.jsx("div",{className:"w-full justify-self-center max-w-[600px] grid grid-cols-1 border-2 border-orange-500 rounded-xl p-10",children:s.jsx("div",{className:"w-full grid grid-cols-1",children:s.jsxs("form",{onSubmit:o,className:"grid grid-cols-1 w-full gap-y-8",children:[[...Ci,Ve].map(p=>s.jsx(Je,{register:e,errors:t,field:p},p.id)),s.jsx(Ne,{register:e,errors:t,custom:d,isVisible:n,handleChangeVisibility:l,field:et}),s.jsx(rt,{}),!!Object.keys((t==null?void 0:t.password)??{}).length&&s.jsxs("div",{className:"w-full grid grid-cols-2 gap-5 sm:grid-cols-4",children:[s.jsx(nt,{watch:a}),s.jsx(at,{watch:a})]}),s.jsx(Ne,{register:e,errors:t,custom:u,isVisible:r,handleChangeVisibility:i,field:st}),s.jsx(Ui,{register:e,errors:t,valTerms:a("acceptedTerms")}),s.jsx("div",{className:"w-full mt-2 max-w-[225px] md:max-w-[250px] justify-self-center flex justify-center",children:s.jsx(J,{styleTxt:"txt__02",label:"Register",type:"submit",isPending:c})}),s.jsx("div",{className:"w-full",children:s.jsx(Sa,{type:"register"})})]})})})]})},Bi=({reset:e,callAPI:t,type:a,from:n})=>{const{showToastMsg:r,handleErrAPI:l}=F(),i=D(),{mutate:c,isPending:o}=R({mutationFn:({email:d})=>t({email:d,type:a}),onSuccess:()=>{e(),r("Verification Email sent successfully","SUCCESS"),i(`/notice-email?type=${a??""}`,{state:{from:n}})},onError:d=>{var u,p,m;((u=d==null?void 0:d.response)==null?void 0:u.status)===403?r((m=(p=d==null?void 0:d.response)==null?void 0:p.data)==null?void 0:m.msg,"ERROR"):l({err:d})}});return{mutate:c,isPending:o}},Qi=()=>{var g;const[e]=ae(),t=A(),a=(g=t==null?void 0:t.state)==null?void 0:g.from,n=e.get("type"),r=ve(["/auth/register","/auth/login"],a)&&ve(["recover-pwd","verify-account"],n??""),{register:l,handleSubmit:i,formState:{errors:c},reset:o,setFocus:d}=U({mode:"onChange"});f.useEffect(()=>{d("email")},[d]);const{mutate:u,isPending:p}=Bi({reset:o,callAPI:rl,from:a,type:n}),m=i(x=>{u({email:x.email})});return{register:l,errors:c,canStay:r,type:n,isPending:p,handleSubmitEmail:m}},Gi=()=>{k();const{register:e,errors:t,canStay:a,type:n,isPending:r,handleSubmitEmail:l}=Qi();return a?s.jsxs("div",{className:"w-full grid grid-cols-1 gap-y-10 items-center",children:[s.jsx("div",{className:"w-full flex justify-center",children:s.jsx("span",{className:"txt__04",children:n==="recover-pwd"?"Recover Password":"Verify Account"})}),s.jsx("div",{className:"w-full justify-self-center max-w-[600px] grid grid-cols-1 border-2 border-orange-500 rounded-xl p-10",children:s.jsx("div",{className:"w-full grid grid-cols-1",children:s.jsxs("form",{onSubmit:l,className:"grid grid-cols-1 w-full gap-y-8",children:[s.jsx(Je,{register:e,errors:t,field:Ve}),s.jsx("div",{className:"w-full mt-2 max-w-[225px] md:max-w-[250px] justify-self-center flex justify-center",children:s.jsx(J,{styleTxt:"txt__02",label:"Send Email",type:"submit",isPending:r})})]})})})]}):s.jsx(G,{to:"/",replace:!0})},gt=({callAPI:e,successCB:t})=>{const a=D(),{showToastMsg:n,handleErrAPI:r}=F(),l=c=>{var o,d,u,p,m,g,x;((o=c==null?void 0:c.response)==null?void 0:o.status)===401&&["VERIFY TOKEN EXPIRED"].includes((u=(d=c==null?void 0:c.response)==null?void 0:d.data)==null?void 0:u.msg)?(((m=(p=c==null?void 0:c.response)==null?void 0:p.config)==null?void 0:m.url)==="/auth/verify-account"?a("/auth/send-email?type=verify-account",{replace:!0,state:{from:"/auth/register"}}):a("/auth/send-email?type=recover-pwd",{replace:!0,state:{from:"/auth/login"}}),n((x=(g=c==null?void 0:c.response)==null?void 0:g.data)==null?void 0:x.msg,"ERROR")):r({err:c,push:!0})},{mutate:i}=R({mutationFn:({userId:c,token:o})=>e({userId:c,token:o}),onSuccess:c=>{t(c)},onError:c=>{l(c)}});return{mutate:i}},zi=()=>{const e=f.useRef(!1),{isLogged:t,setUserLogged:a}=L(),{showToastMsg:n}=he(),[r]=ae(),l=D(),i=r.get("type"),c=r.get("token"),o=r.get("userId"),d=Ie(o??"",z),u=Ie(c??"",fs),p=ve(["recover-pwd","verify-account"],i??""),m=[u,d,p].every(w=>!!w)&&!t,g=w=>{a(w.accessToken),n("Account Verified Successfully","SUCCESS"),l("/",{replace:!0})},{mutate:x}=gt({callAPI:({userId:w,token:b})=>ll({userId:w,token:b}),successCB:w=>g(w)}),y=()=>{n("Email verified Successfully","SUCCESS"),l(`/auth/recover-pwd?userId=${o}&token=${c}`,{state:{from:"/auth/verify"},replace:!0})},{mutate:_}=gt({callAPI:({userId:w,token:b})=>il({userId:w,token:b}),successCB:()=>y()}),h=f.useCallback(()=>{e.current||(e.current=!0,i==="verify-account"?x({userId:o,token:c}):i==="recover-pwd"&&_({userId:o,token:c}))},[x,_,i,c,o]);return f.useEffect(()=>{h()},[h]),{canStay:m}},ge={sm:640,md:768,lg:1024,_2xl:1536},Yi=()=>{const[e,t]=f.useState(35),a=360/e;return f.useEffect(()=>{const n=()=>window.innerWidth>ge.lg?t(40):t(30);return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),{numEls:e,deg:a}},Hi=()=>{const{numEls:e,deg:t}=Yi();return s.jsx("div",{className:"w-[200px] h-[200px] lg:h-[300px] lg:w-[300px] relative",children:Array.from({length:e}).map((a,n)=>s.jsx("span",{className:" spinner__el absolute top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2 min-w-full min-h-full",style:{"--i":n,"--numEls":e,"--deg":`${t}deg`,transform:`rotate(${t*n}deg)`}},n))})},as=({pad:e})=>s.jsx("div",{className:`w-full flex justify-center items-center ${e??"pt-[20vw] lg:pt-[12.5vw]"}`,children:s.jsx(Hi,{})}),Ki=()=>{k();const{canStay:e}=zi();return e?s.jsx(as,{}):s.jsx(G,{to:"/",replace:!0})},Wi=()=>{var O;const[e,t]=f.useState(!1),[a,n]=f.useState(!1),{showToastMsg:r,handleErrAPI:l}=F(),{setUserLogged:i}=L(),c=A(),o=D(),[d]=ae(),u=d.get("token"),p=d.get("userId"),m=z.test(p??""),g=fs.test(u??""),x=((O=c==null?void 0:c.state)==null?void 0:O.from)==="/auth/verify"&&m&&g,{handleChangePwdVisibility:y,handleChangeConfirmPwdVisibility:_}=tt({isPwdVisible:e,setIsPwdVisible:t,isConfirmPwdVisible:a,setIsConfirmPwdVisible:n}),{register:h,setFocus:w,formState:{errors:b},handleSubmit:v,reset:N,watch:C,trigger:S}=U({mode:"onChange"}),{mutate:I,isPending:q}=R({mutationFn:({password:T,token:se,userId:we})=>cl({password:T,token:se,userId:we}),onSuccess:T=>{N(),i(T==null?void 0:T.accessToken),r("Password changed successfully","SUCCESS"),o("/",{replace:!0})},onError:T=>{l({err:T})}}),$=v(T=>{const{password:se}=T;I({password:se,token:u,userId:p})}),ce=C("password");return f.useEffect(()=>{w("password")},[w]),f.useEffect(()=>{ce&&S("confirmPassword")},[ce,S]),{register:h,errors:b,watch:C,isPwdVisible:e,isConfirmPwdVisible:a,handleChangePwdVisibility:y,handleChangeConfirmPwdVisibility:_,canStay:x,handleSubmitRecoverPwd:$,isPending:q,customConfirmPwd:T=>T!==C("password")?"Passwords do not match 🤔":!0}},Zi=()=>{k();const{register:e,errors:t,watch:a,isPwdVisible:n,isConfirmPwdVisible:r,handleChangePwdVisibility:l,handleChangeConfirmPwdVisibility:i,canStay:c,isPending:o,handleSubmitRecoverPwd:d,customConfirmPwd:u}=Wi();return c?s.jsxs("div",{className:"w-full grid grid-cols-1 gap-y-10 items-center",children:[s.jsx("div",{className:"w-full flex justify-center",children:s.jsx("span",{className:"txt__04",children:"Recover Password"})}),s.jsx("div",{className:"w-full justify-self-center max-w-[600px] grid grid-cols-1 border-2 border-orange-500 rounded-xl p-10",children:s.jsx("div",{className:"w-full grid grid-cols-1",children:s.jsxs("form",{onSubmit:d,className:"grid grid-cols-1 w-full gap-y-8",children:[s.jsx(Ne,{register:e,errors:t,isVisible:n,handleChangeVisibility:l,field:et}),!!Object.keys((t==null?void 0:t.password)??{}).length&&s.jsxs("div",{className:"w-full grid grid-cols-2 gap-5 sm:grid-cols-4",children:[s.jsx(nt,{watch:a}),s.jsx(at,{watch:a})]}),s.jsx(rt,{}),s.jsx(Ne,{register:e,errors:t,custom:u,isVisible:r,handleChangeVisibility:i,field:st}),s.jsx("div",{className:"w-full mt-2 max-w-[250px] md:max-w-[300px] justify-self-center flex justify-center",children:s.jsx(J,{styleTxt:"txt__02",label:"Change Password",type:"submit",isPending:o})})]})})})]}):s.jsx(G,{to:"/",replace:!0})};var ee=(e=>(e.UPDATE_FIELD="UPDATE_FIELD",e.SET_ERR="SET_ERR",e.SET_REQUIRED="SET_REQUIRED",e.SET_PREV_DISABLED="SET_PREV_DISABLED",e.SET_NEXT_DISABLED="SET_NEXT_DISABLED",e.SET_CURR="SET_CURR",e.SET_FETCHED_DATA="SET_FETCHED_DATA",e))(ee||{});const Xi=(e,t)=>{var a,n,r,l,i,c;switch(t.type){case ee.UPDATE_FIELD:{const{field:o,val:d}=t.payload;return{...e,user:{...e.user,[o]:d}}}case ee.SET_ERR:{const{field:o,msg:d}=t.payload;return{...e,errs:{...e.errs,[o]:{...e.errs[o],msg:d}}}}case ee.SET_REQUIRED:{const{field:o,required:d}=t.payload;return{...e,errs:{...e.errs,[o]:{...e.errs[o],required:d}}}}case ee.SET_CURR:{const{curr:o}=t.payload;return o==="PREV"&&!e.currForm.isPrevDisabled?{...e,currForm:{curr:e.currForm.curr-1,isPrevDisabled:e.currForm.curr-1===0,isNextDisabled:!1}}:{...e,currForm:{curr:e.currForm.curr+1,isPrevDisabled:!1,isNextDisabled:e.currForm.curr+1===Xs-1}}}case ee.SET_NEXT_DISABLED:{const{isNextDisabled:o}=t.payload;return{...e,currForm:{...e.currForm,isNextDisabled:o}}}case ee.SET_FETCHED_DATA:{const{user:o}=t.payload;return{...e,user:{firstName:(o==null?void 0:o.firstName)??"",lastName:(o==null?void 0:o.lastName)??"",country:((a=o==null?void 0:o.address)==null?void 0:a.country)??"",state:((n=o==null?void 0:o.address)==null?void 0:n.state)??"",city:((r=o==null?void 0:o.address)==null?void 0:r.city)??"",street:((l=o==null?void 0:o.address)==null?void 0:l.street)??"",zipCode:((i=o==null?void 0:o.address)==null?void 0:i.zipCode)??"",phone:((c=o==null?void 0:o.address)==null?void 0:c.phone)??""},errs:{}}}default:return e}},Ji=(e,t)=>{let a;for(const n in t)e.map(r=>r.field).includes(n)&&(a={...a,[n]:t[n]});return a},ec=(e,t)=>{let a=!0;for(let n=0;n<t.length;n++)t[n].reg.test(e[t[n].field])||(a=!1);return a},sc=(e,t,a,n)=>{e({type:ee.SET_ERR,payload:{field:t,msg:n.reg.test(a??"")?null:n.msg}}),e({type:ee.SET_REQUIRED,payload:{field:t,required:a?null:`${n.label} is required`}})},tc=(e,t,a,n,r)=>{const l=mi[r??t.currForm.curr],i=Ji(l,t.user);a!==void 0&&n!==void 0&&(i[a]=n);const c=ec(i,l);e({type:ee.SET_NEXT_DISABLED,payload:{isNextDisabled:!c}})},ac=(e,t,a,n)=>{const{name:r,value:l}=n.target,[i]=ui.filter(c=>c.field===r);t(r,l,i),a(r,l),e({type:ee.UPDATE_FIELD,payload:{field:r,val:l}})},nc=(e,t)=>t>0?e({type:ee.SET_CURR,payload:{curr:"PREV"}}):void 0,rc=(e,t,a)=>{t.curr<Xs-1&&!t.isNextDisabled&&e({type:ee.SET_CURR,payload:{curr:"NEXT"}}),a(void 0,void 0,t.curr+1)},lc=(e,t)=>e({type:ee.SET_FETCHED_DATA,payload:{user:t}}),ic={currForm:{curr:0,isPrevDisabled:!0,isNextDisabled:!1},user:{firstName:"",lastName:"",country:"",state:"",city:"",street:"",zipCode:"",phone:""},errs:{}},cc=()=>{const{showToastMsg:e,handleErrAPI:t}=F(),a=Q(),{data:n,isPending:r,isError:l,isSuccess:i,error:c}=ne({queryKey:["userProfileDetails"],queryFn:Or}),{mutate:o,isPending:d,isSuccess:u,isError:p,error:m}=R({mutationFn:I=>Ur(I)}),[g,x]=f.useReducer(Xi,ic),y=f.useCallback(I=>lc(x,I),[x]),_=f.useCallback(()=>{if(l)t({err:c});else if(i){const{user:I={}}=n??{};y(I)}},[n,i,l,c,t,y]),h=f.useCallback(async()=>{p?t({err:m}):u&&(e("Profile updated successfully","SUCCESS"),await a.invalidateQueries({queryKey:["userProfileDetails"]}))},[a,p,t,m,u,e]);f.useEffect(()=>{_()},[_]),f.useEffect(()=>{h()},[h]);const w=(I,q,$)=>sc(x,I,q,$),b=(I,q,$)=>tc(x,g,I,q,$);return{state:g,handleChangeHigher:I=>ac(x,w,b,I),handlePrevHigher:()=>nc(x,g.currForm.curr),handleNextHigher:()=>rc(x,g.currForm,b),isPending:r,isPendingUpdate:d,handleSubmit:I=>{I.preventDefault(),o({...g.user})}}},oc=()=>{const e=f.useRef(null),t=f.useRef(null),a=f.useRef(null),{state:n,handleChangeHigher:r,handlePrevHigher:l,handleNextHigher:i,isPending:c,isPendingUpdate:o,handleSubmit:d}=cc(),u=f.useCallback(()=>{const x=[e,t,a],y=n.currForm.curr;x[y].current&&setTimeout(()=>{var _;(_=x[y].current)==null||_.focus()},600)},[n.currForm.curr]);f.useEffect(()=>{setTimeout(()=>{u()},200)},[]),f.useEffect(()=>{u()},[u]);const{isPrevDisabled:p,isNextDisabled:m,curr:g}=n.currForm;return{propsBtns:{isPrevDisabled:p,isNextDisabled:m,handleNext:i,handlePrev:l},curr:g,state:n,handleChange:r,isPending:c,isPendingUpdate:o,handleSubmit:d,refs:{inputRef_0:e,inputRef_1:t,inputRef_2:a}}},le=({isDisabled:e,label:t,type:a="button",handleClick:n,styleTxt:r,styleBtn:l,isPending:i})=>i?s.jsx(_e,{}):s.jsxs("button",{disabled:e,onClick:n,type:a,className:"btn__with_shadow_container group outline-none",children:[s.jsx("div",{className:`${l??"group-hover:text-orange-500 border-orange-500"} btn__with_shadow_container__content`,children:s.jsx("span",{className:`${r}`,children:t})}),s.jsx("span",{className:`${l??"border-orange-500"} btn__with_shadow_container__shadow`})]}),ns=({currForm:e,isPrevDisabled:t,isNextDisabled:a,handlePrev:n,handleNext:r,totLen:l,hiddenLg:i,children:c=!1})=>s.jsxs("div",{className:`w-full grid grid-cols-2 sm:justify-items-center ${i?"lg:hidden":""}`,children:[s.jsx("div",{className:"w-full max-w-[30vw] sm:max-w-[200px] justify-self-start sm:justify-self-center",children:s.jsx(le,{label:"Prev",isDisabled:t,handleClick:n,styleTxt:"txt__02",type:"button"})}),e===l-1?c??null:s.jsx("div",{className:"w-full max-w-[30vw] sm:max-w-[200px] justify-self-end sm:justify-self-center",children:s.jsx(le,{label:"Next",isDisabled:a,handleClick:r,styleTxt:"txt__02",type:"button"})})]}),dc=({isPrevDisabled:e,isNextDisabled:t,handlePrev:a,handleNext:n,curr:r,isPendingUpdate:l})=>s.jsx(ns,{isPrevDisabled:e,isNextDisabled:t,handleNext:n,handlePrev:a,currForm:r,totLen:Xs,hiddenLg:!1,children:s.jsx("div",{className:"w-full max-w-[200px] h-full flex items-center",children:s.jsx(J,{label:"Save",isDisabled:t,type:"submit",styleTxt:"txt__02",isPending:l})})}),Es=({el:e,state:t,handleChange:a,inputRef:n})=>{var l;const r=(l=t.errs)==null?void 0:l[e.field];return s.jsxs("label",{className:"w-full flex flex-col gap-y-2",children:[s.jsx("span",{className:"txt__01",children:e.label}),s.jsx("input",{ref:n,onChange:a,type:"text",className:"w-full outline-none px-5 py-1 txt__01 border-2 border-orange-500 rounded-full focus__base el__flow",placeholder:`${e.label}`,name:e.field,value:t.user[e.field]}),!!Object.keys(r??{}).length&&s.jsx("span",{className:"txt__00 text-red-600",children:(r==null?void 0:r.required)||(r==null?void 0:r.msg)||""})]},e.id)},uc=({state:e,handleChange:t,inputRef_0:a,inputRef_1:n,inputRef_2:r})=>s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 p-5 gap-y-5 h-fit transition-all duration-500",children:_s.map((l,i)=>s.jsx(Es,{state:e,handleChange:t,el:l,inputRef:e.currForm.curr===0&&!i?a:null},l.id))}),s.jsx("div",{className:"min-w-full grid grid-cols-1 p-5 gap-y-5 transition-all duration-500 h-fit ",children:ss.map((l,i)=>s.jsx(Es,{state:e,handleChange:t,el:l,inputRef:e.currForm.curr===1&&!i?n:null},l.id))}),s.jsx("div",{className:"min-w-full grid grid-cols-1 p-5 gap-y-5 transition-all duration-500 h-fit ",children:ts.map((l,i)=>s.jsx(Es,{state:e,handleChange:t,el:l,inputRef:e.currForm.curr===2&&!i?r:null},l.id))})]}),mc=()=>{k();const{propsBtns:e,curr:t,state:a,handleChange:n,isPending:r,isPendingUpdate:l,handleSubmit:i,refs:c}=oc();return s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-y-5",children:[s.jsx("span",{className:"txt__04",children:"Your Profile Details"}),r?s.jsx(as,{}):s.jsxs("form",{onSubmit:i,className:"w-full max-w-[600px] justify-self-center grid grid-cols-1 border-[3px] gap-5 border-orange-500 rounded-xl h-fit p-5 sm:px-10",children:[s.jsx("div",{className:"w-full overflow-hidden",children:s.jsx("div",{className:"w-[300%] grid grid-cols-3 transition-all duration-500 min-h-[250px]",style:{transform:`translateX(-${t*100/3}%)`},children:s.jsx(uc,{state:a,handleChange:n,...c})})}),s.jsx(dc,{...e,curr:t,isPendingUpdate:l})]})]})},pc=()=>{const e=f.useRef(!1),[t]=ae(),a=D(),n=A(),{showToastMsg:r,handleErrAPI:l}=F(),i=t.get("typeUser"),c=t.get("userId"),o=t.get("token"),d=ve(["non-logged","logged"],i??"")&&Ie(o??"",fs)&&Ie(c??"",z),u={userId:c??"",token:o??""},{mutate:p}=R({mutationFn:()=>i==="logged"?Yr({...u}):Hr({...u}),onSuccess:()=>{a("/newsletter/notice-unsubscribe-with-retry?success=true",{state:{from:n.pathname},replace:!0}),r("Subscription deleted successfully","SUCCESS")},onError:m=>{var g,x,y;((g=m==null?void 0:m.response)==null?void 0:g.status)===401?(a("/newsletter/notice-unsubscribe-with-retry?success=false",{state:{from:n.pathname},replace:!0}),r((y=(x=m==null?void 0:m.response)==null?void 0:x.data)==null?void 0:y.msg,"ERROR")):l({err:m,push:!0})}});return f.useEffect(()=>{if(d){if(e.current)return;e.current=!0,p()}},[d,p]),{canStay:d}},xc=()=>{k();const{canStay:e}=pc();return e?s.jsx(as,{}):s.jsx(G,{to:"/",replace:!0})},gc=()=>{var x;const{showToastMsg:e,handleErrAPI:t}=F(),[a]=ae(),n=A(),r=D(),l=a.get("success"),i=((x=n==null?void 0:n.state)==null?void 0:x.from)==="/newsletter/verify-unsubscribe",{register:c,formState:{errors:o},handleSubmit:d,reset:u}=U({mode:"onChange"}),{mutate:p,isPending:m}=R({mutationFn:({email:y})=>Kr({email:y}),onSuccess:()=>{u(),e("Email sent successfully","SUCCESS"),r("/notice-email?type=sentEmailUnsubscribe",{state:{from:n.pathname}})},onError:y=>{t({err:y})}}),g=d(y=>{p({email:y.email})});return{canStay:i,success:l,register:c,errors:o,handleSubmitEmail:g,isPending:m}},fc=()=>{k();const{canStay:e,success:t,register:a,errors:n,handleSubmitEmail:r,isPending:l}=gc();return e?t==="true"?s.jsxs("div",{className:"w-full flex flex-col items-center gap-y-14",children:[s.jsx("div",{className:"w-full flex justify-center",children:s.jsx("span",{className:"txt__04 leading-10 lg:leading-16",children:"Your subscription has deleted successfully, if you unsubscribe by mistake don't worry, you can subscribe again anytime ✌🏼"})}),s.jsx("div",{className:"w-full flex justify-center items-center",children:s.jsx(Xe,{className:"w-[200px] sm:w-[300px] h-[200px] sm:h-[300px] md:w-[400px] md:h-[400px] text-green-600"})})]}):s.jsxs("div",{className:"w-full grid grid-cols-1 gap-y-10 items-center",children:[s.jsx("div",{className:"w-full flex justify-center",children:s.jsx("span",{className:"txt__04",children:"Send unsubscribe link"})}),s.jsx("div",{className:"w-full justify-self-center max-w-[600px] grid grid-cols-1 border-2 border-orange-500 rounded-xl p-10",children:s.jsx("div",{className:"w-full grid grid-cols-1",children:s.jsxs("form",{onSubmit:r,className:"grid grid-cols-1 w-full gap-y-8",children:[s.jsx(Je,{register:a,errors:n,field:Ve}),s.jsx("div",{className:"w-full mt-2 max-w-[225px] md:max-w-[250px] justify-self-center flex justify-center",children:s.jsx(J,{styleTxt:"txt__02",label:"Send Email",type:"submit",isPending:l})})]})})})]}):s.jsx(G,{to:"/",replace:!0})},hc=()=>{const{showToastMsg:e,closeToast:t}=he(),{handleErrAPI:a}=je(),{setCanManageAccount:n,canManageAccount:r,currUser:l,setUserLogged:i}=L();return{showToastMsg:e,canManageAccount:r,setCanManageAccount:n,currUser:l,handleErrManageUser:({err:o})=>{var m,g,x,y,_;const d=(m=o==null?void 0:o.response)==null?void 0:m.status,u=(x=(g=o==null?void 0:o.response)==null?void 0:g.config)==null?void 0:x.url,p=((_=(y=o==null?void 0:o.response)==null?void 0:y.data)==null?void 0:_.msg)||o.message;u==="/user/manage-account"?d===401?e(p,"ERROR"):d===429&&(i(!1),a({err:o})):([401,429].includes(d??500)&&n(!1),a({err:o}))},closeToast:t}},yc=({setCanManageAccount:e,handleErrManageUser:t,closeToast:a})=>{const[n,r]=f.useState(!1),l=()=>r(!n),{register:i,formState:{errors:c},handleSubmit:o,setFocus:d}=U({mode:"onChange"});f.useEffect(()=>{d("password")},[d]);const{mutate:u,isPending:p}=R({mutationFn:g=>$r(g),onSuccess:g=>{e(g.manageAccountToken),a()},onError:g=>{t({err:g})}}),m=o(g=>{u(g.password)});return{register:i,errors:c,isPwdVisible:n,handleChangeVisibility:l,submitManageForm:m,isPending:p}},jc=({setCanManageAccount:e,handleErrManageUser:t,closeToast:a})=>{const{register:n,errors:r,isPwdVisible:l,handleChangeVisibility:i,submitManageForm:c,isPending:o}=yc({setCanManageAccount:e,handleErrManageUser:t,closeToast:a});return s.jsxs("form",{onSubmit:c,className:"w-full max-w-[600px] justify-self-center grid grid-cols-1 border-[3px] gap-10 border-orange-500 rounded-xl h-fit p-5 sm:px-10 justify-items-center",children:[s.jsx("span",{className:"txt__03",children:"Confirm your password before proceeding"}),s.jsx("div",{className:"w-full",children:s.jsx(Ne,{field:Js,register:n,errors:r,isVisible:l,handleChangeVisibility:i})}),s.jsx("div",{className:"w-full flex max-w-[200px] sm:max-w-[250px] justify-center",children:s.jsx(le,{label:"Submit",styleTxt:"txt__02",type:"submit",isPending:o})})]})},_c=({showToastMsg:e,setIsChildLoading:t,handleErrManageUser:a})=>{const n=A(),r=D(),{register:l,formState:{errors:i},handleSubmit:c,setFocus:o}=U({mode:"onChange"});f.useEffect(()=>{o("newEmail")},[o]);const{mutate:d,isPending:u}=R({mutationFn:g=>(t(!0),Vr(g)),onSuccess:()=>{e("Email changed successfully!","SUCCESS"),r("/notice-email?type=change-email",{state:{from:n.pathname}})},onError:g=>{a({err:g})},onSettled:()=>{t(!1)}}),p=c(g=>{d({newEmail:g.newEmail,manageAccountToken:sessionStorage.getItem("manageAccountToken")??""})});return{register:l,errors:i,handleSubmitChangeEmail:p,isPending:u,custom:(g,x)=>g===x?"New Email must be different from old one":!0}},wc=({currUser:e,showToastMsg:t,setIsChildLoading:a,handleErrManageUser:n})=>{const{register:r,errors:l,handleSubmitChangeEmail:i,isPending:c,custom:o}=_c({showToastMsg:t,setIsChildLoading:a,handleErrManageUser:n});return s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-y-5 py-5 px-5 sm:px-10 h-[300px]",children:[s.jsx("span",{className:"txt__03",children:"Change Email"}),s.jsxs("form",{onSubmit:i,className:"w-full grid grid-cols-1 justify-items-center gap-y-6",children:[s.jsx("div",{className:"w-full",children:s.jsx(Je,{register:r,errors:l,field:Si,custom:d=>o(d,e==null?void 0:e.email)})}),s.jsx("div",{className:"w-full flex justify-center max-w-[250px]",children:s.jsx(J,{styleTxt:"txt__02",label:"Submit",type:"submit",isPending:c})})]})]})},Ts=3,bc=()=>{const[e,t]=f.useState(0),[a,n]=f.useState(!1),r=e===0,l=e===Ts-1;return{currForm:e,propsBtns:{handlePrev:()=>e>0?t(o=>o-1):void 0,handleNext:()=>e<Ts-1?t(o=>o+1):void 0,isPrevDisabled:r,isNextDisabled:l},isChildLoading:a,setIsChildLoading:n}},vc=({showToastMsg:e,handleErrManageUser:t,setIsChildLoading:a,setCanManageAccount:n})=>{const[r,l]=f.useState(!1),[i,c]=f.useState(!1),o=D(),{register:d,watch:u,reset:p,formState:{errors:m},handleSubmit:g}=U({mode:"onChange"}),{handleChangePwdVisibility:x,handleChangeConfirmPwdVisibility:y}=tt({isConfirmPwdVisible:i,setIsConfirmPwdVisible:c,isPwdVisible:r,setIsPwdVisible:l}),{mutate:_,isPending:h}=R({mutationFn:N=>(a(!0),Br(N)),onSuccess:()=>{p(),e("Password changed successfully","SUCCESS"),o("/")},onError:N=>{t({err:N})},onSettled:()=>{a(!1),n(!1)}}),w=g(N=>{const{newPassword:C}=N;_({newPassword:C,manageAccountToken:sessionStorage.getItem("manageAccountToken")??""})});return{register:d,errors:m,watch:u,handleChangePwdVisibility:x,handleChangeConfirmPwdVisibility:y,isConfirmPwdVisible:i,isPwdVisible:r,customPwd:(N,C)=>N===C?"Password must be different from email":!0,customConfirmPwd:N=>N!==u("newPassword")?"Passwords do not match 🤔":!0,isPending:h,handleSubmitChangePwd:w}},Nc=({showToastMsg:e,handleErrManageUser:t,setIsChildLoading:a,currUser:n,setCanManageAccount:r})=>{const{register:l,errors:i,watch:c,handleChangePwdVisibility:o,handleChangeConfirmPwdVisibility:d,isConfirmPwdVisible:u,isPwdVisible:p,customPwd:m,customConfirmPwd:g,isPending:x,handleSubmitChangePwd:y}=vc({showToastMsg:e,handleErrManageUser:t,setIsChildLoading:a,setCanManageAccount:r});return s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-y-5 py-5 pb-10 px-5 sm:px-10",children:[s.jsx("span",{className:"txt__03",children:"Change Password"}),s.jsxs("form",{onSubmit:y,className:"w-full grid grid-cols-1 justify-items-center gap-y-5",children:[s.jsx("div",{className:"w-full",children:s.jsx(Ne,{field:Ei,register:l,errors:i,isVisible:p,handleChangeVisibility:o,custom:_=>m(_,n==null?void 0:n.email)})}),!!Object.keys((i==null?void 0:i.newPassword)??{}).length&&s.jsxs("div",{className:"w-full grid grid-cols-2 sm:grid-cols-3 gap-3",children:[s.jsx(nt,{watch:c}),s.jsx(at,{watch:c})]}),s.jsx(rt,{}),s.jsx("div",{className:"w-full",children:s.jsx(Ne,{field:st,register:l,errors:i,isVisible:u,handleChangeVisibility:d,custom:g})}),s.jsx("div",{className:"w-full flex justify-center max-w-[250px] mt-5",children:s.jsx(J,{styleTxt:"txt__02",label:"Submit",type:"submit",isPending:x})})]})]})},Se=({handleDelete:e,txt:t,border:a=!0,isDisabled:n,isPending:r})=>r?s.jsx(_e,{}):s.jsx("button",{disabled:n,type:"button",onClick:e,className:`min-w-full group ${a?"border-2 border-red-600 ":""}el__flow hover:scale-110 rounded-xl gap-3 cursor-pointer`,children:s.jsxs("div",{className:"py-2 px-4 w-full flex justify-center gap-3",children:[s.jsx(Vs,{className:"w-[30px] h-[30px] el__flow group-hover:text-red-600"}),s.jsx("span",{className:"txt__02 el__flow group-hover:text-red-600",children:t})]})}),Sc=({showToastMsg:e,setIsChildLoading:t,handleErrManageUser:a})=>{const n=D(),{setUserLogged:r}=L(),{setPopup:l,popup:i}=Te(),{mutate:c,isPending:o}=R({mutationFn:p=>(t(!0),l({...i,isPending:!0}),Qr(p)),onSuccess:()=>{r(!1),n("/",{replace:!0}),e("Account deleted successfully","SUCCESS")},onError:p=>{a({err:p})},onSettled:()=>{l(null),t(!1)}}),d=()=>{c(sessionStorage.getItem("manageAccountToken")??"")};return{handleSubmitDeleteAccount:()=>{l({txt:"delete your account?",redLabel:"Delete account",isPending:o,confirmAction:d})},isPending:o,handleDeleteAccount:d}},Cc=({showToastMsg:e,setIsChildLoading:t,handleErrManageUser:a})=>{const{handleSubmitDeleteAccount:n}=Sc({showToastMsg:e,setIsChildLoading:t,handleErrManageUser:a});return s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-y-5 py-5 pb-10 px-5 sm:px-10",children:[s.jsx("span",{className:"txt__03",children:"Delete Account"}),s.jsxs("div",{children:[s.jsx("span",{className:"txt__01",children:"This action is "}),s.jsx("span",{className:"txt__02",children:"irreversible "}),s.jsx("span",{className:"txt__01",children:", continuing you will delete your account and all associated data, without possibility of recovery."})]}),s.jsx("div",{className:"w-fit justify-self-center mt-14",children:s.jsx(Se,{handleDelete:n,txt:"Delete account"})})]})},Ec=({currUser:e,showToastMsg:t,handleErrManageUser:a,setCanManageAccount:n})=>{const{currForm:r,propsBtns:l,isChildLoading:i,setIsChildLoading:c}=bc();return s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-y-10 max-w-[600px]",children:[s.jsx("div",{className:`w-full max-w-[600px] justify-self-center grid grid-cols-1 border-[3px] gap-5 border-orange-500 rounded-xl overflow-hidden h-fit  transition-all duration-500 ${r===0?"max-h-[350px]":r===1?"max-h-[750px]":"max-h-[350px]"}`,children:s.jsxs("div",{className:"w-[300%] grid grid-cols-3 transition-all duration-500 place-items-start justify-items-start",style:{transform:`translateX(-${r*100/3}%)`},children:[s.jsx(wc,{currUser:e,showToastMsg:t,setIsChildLoading:c,handleErrManageUser:a}),s.jsx(Nc,{currUser:e,showToastMsg:t,setIsChildLoading:c,handleErrManageUser:a,setCanManageAccount:n}),s.jsx(Cc,{showToastMsg:t,setIsChildLoading:c,handleErrManageUser:a})]})}),s.jsx(ns,{hiddenLg:!1,currForm:r,totLen:Ts,bothDisabled:i,...l})]})},Ic=()=>{k();const{showToastMsg:e,canManageAccount:t,currUser:a,handleErrManageUser:n,setCanManageAccount:r,closeToast:l}=hc();return s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-5 sm:gap-y-10",children:[s.jsx("span",{className:"txt__04",children:"Manage your account"}),t?s.jsx(Ec,{currUser:a,showToastMsg:e,handleErrManageUser:n,setCanManageAccount:r}):s.jsx(jc,{handleErrManageUser:n,setCanManageAccount:r,closeToast:l})]})},Pc=()=>{const e=f.useRef(!1),t=Q(),[a]=ae(),n=D(),{showToastMsg:r,handleErrAPI:l}=F(),i=a.get("token"),c=a.get("userId"),o=Ie(c??"",z),d=Ie(i??"",fs),u=o&&d,{mutate:p}=R({mutationFn:m=>qr(m),onSuccess:()=>{r("New Email successfully verified!","SUCCESS"),t.removeQueries({queryKey:["currUser"]}),n("/",{replace:!0})},onError:m=>{l({err:m,push:!0})}});return f.useEffect(()=>{if(u){if(e.current)return;e.current=!0,p({token:i??"",userId:c??""})}},[u,p,i,c]),{canStay:u}},Rc=()=>{const{canStay:e}=Pc();return e?s.jsx(as,{}):s.jsx(G,{to:"/",replace:!0})},ie=({field:e,register:t,errors:a,customValidate:n,indexForm:r})=>{var i,c,o,d;const l=r||r===0?(o=(c=(i=a==null?void 0:a.items)==null?void 0:i[r])==null?void 0:c[e.field.split(".").pop()])==null?void 0:o.message:(d=a==null?void 0:a[e.field])==null?void 0:d.message;return s.jsxs("div",{className:"max-w-full w-full grid grid-cols-1 gap-y-3 justify-items-start",children:[s.jsxs("label",{className:"w-full flex flex-col gap-y-2 justify-start",children:[s.jsx("span",{className:"txt__01",children:e.label}),s.jsx("input",{step:(e==null?void 0:e.type)==="number"?"any":void 0,type:(e==null?void 0:e.type)??"text",...t(e.field,{required:e!=null&&e.required?`${e.label} is required`:!1,pattern:{value:e.reg,message:e.msg},validate:u=>n?n(u):!0}),className:"input__base txt__01",placeholder:(e==null?void 0:e.place)??`Your ${e.label}...`})]}),l&&s.jsx("span",{className:"txt__01 text-red-600",children:l})]})},Ac=({formContext:e})=>{const{register:t,formState:{errors:a}}=e;return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-y-5",children:[s.jsxs("span",{className:"txt__03 el__sub_title_my_restaurants_form",children:[s.jsx(Et,{className:"w-[35px] h-[35px]"}),"Contact"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-y-5 gap-x-10",children:Pi.map(n=>s.jsx(ie,{register:t,errors:a,field:n},n.id))})]})},Dc=({formContext:e})=>{const{register:t,watch:a,formState:{errors:n},trigger:r}=e,l=a("openTime"),i=a("closeTime");f.useEffect(()=>{(()=>{const u=/^0{1,2}:0{1,2}$/;(Ss(i,l)!==0||[l,i].every(m=>u.test(m)))&&(r("openTime"),r("closeTime"))})()},[l,i,r]);const c=d=>{const u=Ss(d,a("openTime"));return u===0&&![d,a("openTime")].every(p=>/^0{1,2}:0{1,2}$/.test(p))?"To keep open 24/7 write 0:0 or 00:00":u>0&&u<4?"You must keep open at least 4 hours (part-time)":!0},o=d=>{const u=Ss(a("closeTime"),d);return u===0&&![d,a("closeTime")].every(p=>/^0{1,2}:0{1,2}$/.test(p))?"To keep open 24/7 write 0:0 or 00:00":u>0&&u<4?"You must keep open at least 4 hours (part-time)":!0};return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-y-5",children:[s.jsxs("span",{className:"txt__03 el__sub_title_my_restaurants_form",children:[s.jsx(Un,{className:"w-[35px] h-[35px]"}),"Opening and closing times"]}),s.jsx("div",{className:"w-full sm:grid grid-cols-2 gap-5",children:Ri.map(d=>s.jsx(ie,{field:d,errors:n,register:t,customValidate:d.field==="closeTime"?c:o},d.id))})]})},Tc=()=>{const[e,t]=f.useState(0),a=()=>e>0?t(i=>i-1):void 0,n=()=>e<Me-1?t(i=>i+1):void 0,r=e===0,l=e===Me-1;return{propsBtns:{currForm:e,handlePrev:a,handleNext:n,isPrevDisabled:r,isNextDisabled:l}}},Ca=({field:e,register:t,valsChosen:a,customValidate:n,currCategory:r})=>{var i;const l=(i=a==null?void 0:a.includes)==null?void 0:i.call(a,e.field);return s.jsxs("label",{className:`w-full max-w-[200px] flex justify-self-center justify-center items-center border-2 rounded-xl py-2 el__flow cursor-pointer ${l?"scale-105 border-orange-500":"border-[#222]"}`,children:[s.jsx("input",{type:"checkbox",value:e.field,...t(r,{validate:c=>n?n(c):!0}),className:"opacity-0 w-0 h-0"}),s.jsx("span",{className:`txt__01 w-full flex justify-center break-all el__flow ${l?"text-orange-500":""}`,children:(e==null?void 0:e.label)??e.field.toUpperCase()})]})},Fc=({formContext:e})=>{var i,c;const{register:t,watch:a,formState:{errors:n}}=e,{propsBtns:r}=Tc(),l=o=>o!=null&&o.length?(o==null?void 0:o.length)>3?"You can chose up to 3 categories for your restaurant":!0:"You must chose at least one category for your restaurant";return s.jsxs("div",{className:"w-full flex flex-col gap-y-5",children:[s.jsx("div",{className:"w-full p-5 overflow-x-hidden",children:s.jsx("div",{className:"grid lg:max-w-full lg:gap-x-10 lg:grid-cols-2 transition-all duration-500 items-start",style:{width:`${Math.ceil(Me)*100}%`,gridTemplateColumns:`repeat(${Me}, 1fr)`,transform:`translateX(-${r.currForm*(100/Math.ceil(Me))}%)`},children:ba.map((o,d)=>s.jsx("div",{className:`transition-all lg:opacity-100 duration-300 grid grid-cols-2 gap-x-10 gap-y-5 ${r.currForm!==d?"opacity-0":"opacity-100"}`,children:o.map(u=>s.jsx(Ca,{register:t,field:u,valsChosen:a("categories"),customValidate:l,currCategory:"categories"},u.id))},d))})}),((i=n==null?void 0:n.categories)==null?void 0:i.message)&&s.jsx("span",{className:"txt__01 -mt-5 text-red-600 pl-5",children:(c=n==null?void 0:n.categories)==null?void 0:c.message}),s.jsx("div",{className:"w-full flex px-5",children:s.jsx(ns,{totLen:Me,...r,hiddenLg:!0})})]})},Mc=({formContext:e})=>s.jsxs("div",{className:"w-full grid grid-cols-1 gap-y-5",children:[s.jsxs("span",{className:"txt__03 el__sub_title_my_restaurants_form",children:[s.jsx($n,{className:"w-[35px] h-[35px]"}),"Restaurant Category"]}),s.jsx(Fc,{formContext:e})]}),kc=({formContext:e})=>{const{register:t,formState:{errors:a}}=e;return s.jsxs("div",{className:"w-full flex flex-col gap-5",children:[s.jsxs("span",{className:"txt__03 el__sub_title_my_restaurants_form",children:[s.jsx(Lt,{className:"h-[35px] w-[35px]"}),"Restaurant name"]}),s.jsx("div",{className:"w-full justify-self-start grid lg:grid-cols-2 gap-y-3 gap-x-10",children:s.jsx(ie,{field:Ii,register:t,errors:a})})]})},Lc=({indexForm:e,setValue:t,images:a,img:n})=>{const r=e||e===0?`items.${e}.images`:"images";return{handleRemoveExistingFile:()=>{const c=[...a].filter(o=>o!==n);t(r,c,{shouldValidate:!0})},handleRemoveExistingImgUploaded:()=>{const c=a.filter(o=>n instanceof File?!0:o.public_id!==(n==null?void 0:n.public_id));t(r,c,{shouldValidate:!0})}}},lt=({img:e,images:t,setValue:a,indexForm:n})=>{const{handleRemoveExistingFile:r,handleRemoveExistingImgUploaded:l}=Lc({img:e,images:t,setValue:a,indexForm:n});return s.jsxs("div",{onClick:e instanceof File?r:l,className:"min-w-[150px] max-w-[150px] h-[150px] sm:min-w-[200px] sm:max-w-[200px] sm:h-[200px] rounded-xl snap-center relative group cursor-pointer",children:[e&&s.jsx("img",{className:"w-full h-full",src:e instanceof File?URL.createObjectURL(e):e==null?void 0:e.url,alt:""}),s.jsx("div",{className:"absolute inset-0 bg-black/70 opacity-0 el__flow group-hover:opacity-100"}),s.jsxs("div",{className:"absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 w-full flex justify-center items-center z-20 gap-4 el__flow opacity-0 pointer-events-none group-hover:pointer-events-auto group-hover:opacity-100  group-hover:scale-120",children:[s.jsx(Vs,{className:"w-[30px] h-[30px] text-red-600"}),s.jsx("span",{className:"txt__01 text-red-600",children:"Remove"})]})]})},it=({register:e,watch:t,indexForm:a})=>{var l;const n=(l=A())==null?void 0:l.pathname,r=a||a===0?`items.${a}.images`:"images";return s.jsx("div",{className:"w-full grid ",children:s.jsxs("label",{className:"w-fit grid relative",children:[s.jsx("input",{type:"file",multiple:!0,className:"opacity-0 absolute outline-none",...e(r,{validate:()=>{const i=t(r);return!(i!=null&&i.length)&&!Al.test(n)&&!Dl.test(n)?"You should upload at least one img":(i==null?void 0:i.length)>5?"You can upload up to 5 images":!0}})}),s.jsxs("button",{type:"button",onClick:i=>{var c,o;(o=(c=i==null?void 0:i.currentTarget)==null?void 0:c.previousElementSibling)==null||o.click()},className:"w-full flex items-center gap-3 group el__flow hover:scale-110 hover:text-orange-500 pl-5 pr-14 py-2 border-[3px] border-orange-500 rounded-xl cursor-pointer justify-self-start outline-none",children:[s.jsx(Vn,{className:"h-[35px] w-[35px]"}),s.jsx("span",{className:"txt__02",children:"Upload"})]})]})})},Oc=({formContext:e})=>{var c;const{register:t,formState:{errors:a},watch:n,trigger:r,setValue:l}=e,i=n("images");return s.jsxs("div",{className:"w-full flex flex-col gap-5",children:[s.jsxs("span",{className:"txt__03 el__sub_title_my_restaurants_form",children:[s.jsx(Ot,{className:"h-[35px] w-[35px]"}),"Restaurant images"]}),s.jsx("div",{className:`w-full flex flex-row overflow-x-auto snap-x snap-mandatory gap-5 sm:gap-10 hide_scrollbar border-[3px] rounded-xl el__flow ${(c=n("images"))!=null&&c.length?"max-h-[500px] p-5 sm:p-8 border-orange-500 ":"max-h-0 border-transparent"}`,children:!!(i!=null&&i.length)&&[...i].map((o,d)=>s.jsx(lt,{img:i[d],trigger:r,images:i,setValue:l},d))}),s.jsx(it,{register:t,watch:n}),(a==null?void 0:a.images)&&s.jsx("span",{className:"txt__01 text-red-600",children:a.images.message})]})},Uc=({formContext:e})=>{const{register:t,formState:{errors:a},watch:n,trigger:r}=e,l=n("price");f.useEffect(()=>{l&&r("freeDeliveryPrice")},[l,r]);const i=o=>{const d=Ke(n("closeTime"))-Ke(n("openTime"));return d>0&&d<+o?"Delivery time can not take more than your business activity":+o?!0:"Delivery time can not be 0"},c=o=>!+n("price")&&o?"You can not set a free delivery without a delivery charge":!0;return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-y-5",children:[s.jsxs("span",{className:"txt__03 el__sub_title_my_restaurants_form",children:[s.jsx(Ye,{className:"w-[40px] h-[40px]"}),"Delivery"]}),s.jsx("div",{className:"w-full grid grid-cols-1 gap-y-5 sm:grid-cols-2 gap-10 lg:grid-cols-3",children:Ai.map(o=>s.jsx(ie,{register:t,errors:a,field:o,customValidate:o.field==="estTimeDelivery"?i:o.field==="freeDeliveryPrice"?c:void 0},o.id))})]})},$c=({currForm:e,formContext:t})=>{const{register:a,formState:{errors:n}}=t;return s.jsx("div",{className:"overflow-hidden py-5",children:s.jsxs("div",{className:"w-[200%] flex transition-all duration-500 justify-items-start items-start h-fit lg:grid lg:grid-cols-2 lg:w-full lg:gap-10",style:{transform:`translateX(-${e*50}%)`,maxHeight:e===0?"600px":"275px"},children:[s.jsx("div",{className:"w-full flex gap-y-5 flex-col max-h-fit px-2 sm:px-5 lg:p-0",children:_a.map(r=>s.jsx(ie,{register:a,errors:n,field:r},r.id))}),s.jsx("div",{className:"w-full flex gap-y-5 flex-col max-h-fit px-2 sm:px-5 lg:p-0",children:wa.map(r=>s.jsx(ie,{register:a,errors:n,field:r},r.id))})]})})},Vc=({formContext:e,currForm:t,setCurrForm:a})=>{const n=A(),[r,l]=f.useState(!1),{watch:i}=e,o=We[t].map(g=>({val:i(g.field),reg:g.reg}));f.useEffect(()=>{(()=>{l(!1);for(const x of o)x.reg.test(x.val)||l(!0)})()},[t,i,o]);const d=()=>t>0?a(g=>g-1):void 0,u=()=>t<Cs-1?a(g=>g+1):void 0,p=t===0,m=r||t===Cs-1;return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-y-5",id:n.pathname.includes("/add-restaurant")?"addressSwapAddRest":"addressSwapUpdateRest",children:[s.jsxs("span",{className:"txt__03 el__sub_title_my_restaurants_form",children:[s.jsx(Ct,{className:"w-[35px] h-[35px]"}),"Restaurant Address"]}),s.jsxs("div",{className:"w-full grid grid-cols-1 border-[3px] rounded-xl border-orange-500 lg:border-0 lg:p-0 p-5 pb-10 gap-y-8",children:[s.jsx($c,{currForm:t,formContext:e}),s.jsx(ns,{handlePrev:d,handleNext:u,isPrevDisabled:p,isNextDisabled:m,currForm:t,totLen:Cs,hiddenLg:!0})]})]})},Ea=({formContext:e,handleSave:t,isPending:a,currFormAddress:n,setCurrFormAddress:r})=>{const l=A();return s.jsxs("form",{onSubmit:t,className:"w-full grid grid-cols-1 justify-items-center gap-y-10",children:[s.jsx(kc,{formContext:e}),s.jsx(Oc,{formContext:e}),s.jsx(Vc,{formContext:e,currForm:n,setCurrForm:r}),s.jsx(Ac,{formContext:e}),s.jsx(Dc,{formContext:e}),s.jsx(Mc,{formContext:e}),s.jsx(Uc,{formContext:e}),s.jsx("div",{className:"w-[250px] sm:w-[325px] justify-center mt-10",children:s.jsx(J,{label:`${l.pathname.includes("update")?"Update":"Create"} Restaurant`,type:"submit",styleTxt:"txt__02",isPending:a})})]})},qc=()=>{k();const e=D(),[t,a]=f.useState(0),{showToastMsg:n,handleErrAPI:r}=F(),l=U({mode:"onChange",defaultValues:{}});f.useEffect(()=>{l.setFocus("name")},[l]);const{mutate:i,isPending:c}=R({mutationFn:d=>Wr(d),onSuccess:d=>{n("Restaurant created successfully","SUCCESS"),e(`/my-restaurants/${d==null?void 0:d.restId}`)},onError:d=>{r({err:d})}}),o=d=>{d.preventDefault();const u=l.getValues();let p=!0,m=0;do{const g=We[m];for(const x in u){const y=g.find(_=>_.field===x);if(y&&!y.reg.test(u[x])){p=!1;break}}if(!p)break;m++}while(m<We.length);if(p){const g=ca(u);i(g)}else{a(m),l.trigger();const g=document.getElementById("addressSwapAddRest"),x=g==null?void 0:g.offsetTop;window.scrollTo({top:x,behavior:"smooth"})}};return s.jsx(re,{...l,children:s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-y-5",children:[s.jsx("span",{className:"txt__04",children:"Create new restaurant"}),s.jsx(Ea,{formContext:l,handleSave:o,isPending:c,currFormAddress:t,setCurrFormAddress:a})]})})},ct=({txt:e,label:t})=>{const a=f.useRef(null),n=f.useRef(null);f.useEffect(()=>{const l=i=>{const c=a.current,o=n.current;c&&o&&c!=null&&c.contains(i.target)&&(o==null||o.classList.remove("generate_password__tooltip"),requestAnimationFrame(()=>o==null?void 0:o.classList.add("generate_password__tooltip")))};return document.addEventListener("click",l),()=>document.removeEventListener("click",l)},[e]);const r=()=>{a.current&&navigator.clipboard.writeText(a.current.innerText)};return s.jsxs("div",{className:"relative group flex items-center max-w-full",children:[s.jsx("button",{type:"button",ref:a,onClick:r,className:"el__flow cursor-pointer hover:text-orange-500 outline-none max-w-full",children:s.jsx("span",{className:"txt__01 block overflow-x-auto hide_scrollbar",children:e})}),s.jsxs("span",{ref:n,className:"absolute lg:text-lg px-4 py-1 -top-full left-1/4 border-2 border-orange-500 rounded-xl w-full whitespace-nowrap bg-[#111] pointer-events-none z-20 txt__00 max-w-fit px-6 min-w-[150px] opacity-0",children:[t," copied ✌🏼"]})]})},ws=({id:e})=>s.jsxs("div",{className:"border-b-2 border-orange-500 w-full grid grid-cols-[75px_1fr] max-w-full",children:[s.jsxs("div",{className:"w-full flex gap-2 items-center px-3 py-2",children:[s.jsx(qn,{className:"text-orange-500 icon__base -ml-2"}),s.jsx("span",{className:"txt__01",children:"ID:"})]}),s.jsx("div",{className:"w-full max-w-full flex items-center",children:s.jsx(ct,{txt:e,label:"Id"})})]}),Y=({isOpen:e,setIsOpen:t,txt:a,Icon:n,closeAllDrop:r,customStyle:l,customIconStyle:i})=>(f.useEffect(()=>{r&&t(!1)},[r,t]),s.jsxs("div",{onClick:()=>t(!e),className:`w-full grid grid-cols-[1fr_65px] items-center group cursor-pointer ${l??""}`,children:[s.jsxs("div",{className:"w-fit flex gap-5 items-center",children:[s.jsx(n,{className:`${i??"icon__base"} group-hover:text-orange-500 el__flow`}),s.jsx("span",{className:"txt__02 group-hover:text-orange-500 el__flow",children:a})]}),s.jsx(Bn,{className:`w-[35px] h-[35px] justify-self-end group-hover:text-orange-500 el__flow ${e?"rotate-180":""}`})]})),de=({el:e,children:t,customStyle:a})=>{var l;const[n,r]=f.useState(!1);return s.jsxs("div",{className:"w-full grid grid-cols-1 el__flow relative",children:[s.jsx(Y,{isOpen:n,setIsOpen:r,txt:e.label,Icon:e.icon,customIconStyle:"min-w-[25px] min-h-[25px]",customStyle:a}),s.jsx("ul",{className:`w-[80%] px-3 right-0 z-60 max-h-fit grid py-1 border-2 border-orange-500 rounded-xl bg-[#111] transition-all duration-500 absolute ${["Categories","Open Hours"].includes(e.label)?"grid-cols-2":" grid-cols-1 gap-1"} ${n?"opacity-100 -translate-y-full pointer-events-auto":"translate-y-full opacity-0 pointer-events-none"}`,children:t??((l=e==null?void 0:e.vals)==null?void 0:l.map((i,c)=>s.jsx("li",{className:"el__flow hide_scrollbar overflow-x-auto",children:s.jsx("span",{className:"txt__01",children:i})},c)))})]})},ke=({el:e,children:t,customStyle:a})=>{var i;const[n,r]=f.useState(!1),l=A();return f.useEffect(()=>{const c=()=>/^\/(my-restaurants)\/[a-f0-9]{24}/.test(l.pathname)&&window.innerWidth>ge.sm?r(!0):null;return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[l.pathname]),s.jsxs("div",{className:"w-full grid grid-cols-1 items-start",children:[s.jsx(Y,{isOpen:n,setIsOpen:r,txt:e.label,Icon:e.icon,customStyle:`py-1 border-b-2 border-orange-500 ${a}`}),s.jsx("ul",{className:`w-full el__flow grid gap-1 gap-2 items-start ${a} ${n?"opacity-100 max-h-[500px] pointer-events-auto pt-2":"opacity-0 max-h-0 pointer-events-none"} ${["Categories","Open Hours"].includes(e.label)?"grid-cols-2":"grid-cols-1"}`,children:t||((i=e==null?void 0:e.vals)!=null&&i.length?e==null?void 0:e.vals.map((c,o)=>s.jsx("li",{className:"el__flow hide_scrollbar overflow-x-auto",children:s.jsx("span",{className:"txt__01",children:c})},o)):null)})]})},Ia=({rest:e,customStyle:t})=>s.jsxs(s.Fragment,{children:[s.jsxs(ke,{el:li,customStyle:t,children:[ri(...e.ordersByStatus).map(a=>s.jsxs("li",{className:"w-full grid grid-cols-[1fr_50px] items-center",children:[s.jsx("span",{className:"txt__01",children:a.label}),s.jsx("span",{className:"txt__01 justify-self-end",children:a.val})]},a.id)),s.jsxs("li",{className:"w-full grid grid-cols-[1fr_50px] items-center",children:[s.jsx("span",{className:"txt__01",children:"Orders count"}),s.jsx("span",{className:"txt__01 justify-self-end",children:e.ordersCount})]})]}),s.jsxs(ke,{el:ha,customStyle:t,children:[ii(...e.reviewsByRating).map(a=>s.jsxs("li",{className:"w-full grid grid-cols-[1fr_50px] items-center",children:[s.jsx("div",{className:"w-full flex gap-2",children:a.stars.map((n,r)=>s.jsx(n,{},r))}),s.jsx("span",{className:"txt__01 justify-self-end",children:a.val})]},a.id)),ja(e.avgRating,e.reviewsCount).map(a=>s.jsxs("li",{className:"w-full grid grid-cols-[1fr_50px] items-center",children:[s.jsx("span",{className:"txt__01",children:a.label}),s.jsx("span",{className:"txt__01 justify-self-end",children:a.field})]},a.id))]}),s.jsx(ke,{el:ya,customStyle:t,children:ci(e.avgPrice,e.avgQuantity,e.dishesCount).map((a,n)=>s.jsxs("li",{className:"w-full grid grid-cols-[1fr_50px] items-center",children:[s.jsx("span",{className:"txt__01",children:a.label}),s.jsx("span",{className:"txt__01 justify-self-end",children:a.field})]},n))})]}),bs=({rest:e,Container:t})=>s.jsxs(s.Fragment,{children:[ei(Object.values(e.address),Object.values(e.contact).slice(0,Object.keys(e.contact).length-1),e.categories).map((a,n)=>s.jsx(t,{el:a},n)),s.jsx(t,{el:si,children:(()=>{var l;const a=ti(...Object.values(e.openHours)),n=[];let r=0;do if(a[r].val===((l=a==null?void 0:a[r+1])==null?void 0:l.val)){n.push(s.jsxs("li",{className:"el__flow overflow-x-auto hide_scrollbar pointer-events-none cursor-pointer flex items-center gap-3 col-span-2",children:[s.jsx(Qn,{className:"w-[25px] h-[25px]"}),s.jsx("span",{className:"txt__01",children:"Always open"})]},r));break}else{const i=a[r].icon;n.push(s.jsxs("li",{className:"el__flow overflow-x-auto hide_scrollbar pointer-events-none cursor-pointer flex items-center gap-3",children:[s.jsx(i,{className:"w-[25px] h-[25px]"}),s.jsx("span",{className:"txt__01",children:a[r].val})]},r)),r++}while(r<a.length);return n})()}),s.jsx(t,{el:ai,children:ni(...Object.values(e.delivery)).map((a,n)=>a.label==="Free meal"&&!a.val?null:s.jsxs("li",{className:"el__flow cursor-pointer grid grid-cols-[120px_1fr]",children:[s.jsx("span",{className:"txt__01",children:a.label}),s.jsx("span",{className:"txt__01 justify-self-end max-w-full overflow-x-auto text-nowrap hide_scrollbar ",children:a.label!=="Time"?Z({price:a.val,showStr:!0}):a.val})]},n))})]}),rs=({images:e})=>s.jsx("div",{className:"w-full flex justify-center",children:s.jsx("div",{className:"w-full overflow-x-auto hide_scrollbar snap-x snap-mandatory flex gap-4 p-4",children:e.map(t=>s.jsx("div",{className:"min-w-[200px] h-[200px] flex justify-center items-center border-2 border-orange-500 overflow-hidden rounded-xl",children:s.jsx("img",{src:t.url,alt:"🧐",className:"w-full h-full object-cover snap-center"})},t.public_id))})}),ot=({name:e})=>s.jsx("div",{className:"w-full flex justify-start h-[50px] bg-black/90 items-center ",children:s.jsx("span",{className:"txt__03 px-3 overflow-x-auto hide_scrollbar",children:e})}),Pa=({images:e,name:t})=>s.jsxs(s.Fragment,{children:[s.jsx(ot,{name:t}),s.jsx(rs,{images:e})]}),Bc=({rest:e})=>{const[t,a]=f.useState(!1);return s.jsxs("div",{className:"card__el_grid border-orange-500",children:[s.jsxs("div",{className:"w-full flex flex-col",children:[s.jsx(ws,{id:e._id}),s.jsx(Pa,{images:e.images,name:e.name}),s.jsxs("div",{className:"w-full grid grid-cols-1",children:[s.jsx(Y,{isOpen:t,setIsOpen:a,txt:"Details",Icon:xs,customStyle:"px-3 border-b-2 border-orange-500 py-1"}),s.jsx("div",{className:`w-full el__flow grid grid-cols-1 gap-3 px-3 ${t?"opacity-100 max-h-[500px] pointer-events-auto pt-3":"opacity-0 max-h-0 pointer-events-none"}`,children:s.jsx(bs,{rest:e,Container:de})}),s.jsx(Ia,{rest:e,customStyle:"px-3"})]})]}),s.jsx("div",{className:"w-full max-w-fit justify-center justify-self-center flex mt-5",children:s.jsx(W,{to:`/my-restaurants/${e._id}`,className:"txt__02 border-2 border-orange-500 rounded-xl px-12 py-1 el__flow hover:text-orange-500 hover:scale-110 cursor-pointer",children:"View Details"})})]})},Ra=[{field:"name",label:"Name"},{field:"id",label:"Id"},{field:"restaurantName",label:"Restaurant name"},{field:"restaurantId",label:"Restaurant id"}].map(e=>({...e,id:j()})),vs=[{field:"minPrice",label:"Min price",reg:Oe,msg:"Price must be a number with up to 2 decimal places"},{field:"maxPrice",label:"Max price",reg:Oe,msg:"Price must be a number with up to 2 decimal places"},{field:"minQuantity",label:"Min quantity",reg:As,msg:"Quantity must be a prime number without decimals"},{field:"maxQuantity",label:"Max quantity",reg:As,msg:"Quantity must be a prime number without decimals"}].map(e=>({...e,id:j(),required:!1,type:"number"})),Aa=[{id:j(),field:"categories",label:"Category",subFields:[...be],icon:ps}],dt=[{field:"createdAtSort",label:"Created at",icon:vt},{field:"updatedAtSort",label:"Updated at",icon:Nt},{field:"priceSort",label:"Price",icon:qs},{field:"quantitySort",label:"Quantity",icon:B}].map(e=>({...e,id:j(),subFields:[...$e.map(t=>({...t,id:j()}))]}));[...vs.map(e=>e.field),...Aa.map(e=>e.field),...dt.map(e=>e.field)];const Qc={search:"",searchVals:["name"],categories:[],minPrice:"",maxPrice:"",minQuantity:"",maxQuantity:"",priceSort:[],quantitySort:[],createdAtSort:[],updatedAtSort:[],page:"1"},Gc=["name","country","state","city"],Da=Gc.map(e=>({field:e,id:j(),label:e[0].toUpperCase()+e.slice(1)})),zc=[{field:"openHours",label:"Open hours",subFields:[{id:j(),field:"openNow",label:"Open now"},{id:j(),field:"closed",label:"Closed"}],icon:It},{field:"avgRatingRange",label:"Avg rating",subFields:[...pa],icon:Ae},{field:"categories",label:"Category",subFields:[...be],icon:ps},{field:"avgPriceRange",label:"Avg price dish",subFields:[...ma],icon:gs}].map(e=>({...e,id:j()})),Yc=[{field:"avgRatingSort",label:"Avg rating",icon:Ae},{field:"avgPriceSort",label:"Avg price dish",icon:Gn},{field:"deliveryTimeSort",label:"Delivery time",icon:Ye},{field:"deliveryPriceSort",label:"Delivery price",icon:Ye},{field:"dishesCountSort",label:"No. of dishes",icon:Bs}].map(e=>({...e,id:j(),subFields:[...$e.map(t=>({...t,id:j()}))]})),Hc={searchVals:["name"],openHours:[],categories:[],avgPriceRange:[],avgRatingRange:[],avgRatingSort:[],avgPriceSort:[],dishesCountSort:[],deliveryTimeSort:[],deliveryPriceSort:[],items:[{searchVal:"name",search:""}],page:"1"};vs.map(e=>({...e,id:j()}));const Kc=dt.filter(e=>["createdAtSort","updatedAtSort","priceSort","quantitySort"].includes(e.field)).map(e=>({...e,id:j(),subFields:[...$e.map(t=>({...t,id:j()}))]})).reverse().sort((e,t)=>e.field==="priceSort"?-1:0),Ta={minPrice:"",maxPrice:"",minQuantity:"",maxQuantity:"",priceSort:[],quantitySort:[],createdAtSort:[],updateAtSort:[]},Wc={id:j(),field:"coupon",label:"Coupon",msg:"Invalid code coupon",reg:bl,place:"Coupon code...",required:!1},Zc=(...e)=>[{label:"Price",val:Z({price:e[0]}),icon:Ut},{label:"Avl quantity",val:e[1],icon:B}].map(t=>({...t,id:j()})),Fa=[{field:"restaurantName",label:"Restaurant name"},{field:"id",label:"Id"}].map(e=>({...e,id:j()})),Xc=[...Ue].map(e=>({field:e,id:j(),label:e[0].toUpperCase()+e.slice(1)})),Jc=[{field:"ordersStatus",label:"Orders status",subFields:Xc,icon:B,id:j()}],eo=[{field:"createdAtSort",label:"Created at",icon:B},{field:"updatedAtSort",label:"Updated at",icon:B},{field:"priceSort",label:"Tot Price order",icon:gs},{field:"discountSort",label:"Discount order",icon:$t}],so=eo.map(e=>({...e,id:j(),subFields:[...$e.map(t=>({...t,id:j()}))]})),Ma={search:"",searchVals:["restaurantName"],ordersStatus:[],createdAtSort:[],updatedAtSort:[],priceSort:[],discountOrder:[],quantitySort:[],page:"1"},ka=[{field:"id",label:"id"},{field:"restaurantId",label:"restaurant id"},{field:"restaurantName",label:"Restaurant name"},{field:"country",label:"Country"},{field:"state",label:"State"},{field:"city",label:"City"}].map(e=>({...e,id:j()}));vs.map(e=>({...e,id:j()}));const to=[...Ue].map(e=>({field:e,id:j(),label:e[0].toUpperCase()+e.slice(1)})),ao=[{field:"ordersStatus",label:"Orders status",subFields:to,icon:B},{field:"categories",label:"Category",subFields:[...be],icon:ps}].map(e=>({...e,id:j()})),no=[{field:"createdAtSort",label:"Created at",icon:pt},{field:"updatedAtSort",label:"Updated at",icon:pt},{field:"priceSort",label:"Tot Price order",icon:gs},{field:"quantitySort",label:"Tot quantity order",icon:B},{field:"discountSort",label:"Discount order",icon:$t}].map(e=>({...e,id:j(),subFields:[...$e.map(t=>({...t,id:j()}))]})),La={search:"",searchVals:["restaurantName"],ordersStatus:[],categories:[],createdAtSort:[],updatedAtSort:[],priceSort:[],quantitySort:[],discountSort:[],minPrice:"",maxPrice:"",minQuantity:"",maxQuantity:"",page:"1"},Oa=e=>{let t="",a=[];return He.test(e)&&(t="restaurant",a=Da),Hs.test(e)&&(t="restaurant",a=xa),ys.test(e)&&(t="dish",a=Ra),Ks.test(e)&&(t="order",a=Fa),es.test(e)&&(t="order",a=ka),{target:t,arrToCheck:a}},Ua=({searchVals:e,customFilter:t})=>{var o,d,u;const[a,n]=f.useState(""),r=A().pathname,{target:l,arrToCheck:i}=Oa(r),c=t?t(i):(u=(d=(o=i.filter(p=>p.field===e))==null?void 0:o[0])==null?void 0:d.label)==null?void 0:u.toLowerCase();return f.useEffect(()=>{const p=()=>{window.innerWidth>ge.sm?n(`Search a ${l}${c?` by ${c}`:""}...`):n(`${c[0].toUpperCase()+c.slice(1)}...`)};return p(),window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[l,c]),{place:a}},ro=({formContext:e})=>{var c,o;const{register:t,formState:{errors:a},watch:n,trigger:r}=e,l=(c=n("searchVals"))==null?void 0:c[0],{place:i}=Ua({searchVals:l});return f.useEffect(()=>{var d;(d=a==null?void 0:a.search)!=null&&d.message&&!["id","restaurantId"].includes(l)&&r("search")},[r,l,a]),s.jsxs("div",{className:"w-full flex flex-col gap-3",children:[s.jsxs("label",{className:"w-full grid grid-cols-1 justify-items-start gap-2 relative",children:[s.jsx("input",{type:"text",placeholder:i,className:"focus__base el__flow outline-none border-2 border-orange-500 rounded-full w-full px-5 pr-14 py-2 txt__01",...t("search",{pattern:{value:hs,message:"Invalid search length or chars 🥸"},validate:d=>["restaurantId","id"].includes(l)&&!z.test(d)?"Invalid Mongo ID":!0})}),s.jsx(Vt,{className:"absolute top-1/2 -translate-y-1/2 right-[20px] w-[25px] h-[25px] text-orange-500 pointer-events-none"})]}),(a==null?void 0:a.search)&&s.jsx("span",{className:"txt__01 text-red-600",children:(o=a==null?void 0:a.search)==null?void 0:o.message})]})},$a=({formContext:e,field:t,closeAllDrop:a})=>{const[n,r]=f.useState(!1),{register:l,watch:i}=e;return s.jsxs("div",{className:"w-full grid grid-cols-1",children:[s.jsx(Y,{isOpen:n,setIsOpen:r,txt:t.label,Icon:t.icon,closeAllDrop:a}),s.jsx("div",{className:`w-full grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))]  gap-5 transition-all duration-300 ${n?"max-h-[700px] opacity-100 pointer-events-auto py-3":"opacity-0 max-h-0 pointer-events-none"}`,children:t.subFields.map(c=>s.jsx(Ca,{register:l,field:c,valsChosen:i(t.field),currCategory:t.field},c.id))})]})},Va=({register:e,el:t,watch:a,handleChange:n})=>{const r=a("searchVals"),l=Array.isArray(r)?r:[];return s.jsxs("div",{className:"w-full grid grid-cols-2 items-center px-2",children:[s.jsx("span",{className:"txt__01",children:t.label}),s.jsxs("label",{className:"w-[100px] h-[40px] rounded-full check_swap__label justify-self-center relative cursor-pointer",children:[s.jsx("input",{value:t.field,type:"checkbox",className:"opacity-0",...e("searchVals"),onChange:()=>n&&n(t.field)}),s.jsx("span",{className:`absolute w-[40px] h-[40px] top-0 left-0 rounded-full check_swap__swap scale-90 transition-all duration-500 ${l.includes(t.field)?"translate-x-[60px]":"translate-x-0"}`,style:{"--color-swap":l.includes(t.field)?"#16A34A":"#DC2626"}})]})]})},lo=({searchFields:e,formContext:t,closeAllDrop:a})=>{const[n,r]=f.useState(!1),{register:l,watch:i,setValue:c,setError:o}=t,d=u=>{(i("searchVals")||[]).includes(u)?c("searchVals",[],{shouldValidate:!0}):c("searchVals",[u],{shouldValidate:!0}),["id","restaurantId"].includes(u)&&!z.test(i("search"))&&o("search",{message:"Invalid Mongo ID"})};return s.jsxs("div",{className:"w-full grid grid-cols-1",children:[s.jsx(Y,{isOpen:n,setIsOpen:r,txt:"Text",Icon:qt,closeAllDrop:a}),s.jsx("div",{className:`w-full grid grid-cols-[repeat(auto-fit,minmax(250px,1fr))] gap-5 transition-all duration-300 ${n?"max-h-[700px] opacity-100 pointer-events-auto py-2":"opacity-0 max-h-0 pointer-events-none"}`,children:!!(e!=null&&e.length)&&e.map(u=>s.jsx(Va,{register:l,el:u,watch:i,handleChange:d},u.id))})]})},qa=({formContext:e,closeAllDrop:t})=>{const{register:a,formState:{errors:n},watch:r,trigger:l}=e,[i,c]=f.useState(!1),o=r("minPrice"),d=r("maxPrice");f.useEffect(()=>{(+o<=+d||!d)&&(l("minPrice"),l("maxPrice"))},[l,o,d]);const u=_=>d&&+d<+_?"With max price fewer than min one you will get no results":!0,p=_=>_&&o>+_?"With min price greater than max one you will get no results":!0,m=r("minQuantity"),g=r("maxQuantity");f.useEffect(()=>{(+m<=+g||!g)&&(l("minQuantity"),l("maxQuantity"))},[l,m,g]);const x=_=>g&&+g<+_?"With max quantity fewer than min one you will get no results":!0,y=_=>_&&m>+_?"With min quantity greater than max one you will get no results":!0;return s.jsxs("div",{className:"w-full grid grid-cols-1",children:[s.jsx(Y,{isOpen:i,setIsOpen:c,txt:"Stats",Icon:zn,closeAllDrop:t}),s.jsx("div",{className:`w-full grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5 transition-all duration-300 ${i?"max-h-[7000px] opacity-100 pointer-events-auto py-2":"opacity-0 max-h-0 pointer-events-none"}`,children:vs.map(_=>s.jsx(ie,{field:_,register:a,errors:n,customValidate:_.field==="minPrice"?u:_.field==="maxPrice"?p:_.field==="minQuantity"?x:_.field==="maxQuantity"?y:void 0},_.id))})]})},io=({searchFields:e,formContext:t,filters:a,closeAllDrop:n})=>{const[r,l]=f.useState(!1),i=A();return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-3 mt-5",children:[s.jsx(Y,{txt:"Filter by",Icon:Bt,isOpen:r,setIsOpen:l,customStyle:"pb-1 border-b-[3px] border-orange-500",closeAllDrop:n}),s.jsxs("div",{className:`w-full grid grid-cols-1 pb-3 transition-all duration-300 gap-2 ${r?"max-h-[2000px] opacity-100 pointer-events-auto":"opacity-0 max-h-0 pointer-events-none -z-10"}`,children:[!!(e!=null&&e.length)&&s.jsx(lo,{formContext:t,searchFields:e,closeAllDrop:n}),(ys.test(i.pathname)||Re.test(i.pathname)||es.test(i.pathname))&&s.jsx(qa,{formContext:t,closeAllDrop:n}),!!(a!=null&&a.length)&&a.map(c=>s.jsx($a,{field:c,formContext:t,closeAllDrop:n},c.id))]})]})},co=({el:e,currSorter:t,register:a,currVals:n,handleChange:r,customStyle:l})=>s.jsxs("label",{className:`w-full max-w-[65px] py-3 px-8 pr-10 border-2 rounded-xl cursor-pointer group flex justify-center items-center el__flow relative justify-self-center ${(n||[]).includes(e.field)?"border-orange-500 scale-110":"border-[#333] scale-100"} ${l??""}`,children:[s.jsx("input",{value:e.field,type:"checkbox",className:"opacity-0 absolute inset-0 w-full h-full cursor-pointer",...a(`${t}`),onChange:()=>r(e.field)}),s.jsx(e.icon,{className:`icon__base el__flow pointer-events-none ${(n||[]).includes(e.field)?"text-orange-500":""}`})]},e.id),oo=({formContext:e,sorter:t,closeAllDrop:a})=>{const{register:n,watch:r,setValue:l}=e,[i,c]=f.useState(!1),o=d=>l(t.field,(r(t.field)||[]).includes(d)?r(t.field).filter(u=>u!==d):[d],{shouldValidate:!0});return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-y-3",children:[s.jsx(Y,{isOpen:i,setIsOpen:c,txt:t.label,Icon:t.icon,closeAllDrop:a}),s.jsx("div",{className:`w-full grid grid-cols-2 el__flow ${i?"max-h-[700px] opacity-100 pointer-events-auto py-2":"opacity-0 max-h-0 pointer-events-none"}`,children:t.subFields.map((d,u)=>s.jsx(co,{el:d,register:n,currSorter:t.field,currVals:r(t.field),handleChange:o,customStyle:""},d.id))})]})},Ba=({formContext:e,sorters:t,closeAllDrop:a})=>{const[n,r]=f.useState(!1);return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-3",children:[s.jsx(Y,{txt:"Sort by",Icon:Yn,isOpen:n,setIsOpen:r,closeAllDrop:a,customStyle:"pb-1 border-b-[3px] border-orange-500"}),s.jsx("div",{className:`w-full items-start grid sm:grid-cols-[repeat(auto-fit,minmax(300px,1fr))] transition-all duration-300 gap-4 ${n?"max-h-[2000px] opacity-100 pointer-events-auto":"opacity-0 max-h-0 pointer-events-none"}`,children:!!(t!=null&&t.length)&&t.map(l=>s.jsx(oo,{formContext:e,sorter:l,closeAllDrop:a},l.id))})]})},ls=({searchFields:e,formContext:t,sorters:a,filters:n,handleSave:r,handleClear:l,isPending:i,closeAllDrop:c,id:o})=>{const d=A().pathname,u=!Re.test(d);return t?s.jsxs("form",{className:`w-full max-w-[90%] border-[3px] border-orange-500 rounded-xl p-6 ${u?"":"pt-0"}`,id:o,children:[s.jsxs("div",{className:"w-full grid grid-cols-1",children:[u&&s.jsx(ro,{formContext:t}),s.jsx(io,{formContext:t,searchFields:e,filters:n,closeAllDrop:c}),s.jsx(Ba,{formContext:t,sorters:a,closeAllDrop:c})]}),s.jsxs("div",{className:"w-full grid grid-cols-2 mt-5",children:[s.jsx("div",{className:"sm:w-full justify-self-start w-[30vw] sm:max-w-[200px] sm:justify-self-center",children:s.jsx(le,{type:"submit",label:"Search",styleBtn:"border-green-600",styleTxt:"text-green-600 txt__02",handleClick:r,isPending:i})}),s.jsx("div",{className:"sm:w-full justify-self-end w-[30vw] sm:max-w-[200px] sm:justify-self-center",children:s.jsx(le,{type:"button",label:"Clear",styleBtn:"border-red-600",styleTxt:"text-red-600 txt__02",handleClick:l,isDisabled:i})})]})]}):null},uo=({totPages:e})=>{const[t,a]=f.useState(3),[n,r]=f.useState(1),l=f.useRef(null);f.useEffect(()=>{const y=()=>a(window.innerWidth>ge._2xl?12:window.innerWidth>ge.lg?10:window.innerWidth>ge.md?8:window.innerWidth>ge.sm?5:3);return y(),window.addEventListener("resize",y),()=>window.removeEventListener("resize",y)},[]);const i=Math.min(t,e-(n-1)*t),c=n===1,o=n*t>=e,d=Array.from({length:i},(y,_)=>_+1+(n-1)*t),u=()=>o?null:r(n+1),p=()=>c?null:r(n-1),m=()=>{l.current||(l.current=setInterval(()=>{r(y=>y===1?(x(),y):y-1)},150))},g=()=>{l.current||(l.current=setInterval(()=>{r(y=>y*t>=e?(x(),y):y+1)},150))},x=()=>{l.current&&(clearInterval(l.current),l.current=null)};return f.useEffect(()=>()=>x(),[]),{handleNext:u,handlePrev:p,isPrevDisabled:c,isNextDisabled:o,arrToMakeBtns:d,handlePrevInterval:m,handleNextInterval:g,clearIntervalHandler:x,blockSize:t,currBlock:n}},qe=({totPages:e=0,currPage:t,setCurrPage:a})=>{const{handleNext:n,handlePrev:r,arrToMakeBtns:l,isPrevDisabled:i,isNextDisabled:c,handlePrevInterval:o,handleNextInterval:d,clearIntervalHandler:u,blockSize:p,currBlock:m}=uo({totPages:e});return!!e&&s.jsx("div",{className:"w-[95%] flex flex-col items-center absolute bottom-10",children:s.jsxs("div",{className:"w-full grid grid-cols-[50px_1fr_50px] items-center",children:[m>1?s.jsx("button",{disabled:i,onClick:r,onMouseDown:o,onMouseUp:u,className:"w-full flex items-center justify-center btn__brand",children:s.jsx(Hn,{className:"h-[50px] w-[50px] "})}):s.jsx("div",{className:""}),s.jsx("div",{className:"max-w-full flex items-center justify-around",children:l.map(g=>s.jsx("button",{onClick:()=>a(g),className:`${t===g?"text-orange-500 border-orange-500 scale-120":"text-white"} btn__brand txt__02 border-2 rounded-xl px-4 py-1`,children:g},g))}),m<Math.ceil(e/p)&&s.jsx("button",{disabled:c,onClick:n,onMouseDown:d,onMouseUp:u,className:"w-full flex items-center justify-center btn__brand",children:s.jsx(Kn,{className:"h-[50px] w-[50px] "})})]})})},is=({nHits:e,totDocuments:t,search:a,searchVal:n})=>{var d;const r=A().pathname,l=ys.test(r)?"dishes":[Hs,He].some(u=>u.test(r))?"restaurants":Re.test(r)?"dishes":Ks.test(r)||es.test(r)?"orders":null,{arrToCheck:i}=Oa(r),c=(d=i==null?void 0:i.filter(u=>u.field===n))==null?void 0:d[0];let o;return a&&(["country","state","city"].includes(c==null?void 0:c.field)&&(o=` in ${a}`),["name","id","restaurantName","restaurantId"].includes(c==null?void 0:c.field)&&(o=` for ${a}`)),s.jsx("div",{className:"w-full grid grid-cols-1",children:t?e?s.jsxs("div",{className:"w-full flex gap-5 items-center mt-[25px]",children:[s.jsx(Qt,{className:"min-w-[35px] min-h-[35px]"}),s.jsxs("div",{className:"w-fit flex gap-2 items-center",children:[s.jsxs("span",{className:"txt__04",children:[e," "]}),s.jsxs("span",{className:"txt__03",children:["Result",e>1?"s":"",o]})]})]}):s.jsx("div",{className:"w-full flex justify-self-center justify-center items-center mt-[50px]",children:s.jsxs("span",{className:"txt__03",children:["Results Number(new String()) 🥸",o]})}):s.jsx("div",{className:"w-full flex justify-self-center justify-center mt-[50px]",children:s.jsx("span",{className:"txt__03",children:He.test(r)?"Good news, there are not restaurants available so you could be the first that could create one ✌🏼":Re.test(r)?"This restaurant does not have dishes right now, they are strategically preparing 🧐":`You have Number(Array().fill()+Array().fill()) ${l} 🥸`})})})},mo=(e,t)=>{const a=A().pathname;return f.useEffect(()=>{const n=()=>{const r=window.innerWidth;[He,Re].some(l=>l.test(a))||(r>1250?t(9):(r>835,t(6)))};return n(),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[e,t,a]),{limit:e}},Be=({formCtx:e,key:t,cbAPI:a,cbProcessForm:n})=>{const[r,l]=f.useState(1),[i,c]=f.useState(5),[o,d]=f.useState(!1),u=A().pathname,[p,m]=f.useState(!1),[g,x]=f.useState(null);f.useEffect(()=>{const te=setTimeout(()=>{m(!0)},1500);return()=>clearTimeout(te)},[]);const y=Q();mo(i,c);const{handleSubmit:_,reset:h,trigger:w}=e;let b=null,v=null;if(Hs.test(u))b=Jl,v="searchBarMyRest";else if(ys.test(u))b=Qc,v="searchBarMyDishes";else if(He.test(u))b=Hc,v="searchBarAllUsers";else if(Re.test(u))b=Ta,v="searchBarDishesAsUser";else if(Ks.test(u))b=Ma,v="searchBarMyOrders";else if(es.test(u))b=La,v="searchBarManageOrders";else throw new Error("Invalid path");const N=_(te=>{te.page=r+"",sessionStorage.setItem(t,JSON.stringify(te)),y.removeQueries({queryKey:[t]})}),C=()=>{sessionStorage.removeItem(t),h(b),l(1),w(),y.resetQueries({queryKey:[t]})},S=Wn({control:e.control}),I=f.useMemo(()=>({...S,page:r+"",limit:i+""}),[r,i,S]);f.useEffect(()=>{if(!p)return;const te=Cr.debounce(me=>{x(me)},500);return te(I),()=>te.cancel()},[p,I]);const q=f.useMemo(()=>g||I,[g,I]),{data:$,isPending:ce,isSuccess:oe,isError:O,error:T}=ne({queryKey:[t,q],queryFn:()=>a(n?n(q):Ml(q))}),{handleErrAPI:se}=je(),we=f.useCallback(()=>{O&&se({err:T}),oe&&($==null?void 0:$.nHits)<i&&l(1)},[O,oe,T,se,$,i,l]);return f.useEffect(()=>{we()},[we]),{formVals:I,handleSave:N,handleClear:C,limit:i,propsBlock:{currPage:r,setCurrPage:te=>{d(!0),l(te),setTimeout(()=>{var Ee;const me=document.getElementById(v),os=me==null?void 0:me.offsetTop;window.scrollTo({top:(os??0)+(((Ee=me==null?void 0:me.getBoundingClientRect())==null?void 0:Ee.height)??0),behavior:"smooth"})},100)}},closeAllDrop:o,setCloseAllDrop:d,data:$,isSuccess:oe,isPending:ce,isError:O,error:T,id:v}},po=({err:e})=>{var t,a;return s.jsx("div",{className:"w-full flex flex-col h-[30vh] justify-center items-center",children:s.jsxs("div",{className:"w-full flex gap-5 items-center justify-center",children:[s.jsx(Gt,{className:"min-w-[40px] min-h-[40px] text-red-600"}),s.jsx("span",{className:"txt__03",children:((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.msg)||(e==null?void 0:e.message)||"Our hamster-powered servers took a break, try later 🐹."})]})})},X=({canStay:e,isPending:t,isError:a,error:n,children:r})=>{var l,i;return typeof e=="boolean"&&!e?s.jsx(G,{to:"/",replace:!0}):t||ta.includes(((i=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:i.msg)??"")?s.jsx(as,{}):a?s.jsx(po,{err:n}):r},xo=()=>{k();const{formContextMyRestaurants:e}=ue(),{watch:t}=e,a=t("searchVals"),n=t("search"),{handleSave:r,handleClear:l,propsBlock:i,data:c,isPending:o,isError:d,error:u,isSuccess:p,closeAllDrop:m,id:g}=Be({formCtx:e,key:"myRestaurantsSearch",cbAPI:Zr}),{restaurants:x,totDocuments:y=0,totPages:_=0,nHits:h=0}=c??{};return s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-5",children:[s.jsx("span",{className:"txt__04",children:"My Restaurants"}),s.jsx(re,{...e,children:s.jsx(ls,{searchFields:xa,sorters:Xl,filters:ga,formContext:e,handleSave:r,handleClear:l,isPending:o,closeAllDrop:m,id:g})}),p&&s.jsx(is,{nHits:h,totDocuments:y,search:n,searchVal:a==null?void 0:a[0]}),s.jsx(X,{isPending:o,isError:d,error:u,children:!!(x!=null&&x.length)&&s.jsx("div",{className:"container__cards__grid",children:x==null?void 0:x.map(w=>s.jsx(Bc,{rest:w},w._id))})}),s.jsx(qe,{...i,totPages:_})]})},Qa=()=>{var u;const{popup:e,setPopup:t}=Te(),{showToastMsg:a,handleErrAPI:n}=F(),r=(u=pe())==null?void 0:u.restId,l=D(),{mutate:i,isPending:c}=R({mutationFn:()=>(t({...e,isPending:!0}),el(r??"")),onSuccess:()=>{a("Restaurant deleted","SUCCESS"),l("/my-restaurants",{replace:!0})},onError:p=>{n({err:p})},onSettled:()=>t(null)}),o=()=>{i()};return{handleClickToOpenPopup:()=>{t({txt:"delete this restaurant?",redLabel:"Delete restaurant",isPending:c,confirmAction:o})}}},go=()=>{const{restId:e}=pe(),t=D(),[a,n]=f.useState(0),r=z.test(e??""),{showToastMsg:l,handleErrAPI:i}=F(),c=U({mode:"onChange"});f.useEffect(()=>{c.setFocus("name")},[c]);const{data:o,isPending:d,isSuccess:u,isError:p,error:m}=ne({queryFn:()=>Xr(e??""),queryKey:["infoMyRestaurant"],enabled:r});f.useEffect(()=>{if(p)i({err:m});else if(u){const{restaurant:h}=o??{};c.setValue("name",(h==null?void 0:h.name)??""),c.setValue("images",(h==null?void 0:h.images)??[]),c.setValue("categories",(h==null?void 0:h.categories)??[]);for(const w in h==null?void 0:h.address)c.setValue(`${w}`,h==null?void 0:h.address[w]);for(const w in h==null?void 0:h.contact)c.setValue(`${w}`,h==null?void 0:h.contact[w]);for(const w in h==null?void 0:h.delivery)c.setValue(`${w}`,h==null?void 0:h.delivery[w]);for(const w in h==null?void 0:h.openHours)c.setValue(`${w}`,Ds(h==null?void 0:h.openHours[w]))}},[m,p,i,u,o,c]);const{mutate:g,isPending:x}=R({mutationFn:({id:h,formData:w})=>Jr({id:h,formData:w}),onSuccess:h=>{l("Restaurant updated","SUCCESS"),t(`/my-restaurants/${h==null?void 0:h.restId}`)},onError:h=>{i({err:h})}}),y=h=>{h==null||h.preventDefault(),h.preventDefault();const w=c.getValues();let b=!0,v=0;do{const N=We[v];for(const C in w){const S=N.find(I=>I.field===C);if(S&&!S.reg.test(w[C])){b=!1;break}}if(!b)break;v++}while(v<We.length);if(b){const N=ca(w);g({formData:N,id:e??""})}else{n(v),c.trigger();const N=document.getElementById("addressSwapUpdateRest"),C=N==null?void 0:N.offsetTop;window.scrollTo({top:C,behavior:"smooth"})}},{handleClickToOpenPopup:_}=Qa();return{formContext:c,canStay:r,isPendingInfo:d,handleSave:y,isPendingUpdate:x,handleClickToOpenPopup:_,isErrorInfo:p,isSuccessInfo:u&&Object.keys((o==null?void 0:o.restaurant)??{}).length,errorInfo:m,currFormAddress:a,setCurrFormAddress:n}},fo=()=>{k();const{formContext:e,canStay:t,isPendingInfo:a,handleSave:n,isPendingUpdate:r,handleClickToOpenPopup:l,isErrorInfo:i,errorInfo:c,currFormAddress:o,setCurrFormAddress:d}=go();return s.jsx(X,{isPending:a,isError:i,error:c,canStay:t,children:s.jsx(re,{...e,children:s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-y-5",children:[s.jsx("span",{className:"txt__04",children:"Update your restaurant"}),s.jsx("div",{className:"w-fit justify-self-end",children:s.jsx(Se,{txt:"Delete restaurant",handleDelete:l})}),s.jsx(Ea,{formContext:e,handleSave:n,isPending:r,currFormAddress:o,setCurrFormAddress:d})]})})})},ho=()=>{const{isLogged:e}=L(),{handleErrAPI:t}=je(),{setCartLogged:a}=ye(),{data:n,isPending:r,isError:l,isSuccess:i,error:c}=ne({queryKey:["myCart"],queryFn:dl,enabled:e});f.useEffect(()=>{l&&t({err:c}),i&&a(n==null?void 0:n.cart)},[n,r,l,i,c,t,a])},yo=()=>{var m,g;const e=Q(),{isLogged:t}=L(),{cartNonLogged:a,cart:n,setCartNonLogged:r}=ye(),{setInfoPop:l}=Fe(),{handleErrAPI:i,showToastMsg:c}=F(),{mutate:o}=R({mutationFn:x=>jl(x),onSuccess:()=>{r(null),c("Cart saved","SUCCESS"),e.removeQueries({queryKey:["myCart"]})},onError:x=>i({err:x}),onSettled:()=>l(null)}),d=f.useCallback(()=>{l(x=>({...x,isPendingConfirm:!0})),o(a)},[o,l,a]),u=f.useCallback(()=>{r(null),c("Get it ✌🏼","SUCCESS"),l(null)},[l,r,c]),p=f.useCallback(()=>{var x,y;t&&!((x=n==null?void 0:n.items)!=null&&x.length)&&((y=a==null?void 0:a.items)!=null&&y.length)&&l({msg:"Do you want to keep ordering with current cart in storage ?",confirmActMsg:"Keep current cart",confirmActCb:d,cancelActMsg:"Start new one",cancelActCb:u})},[l,t,d,u,(m=n==null?void 0:n.items)==null?void 0:m.length,(g=a==null?void 0:a.items)==null?void 0:g.length]);f.useEffect(()=>{p()},[p])},jo=()=>{const e=Q(),{isLogged:t}=L(),{cartNonLogged:a,cart:n,setCartNonLogged:r}=ye(),{setInfoPop:l}=Fe(),{handleErrAPI:i,showToastMsg:c}=F(),{mutate:o}=R({mutationFn:m=>(l(g=>({...g,isPendingConfirm:!0})),yl(m)),onSuccess:()=>{e.removeQueries({queryKey:["myCart"]}),c("Cart replaced","SUCCESS"),r(null)},onError:m=>{i({err:m})},onSettled:()=>{l(null)}}),d=()=>o(a),u=()=>{r(null),setTimeout(()=>{l(null)},0),c("Previous cart kept","SUCCESS")},p=f.useCallback(()=>{var m,g;t&&((m=n==null?void 0:n.items)!=null&&m.length)&&((g=a==null?void 0:a.items)!=null&&g.length)&&l({msg:"You already have a saved cart, do you prefer replace it with new one or keep existing one ?",confirmActMsg:"Replace with new one",confirmActCb:d,cancelActMsg:"Keep existing one",cancelActCb:u})},[t,n,a,l]);f.useEffect(()=>{p()},[p])},_o=()=>{const{setCurrUser:e,isLogged:t}=L(),{handleErrAPI:a}=je(),{data:n,isSuccess:r,isError:l,error:i}=ne({queryKey:["currUser",t],queryFn:Lr});f.useEffect(()=>{(()=>{if(l)a({err:i});else if(r){const{user:o={}}=n??{};V(o)&&e({user:o})}})()},[l,r,a,i,e,n,t])},wo=()=>{_o(),ho(),jo(),yo()},bo=()=>{const[e,t]=f.useState(!1),a=f.useRef(null),n=f.useRef(null),r=D();return f.useEffect(()=>{const d=u=>{a.current&&!a.current.contains(u.target)&&t(!1)};return document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[]),{toggleDrop:()=>t(d=>!d),dropOpen:e,dropRef:a,handleSideClick:(d,u)=>{r(d,u?{state:{from:u}}:void 0),t(!1)},handleMouseEnter:()=>{window.innerWidth<ge.md||(n.current&&clearTimeout(n.current),t(!0))},handleMouseLeave:()=>{window.innerWidth<ge.md||(n.current=setTimeout(()=>{t(!1)},250))}}},Ga=({isLogged:e,children:t})=>{const a=A(),[n]=ae(),r=n.get("type"),{toggleDrop:l,dropOpen:i,dropRef:c,handleSideClick:o,handleMouseEnter:d,handleMouseLeave:u}=bo(),p=e?Mi:Na;return s.jsxs("div",{ref:c,className:"flex items-center justify-center cursor-pointer relative",children:[s.jsx("div",{onMouseEnter:d,onMouseLeave:u,onClick:l,className:`txt__01 ${e?"el__flow hover:text-orange-500 hover:scale-120 border-2 py-1 px-2 rounded-xl":""}`,children:e?sessionStorage.getItem("initName")??"":s.jsx(Mt,{className:"w-[37.5px] h-[37.5px] el__flow hover:text-orange-500 hover:scale-120"})}),s.jsx("div",{onMouseEnter:d,onMouseLeave:u,className:`absolute border-2 border-orange-500 bg-[#111] -top-full -right-full h-fit w-fit rounded-xl z-10 el__flow  ${i?"translate-y-[40%] opacity-100":"opacity-0 translate-y-0 pointer-events-none"}`,children:s.jsxs("div",{className:"w-full flex flex-col items-start",children:[p.map(m=>s.jsxs("button",{onClick:()=>o(m.path,(m==null?void 0:m.from)??""),className:`min-w-[300px] w-full flex gap-3 border-b-orange-500 border-b-2 pl-3 pr-10 py-3 justify-start group cursor-pointer hover:text-orange-500 ${da({location:a,el:m,type:r})?"text-orange-500":""}`,children:[s.jsx(m.svg,{className:"svg__drop"}),s.jsx("span",{className:"txt__01 el__flow",children:m.label})]},m.id)),t??null]})})]})},za=()=>{const{showToastMsg:e}=he(),{setUserLogged:t}=L(),a=D(),{mutate:n,isPending:r}=R({mutationFn:()=>nl(),onSuccess:()=>{e("Logout successful","SUCCESS")},onError:l=>{var i,c;e(((c=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:c.msg)||(l==null?void 0:l.message),"ERROR")},onSettled:()=>{t(!1),a("/",{replace:!0})}});return{isPending:r,mutate:n}},vo=()=>{const{mutate:e,isPending:t}=za(),a=()=>{e()};return s.jsx(Ga,{isLogged:!0,children:t?s.jsx("div",{className:"h-[50px] w-full flex items-center justify-start pl-5",children:s.jsx(_e,{})}):s.jsxs("button",{onClick:a,className:"w-full cursor-pointer flex gap-3 pl-3 pr-10 py-3 justify-start group",children:[s.jsx(zt,{className:"svg__drop"}),s.jsx("span",{className:"txt__01 group-hover:text-orange-500 duration-300 transition-all",children:"Logout"})]})})},No=()=>s.jsx(Ga,{isLogged:!1}),So=()=>{const{isLogged:e}=L(),{isOpenSide:t,setIsOpenSide:a}=zs(),{cart:n,cartNonLogged:r}=ye(),i=A().pathname!=="/notice-email-sent",c=e?n:r;return s.jsx("div",{className:"sticky top-0 left-0 h-fit min-h-[75px] w-full border-b-3 border-orange-500 bg-[#111] pad__page flex items-center header__i",children:s.jsxs("div",{className:"w-full grid grid-cols-[repeat(auto-fit,minmax(150px,1fr))] sm:grid-cols-2 py-2 gap-2",children:[s.jsx(W,{className:"txt__05 text-orange-500 max-w-fit",to:"/",children:"MERN__EAT"}),i&&s.jsxs("div",{className:"flex w-full gap-5 items-center justify-end",children:[V(c)&&(c==null?void 0:c.totQty)&&s.jsxs(W,{to:`/search/${c==null?void 0:c.restaurant}`,className:"group relative el__flow hover:scale-110",children:[s.jsx("span",{className:"absolute border-2 px-2 border-orange-500 text-orange-500 rounded-full bg-[#000] -top-3 -right-2",children:c.totQty}),s.jsx(Yt,{className:"min-w-[35px] min-h-[35px] group-hover:text-orange-500 el__flow"})]}),e?s.jsx(vo,{}):s.jsx(No,{}),t?s.jsx("div",{onClick:()=>a==null?void 0:a(!1),className:"max-w-fit justify-self-end group flex items-center",children:s.jsx(Ce,{className:"svg__header"})}):s.jsx("div",{onClick:()=>a==null?void 0:a(!0),className:"max-w-fit justify-self-end group flex items-center",children:s.jsx(Zn,{className:"svg__header"})})]})]})})},Co=()=>{const{setPopup:e,popup:t}=Te(),{txt:a,greenLabel:n="I change idea",redLabel:r,confirmAction:l,isPending:i}=t??{};return s.jsx("div",{className:`${t?"fixed":"hidden"} top-0 left-0 w-full h-full bg-black/50 popup__i flex justify-center items-center`,children:s.jsxs("div",{className:"w-[75vw] max-w-[750px] h-1/2 bg-[#111] border-[3px] border-orange-500 rounded-2xl grid grid-cols-1 p-5 content-start relative",children:[s.jsx("div",{onClick:()=>e(null),className:"w-fit h-fit justify-self-end flex justify-end -mt-3 -mr-2",children:s.jsx(Ce,{className:"w-[35px] h-[35px] sm:h-[40px] sm:w-[40px] text-red-600 btn__pseudo hover:scale-120"})}),s.jsx("div",{className:"w-full h-fit flex justify-center self-start mt-[5%]",children:s.jsxs("span",{className:"txt__03",children:["Are you sure you want to ",a]})}),s.jsxs("div",{className:"w-full h-fit grid grid-cols-1 sm:grid-cols-2 absolute bottom-[20%] left-1/2 -translate-x-1/2 justify-items-center gap-5",children:[s.jsx("div",{className:"w-full max-w-[250px] flex justify-center",children:s.jsx(le,{label:n??"I change idea",styleTxt:"txt__02 text-green-600",styleBtn:"border-green-600",handleClick:()=>e(null),isDisabled:i})}),s.jsx("div",{className:"w-full max-w-[250px] flex justify-center",children:s.jsx(le,{label:r,styleTxt:"txt__02 text-red-600",styleBtn:"border-red-600",handleClick:l,isPending:i})})]})]})})},Eo=()=>{const e=f.useRef(null),t=f.useRef(null),{isToast:a,msg:n,type:r,closeToast:l,clicked:i}=he();return f.useEffect(()=>{(()=>{const o=document.getElementById("toast");t!=null&&t.current&&o&&(a?(o.classList.remove("toast__no"),o.classList.remove("toast__active_out"),t.current.classList.remove("toast__container_after"),requestAnimationFrame(()=>{var d;o.classList.add("toast__active_in"),(d=t==null?void 0:t.current)==null||d.classList.add("toast__container_after")}),e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{i.current=!0,l(),e.current=null},5e3)):(o.classList.remove("toast__active_in"),i.current?(o.classList.remove("toast__no"),requestAnimationFrame(()=>{o.classList.add("toast__active_out")})):o.classList.add("toast__no")))})()},[a,l,i]),{isToast:a,afterRef:t,msg:n,type:r,closeToast:l,clicked:i}},Io=()=>{const{afterRef:e,msg:t,type:a,closeToast:n,clicked:r}=Eo();return s.jsx("div",{id:"toast",className:`top-5 right-5 fixed toast__i bg-[#111] rounded-xl text-[whitesmoke] min-w-3/4 sm:min-w-1/2 max-w-3/4 h-fit min-h-[75px] flex border-t-2 border-r-2 el__flow  ${a==="SUCCESS"?"border-green-600":"border-red-600"}
      toast__no
      `,children:s.jsxs("div",{ref:e,className:`w-full grid grid-cols-[75px_1fr] relative min-h-full rounded-xl border-l-[8px]  ${a==="SUCCESS"?"border-green-600":"border-red-600"}`,style:{"--toast-color":a==="SUCCESS"?"#16a34a":"#dc2626"},children:[s.jsx("div",{className:"w-full flex flex-col items-center justify-center",children:a==="SUCCESS"?s.jsx(Xn,{className:"h-[30px] w-[30px] sm:h-[35px] sm:w-[35px] text-green-600"}):s.jsx(Qs,{className:"h-[30px] w-[30px] sm:h-[35px] sm:w-[35px] text-red-600"})}),s.jsx("div",{className:`absolute txt__03 top-3 left-[75px] ${a==="SUCCESS"?"text-green-600":"text-red-600"}`,children:a}),s.jsx("div",{onClick:()=>{r.current=!0,n()},className:"absolute right-5 top-3 ",children:s.jsx(Ce,{className:"h-[30px] w-[30px] sm:w-[32px] sm:h-[32px] text-red-600 hover:scale-120 btn__pseudo"})}),s.jsx("div",{className:"w-full flex justify-start pr-6 pb-6 pt-12",children:s.jsx("span",{className:"txt__03",children:t})})]})})},Po=()=>{const{isLogged:e,currUser:t}=L(),{showToastMsg:a,handleErrAPI:n}=F(),r=Q(),l=D(),{register:i,formState:{errors:c},handleSubmit:o,reset:d}=U({mode:"onChange"}),{mutate:u,isPending:p}=R({mutationFn:h=>zr(h),onSuccess:()=>{d(),a("You have successfully subscribed to out newsLetter","SUCCESS")},onError:h=>{var w,b;a(((b=(w=h==null?void 0:h.response)==null?void 0:w.data)==null?void 0:b.msg)||h.message,"ERROR")}}),m=o(h=>{u(h.email)}),{mutate:g,isPending:x}=R({mutationFn:({type:h})=>Gr({type:h}),onSuccess:()=>{a(`You have ${t!=null&&t.hasSubscribedToNewsletter?"unsubscribed":"subscribed"} to our newsletter successfully`,"SUCCESS")},onError:h=>{var w,b,v;((w=h==null?void 0:h.response)==null?void 0:w.status)===401?n({err:h}):a(((v=(b=h==null?void 0:h.response)==null?void 0:b.data)==null?void 0:v.msg)||h.message,"ERROR")},onSettled:()=>r.removeQueries({queryKey:["currUser"]})});return{isLogged:e,toggleNewsLetter:()=>{g({type:t!=null&&t.hasSubscribedToNewsletter?"unsubscribe":"subscribe"})},isPendingLogged:x,register:i,errors:c,currUser:t,submitSubscribeNonLoggedUser:m,isPendingNonLogged:p,handleRedirection:()=>l("/newsletter/notice-unsubscribe-with-retry?success=false",{state:{from:"/newsletter/verify-unsubscribe"}})}},Ro=({isPending:e,currUser:t,submitNewsLetter:a})=>s.jsx("div",{className:"max-w-[200px] md:max-w-[225px] flex justify-start",children:s.jsx(J,{label:t!=null&&t.hasSubscribedToNewsletter?"Unsubscribe":"Subscribe",type:"button",handleClick:a,isPending:e})}),Ao=({isPending:e,currUser:t,submitNewsLetter:a,register:n,errors:r})=>{var l,i;return s.jsx("div",{className:"w-full flex flex-col gap-5",children:s.jsxs("form",{className:"grid grid-cols-[repeat(auto-fit,minmax(225px,1fr))] sm:grid-cols-2 gap-5 sm:gap-x-10 items-center",children:[s.jsxs("div",{className:"w-full flex flex-col gap-3",children:[s.jsx("input",{type:"email",className:"input__base txt__01",placeholder:"Your email...",...n("email",{required:"Email is required",pattern:{value:Ys,message:"Enter a valid email to receive great discounts "}})}),((l=r==null?void 0:r.email)==null?void 0:l.message)&&s.jsx("span",{className:"txt__00 text-red-600",children:(i=r==null?void 0:r.email)==null?void 0:i.message})]}),s.jsx("div",{className:"w-full max-w-[200px] md:max-w-[225px] flex justify-start items-start",children:s.jsx(J,{label:t!=null&&t.hasSubscribedToNewsletter?"Unsubscribe":"Subscribe",type:"submit",handleClick:a,isPending:e})})]})})},Do=()=>{const{isLogged:e,toggleNewsLetter:t,isPendingLogged:a,register:n,errors:r,currUser:l,submitSubscribeNonLoggedUser:i,isPendingNonLogged:c,handleRedirection:o}=Po();return s.jsxs("div",{className:"flex w-full flex-col items-start gap-5",children:[s.jsxs("div",{className:`w-full grid items-center gap-4  ${e?"grid-cols-[repeat(auto-fit,minmax(200px,1fr))] sm:grid-cols-2":" grid-cols-1 lg:grid-cols-[200px_1fr]"}`,children:[s.jsx("div",{className:"w-full flex flex-col self-start",children:s.jsx("span",{className:"txt__01",children:"Newsletter"})}),e?s.jsx(Ro,{currUser:l,submitNewsLetter:t,isPending:a}):s.jsx(Ao,{register:n,errors:r,submitNewsLetter:i,currUser:l,isPending:c})]}),!e&&s.jsx("div",{className:"w-full flex justify-start",children:s.jsx("span",{onClick:o,className:"txt__01 el__after_below cursor-pointer el__flow hover:text-orange-500",children:"Send link to unsubscribe"})}),s.jsx("div",{className:"w-full flex",children:s.jsx("span",{className:"txt__00",children:"Subscribe to our newsletter to receive the latest updates and get a chance to win a discount coupon."})})]})},To=()=>s.jsxs("div",{className:"pad__page py-5 border-t-2 border-orange-500 w-full flex flex-col items-center gap-y-5",children:[s.jsxs("div",{className:"grid w-full gap-y-5 ",children:[s.jsx(W,{to:"/",className:"txt__05 text-orange-500",children:"LOGO"}),s.jsx("div",{className:"w-full grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:vi.map(e=>s.jsx("div",{className:"w-full flex flex-col items-start",children:s.jsx(W,{to:e.path,className:"el__after_below txt__01 el__flow hover:text-orange-500 opacity-50",children:e.label})},e.id))})]}),s.jsx("ul",{className:"w-full grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] lg:grid-cols-[200px_1fr] justify-items-start gap-y-5",children:Ni.map(e=>s.jsx("li",{children:s.jsxs("a",{href:e.url,className:"grid max-w-fit grid-cols-[40px_1fr] items-end el__flow el__after_below hover:text-orange-500",children:[s.jsx(e.svg,{className:"w-[30px] h-[30px] "}),s.jsx("span",{className:"txt__01",children:e.label})]})},e.id))}),s.jsx(Do,{}),s.jsx("div",{className:"w-full flex justify-center py-5",children:s.jsxs("span",{className:"txt__01",children:["© ",new Date().getFullYear()," MERN__EAT. No rights reserved just making it for fun ✌🏼"]})})]}),Fo=({email:e})=>s.jsx("div",{className:"w-full flex items-center border-b-2 border-orange-500 sticky pt-4 top-0 z-20 bg-[#111]",children:s.jsxs("div",{className:"w-full flex items-center pb-4 pl-3 gap-3",children:[s.jsx(Jn,{className:" w-[35px] h-[35px] sm:w-[40px] sm:h-[40px]"}),s.jsx("span",{className:"txt__02 max-w-full truncate",children:e})]})}),Fs=({handleSideClick:e,el:t,customStyle:a})=>{const n=A(),[r]=ae(),l=r.get("type");return s.jsxs("button",{onClick:()=>e(t.path,t==null?void 0:t.from),className:`w-full cursor-pointer flex gap-3 group max-w-fit items-center el__after_below sideLink ${a??""} ${da({location:n,el:t,type:l})}`,children:[s.jsx(t.svg,{className:"svg__sidebar"}),s.jsx("span",{className:"cursor-pointer txt__02 group-hover:text-orange-500 el__flow",children:t.label})]},t.id)},Mo=({handleLogout:e,isPending:t})=>t?s.jsx("div",{className:"mt-[10px]",children:s.jsx(_e,{})}):s.jsxs("button",{onClick:e,className:"w-full flex gap-3 group max-w-fit items-center el__after_below",children:[s.jsx(zt,{className:"svg__sidebar"}),s.jsx("span",{className:"cursor-pointer txt__02 group-hover:text-orange-500 el__flow",children:"Logout"})]}),ft=({handleSideClick:e,el:t,fields:a})=>{const[n,r]=f.useState(!1),{isOpenSide:l}=zs();return f.useEffect(()=>{l||r(!1)},[l]),s.jsxs("div",{className:"w-full grid grid-cols-1",children:[s.jsx(Y,{txt:t.label,Icon:t.icon,isOpen:n,setIsOpen:r,customIconStyle:"svg__sidebar"}),s.jsx("div",{className:`w-full grid grid-cols-1 el__flow gap-6 pl-5 ${n?"max-h-[500px] opacity-100 pointer-events-auto pt-3":"max-h-0 opacity-0 pointer-events-none"}`,children:a.map((i,c)=>s.jsx(Fs,{el:i,handleSideClick:e,customStyle:c?void 0:"pt-2"},i.id))})]})},ko=()=>{const{isOpenSide:e,setIsOpenSide:t}=zs(),a=f.useRef(null),n=D(),{isLogged:r,currUser:l}=L();f.useEffect(()=>{const u=p=>{var m;(m=a.current)!=null&&m.contains(p.target)||t(!1)};return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[t,a]);const{mutate:i,isPending:c}=za(),o=()=>i(),d=(u,p)=>{n(u,p?{state:{from:p}}:void 0),t(!1)};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`${e?"fixed":"hidden"} inset-0 bg-black/50 sidebar__i_bg transition-none`}),s.jsx("div",{ref:a,className:`${e?"translate-x-0 overflow-y-auto hide_scrollbar pb-[50px]":"translate-x-full"} sidebar__content sidebar__i_content ${r?"":"pt-6"}`,children:s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-start gap-5 px-3",children:[(l==null?void 0:l.email)&&s.jsx(Fo,{email:l.email}),Di.map(u=>s.jsx(Fs,{handleSideClick:d,el:u},u.id)),r?va.map(u=>s.jsx(Fs,{handleSideClick:d,el:u},u.id)):s.jsx(ft,{handleSideClick:d,el:ki,fields:Na}),r&&s.jsx(ft,{handleSideClick:d,el:Fi,fields:Ti}),r&&s.jsx(Mo,{isPending:c,handleLogout:o})]})})]})},Lo=({images:e})=>{const[t,a]=f.useState(0),[n,r]=f.useState(!1),l=f.useCallback(()=>{t===e.length-1?a(0):a(c=>c+1)},[t,e.length]),i=()=>{a(t===0?e.length-1:c=>c-1)};return f.useEffect(()=>{if(n)return;const c=setInterval(()=>{l()},1500);return()=>clearInterval(c)},[n,l]),{activeIndx:t,handleNext:l,handlePrev:i,setBtnClicked:r}},ut=({images:e})=>{const t=A().pathname,{activeIndx:a,handleNext:n,handlePrev:r,setBtnClicked:l}=Lo({images:e});return s.jsx("div",{className:"pad__page w-full pt-5 flex flex-col justify-center",children:s.jsxs("div",{className:"w-full flex items-center relative",children:[s.jsx("button",{onClick:()=>{l(!0),r()},className:"absolute top-1/2 left-0 -translate-y-1/2 hero__i_arrow outline-none",children:s.jsx(er,{className:"h-[50px] w-[50px] text-orange-500 btn__pseudo hover:scale-120"})}),s.jsx("div",{className:"flex w-full overflow-hidden border-2 border-orange-500 p-6 rounded-xl gap-[10%]",children:e.map(i=>s.jsx("div",{className:`min-w-[200px] h-[200px] ${Re.test(t)?"":"sm:min-w-[350px] sm:h-[350px]"} rounded-xl transition-all duration-500 overflow-hidden`,style:{transform:`translateX(-${a*100}%`},children:s.jsx("img",{src:(i==null?void 0:i.url)??i.img,alt:"burger_hero",className:"min-w-full object-cover h-full "})},(i==null?void 0:i.public_id)??i.id))}),s.jsx("button",{onClick:()=>{l(!0),n()},className:"absolute top-1/2 right-0 -translate-y-1/2 hero__i_arrow outline-none",children:s.jsx(sr,{className:"h-[50px] w-[50px] text-orange-500 btn__pseudo hover:scale-120"})})]})})},Oo=()=>s.jsx(ut,{images:bi}),Uo=()=>{const{infoPop:e}=Fe(),t=(e==null?void 0:e.isPendingCancel)||(e==null?void 0:e.isPendingConfirm);return s.jsx("div",{className:`${e?"fixed":"hidden"} top-0 left-0 w-full h-full bg-black/50 popup__i flex justify-center items-center`,children:s.jsxs("div",{className:"w-[75vw] max-w-[750px] min-h-1/2 max-h-full bg-[#111] border-[3px] border-orange-500 rounded-2xl grid grid-rows-[40px_1fr_1fr] p-6",children:[s.jsx("div",{onClick:()=>e==null?void 0:e.cancelActCb(),className:"w-fit h-fit justify-self-end flex justify-end -mt-3 -mr-2",children:s.jsx(Ce,{className:"w-[35px] h-[35px] sm:h-[40px] sm:w-[40px] text-red-600 btn__pseudo hover:scale-120"})}),s.jsx("div",{className:"w-full h-fit flex justify-center self-start",children:s.jsx("span",{className:"txt__03",children:e==null?void 0:e.msg})}),s.jsxs("div",{className:"w-full self-center grid grid-cols-1 sm:grid-cols-2 justify-items-center gap-5 ",children:[s.jsx("div",{className:"w-full max-w-[250px] flex justify-center",children:s.jsx(le,{label:e==null?void 0:e.confirmActMsg,styleTxt:"txt__02 ",handleClick:()=>e==null?void 0:e.confirmActCb(),isDisabled:t,isPending:e==null?void 0:e.isPendingConfirm})}),(e==null?void 0:e.cancelActMsg)!=="_"&&s.jsx("div",{className:"w-full max-w-[250px] flex justify-center",children:s.jsx(le,{label:e==null?void 0:e.cancelActMsg,styleTxt:"txt__02",handleClick:()=>e==null?void 0:e.cancelActCb(),isDisabled:t,isPending:e==null?void 0:e.isPendingCancel})})]})]})})},$o=({children:e})=>{const t=A();return s.jsxs("div",{className:"w-full min-h-screen flex flex-col items-center",children:[s.jsx(So,{}),s.jsx(ko,{}),s.jsx(Co,{}),s.jsx(Uo,{}),s.jsx(Io,{}),t.pathname==="/"&&s.jsx(Oo,{}),s.jsx("div",{className:"flex flex-col items-center w-full pad__page py-5 pb-[150px] sm:pb-[200px] relative",children:e}),s.jsx(To,{})]})},Vo=()=>s.jsx($o,{children:s.jsx(xe,{})}),qo=()=>{const{isLogged:e}=L();return e?s.jsx(G,{to:"/",replace:!0}):s.jsx(xe,{})},Bo=()=>{const{isLogged:e}=L();return e?s.jsx(xe,{}):s.jsx(G,{to:"/",replace:!0})},Qo=()=>s.jsx(xe,{}),Go=()=>{const{isLogged:e}=L();return e?s.jsx(xe,{}):s.jsx(G,{to:"/auth/login",replace:!0})},zo=()=>{const{handleErrAPI:e}=je(),{restId:t}=pe(),a=z.test(t??""),{data:n,isPending:r,isError:l,error:i,isSuccess:c}=ne({queryKey:["mySingleRestaurant",t],queryFn:()=>sl(t??""),enabled:a}),o=f.useCallback(()=>{l&&e({err:i})},[l,e,i]);f.useEffect(()=>{o()},[o]);const{restaurant:d,success:u}=n??{};return{canStay:a,isPending:r,restaurant:d,success:u,restId:t,isError:l,error:i,isSuccess:c&&Object.keys(d??{}).length}},Yo=({restId:e})=>{const[t,a]=f.useState(!1),n=D(),{formContextMyDishesSearch:r,formContextManageOrdersSearch:l}=ue(),i=()=>{const{setValue:u}=r;u("searchVals",["restaurantId"]),u("search",e??"")},c=()=>n(`/my-dishes/add-dish?restId=${e}`),o=()=>{const{setValue:u}=l;u("searchVals",["restaurantId"]),u("search",e??""),n("/manage-orders")},{handleClickToOpenPopup:d}=Qa();return s.jsxs("div",{className:"w-full grid grid-cols-1 relative my_restaurant_drop__i",children:[s.jsx("div",{className:"h-[50px]"}),s.jsxs("div",{className:"border-2 border-orange-500 rounded-xl w-fit justify-self-end py-2 px-3 absolute z-10 bg-[#111]",children:[s.jsx("div",{className:"w-full ",children:s.jsx(Y,{isOpen:t,setIsOpen:a,txt:"Business",Icon:De})}),s.jsx("ul",{className:`w-full grid grid-cols-1 el__flow pl-1 gap-6 ${t?"opacity-100 pointer-events-auto max-h-[500px] pb-4":"opacity-0 pointer-events-none max-h-0"}`,children:zl(e??"").map(u=>s.jsx("li",{onClick:()=>u.label==="Add dish"?c():u.label==="My dishes"?i():u.label==="Delete"?d():u.label==="My orders"?o():null,className:"w-full flex items-center gap-3 group el__flow cursor-pointer first:pt-4 hover:text-orange-500 el__after_below",children:u.label==="Delete"?s.jsxs("div",{className:"w-full flex items-center gap-3",children:[s.jsx(u.icon,{className:"min-w-[25px] min-h-[25px] group-hover:text-orange-500 el__flow"}),s.jsx("span",{className:"txt__01 group-hover:text-orange-500 el__flow ",children:u.label})]}):u.label==="Add dish"?s.jsxs("div",{className:"w-full flex items-center gap-3",children:[s.jsx(u.icon,{className:"min-w-[25px] min-h-[25px] group-hover:text-orange-500 el__flow"}),s.jsx("span",{className:"txt__01 group-hover:text-orange-500 el__flow ",children:u.label})]}):s.jsxs(W,{to:u.path,className:"w-full flex items-center gap-3",children:[s.jsx(u.icon,{className:"min-w-[25px] min-h-[25px] group-hover:text-orange-500 el__flow"}),s.jsx("span",{className:"txt__01 group-hover:text-orange-500 el__flow ",children:u.label})]})},u.id))})]})]})},Ho=()=>{k();const{canStay:e,isPending:t,restaurant:a,restId:n,error:r,isError:l}=zo();return s.jsx(X,{isPending:t,isError:l,error:r,canStay:e,children:V(a)&&s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-5",children:[s.jsx("span",{className:"txt__04 truncate max-w-full",children:a.name}),s.jsx(Yo,{restId:n}),s.jsx(ut,{images:a.images}),s.jsxs("div",{className:"w-full grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-y-3 gap-x-6 items-start",children:[s.jsx(bs,{rest:a,Container:ke}),s.jsx(Ia,{rest:a})]})]})})},Ko=()=>{const{isLogged:e}=L();return e?s.jsx(xe,{}):s.jsx(G,{to:"/auth/login",replace:!0})},Wo=async()=>{const{data:e}=await E.get("/my-dishes/restaurant-ids");return e},Zo=async({restId:e,form:t})=>{const{data:a}=await E.post(`/my-dishes?restId=${e}`,t);return a},Xo=async e=>{const{data:t}=await E.get(`/my-dishes?${e}`);return t},Jo=async e=>{const{data:t}=await E.get(`/my-dishes/info-dish/${e}`);return t},ed=async e=>{const{data:t}=await E.delete(`/my-dishes/${e}`);return t},sd=async({formData:e,id:t})=>{const{data:a}=await E.put(`/my-dishes/${t}`,e);return a},td=async e=>{const{data:t}=await E.delete("/my-dishes/bulk-delete",{data:{ids:e}});return t},ad=async e=>{const{data:t}=await E.delete(`/my-dishes/bulk-delete-query?${e}`);return t},Ya=()=>{var c;const{handleErrAPI:e}=je(),{data:t,isPending:a,isSuccess:n,isError:r,error:l}=ne({queryKey:["restaurantIds"],queryFn:Wo}),i=f.useCallback(()=>{r&&e({err:l})},[r,l,e]);return f.useEffect(()=>{i()},[i]),{isPendingIds:a,restInfo:t==null?void 0:t.infoRestaurants,isSuccessIds:n&&((c=t==null?void 0:t.infoRestaurants)==null?void 0:c.length),isErrorIds:r,errorIds:l}},Ha=()=>(Math.random()*101).toFixed(2),nd=()=>Math.floor(+Ha()),Ka=["https://img.freepik.com/free-photo/pizza-pizza-filled-with-tomatoes-salami-olives_140725-1200.jpg","https://img.freepik.com/free-photo/side-view-penne-pasta-with-tomato-sauce-greens-plate_141793-5043.jpg","https://img.freepik.com/free-photo/grilled-stake-with-black-pepper-baked-potato-tomatoes-rosemary-board_140725-10939.jpg","https://img.freepik.com/free-photo/dessert-table_181624-10310.jpg?uid=R172218062&ga=GA1.1.1226271393.1737553858&semt=ais_hybrid","https://img.freepik.com/free-photo/fried-meat-served-with-arugula-grilled-tomato_141793-1181.jpg"],rd=async()=>{const{data:e}=await E.post("/proxy",{urls:Ka});return e},ld=(e,t)=>{const a=atob(e.base64.split(",")[1]),n=[];let r=0;for(;r<a.length;)n.push(a.charCodeAt(r)),r++;const l=new Uint8Array(n);return new File([l],`img_${t}`,{type:e.mimeType})},id=({setValue:e,reset:t})=>{const{showToastMsg:a}=he(),[n]=ae(),r=n.get("restId"),{data:l,isPending:i,isSuccess:c,isError:o,error:d}=ne({queryKey:["urls",Ka],queryFn:rd,enabled:kr});return f.useEffect(()=>{if(o)a("Error","ERROR");else if(c){const u=l.base64Imgs.map((p,m)=>ld(p,m));t({restaurant:z.test(r??"")?r??"":"",items:[...Array.from({length:10}).map((p,m)=>({name:`b_item_${m+1+""}`,price:Ha(),quantity:nd(),images:[u==null?void 0:u[4]]}))]})}},[c,o,d,l,a,e,t,r]),{isPending:i}},cd=()=>{const{formContextMyDishesAddItem:e,formContextMyDishesSearch:t}=ue(),{showToastMsg:a,handleErrAPI:n}=F(),r=D(),[l]=ae(),i=l.get("restId");id({setValue:e.setValue,reset:e.reset});const{isPendingIds:c,restInfo:o,isSuccessIds:d,isErrorIds:u,errorIds:p}=Ya(),{fields:m}=Gs({control:e.control,name:"items"});f.useEffect(()=>{e!=null&&e.setFocus&&setTimeout(()=>{e.setFocus(`items.${m.length-1}`)},500)},[e,m.length]),f.useEffect(()=>{z.test(i??"")&&e.setValue("restaurant",i??"")},[e,i]);const{mutate:g,isPending:x}=R({mutationFn:({form:_,restId:h})=>Zo({form:_,restId:h}),onSuccess:_=>{a(`Dish${m.length>1?"es":""} created successfully`,"SUCCESS");const{setValue:h}=t;h("searchVals",["restaurantId"]),h("search",_.restId),h("createdAtSort",["desc"]),r("/my-dishes"),e.reset({restaurant:"",items:[{name:"",price:"",quantity:"",images:[]}]})},onError:_=>n({err:_})}),y=e.handleSubmit(_=>{const h=Vl(_);g({form:h,restId:_.restaurant})});return{isPendingIds:c||!1,formContext:e,restInfo:o,isSuccessIds:d,handleSave:y,isPending:x,isErrorIds:u,errorIds:p}},od=({formContext:e,restInfo:t})=>{var d;const[a,n]=f.useState(!1),{register:r,watch:l,formState:{errors:i},setValue:c}=e,o=u=>l("restaurant")===u;return s.jsxs("div",{className:"w-full grid grid-cols-1 relative my_restaurant_drop__i",children:[s.jsx("div",{className:"h-[60px] sm:h-[50px]"}),((d=i==null?void 0:i.restaurant)==null?void 0:d.message)&&s.jsx("span",{className:"txt__01 -mt-5 sm:mt-0 justify-self-end self-center text-red-600 pt-5",children:i.restaurant.message}),s.jsx("input",{type:"text",...r("restaurant",{required:{value:!0,message:"We need to know to which restaurant you want to add dish 🧐"}}),className:"opacity-0 pointer-events-none"}),s.jsxs("div",{className:"border-2 border-orange-500 rounded-xl w-fit justify-self-end py-1 sm:py-2 px-1 sm:px-3 absolute z-10 bg-[#111]",children:[s.jsx("div",{className:"w-full ",children:s.jsx(Y,{isOpen:a,setIsOpen:n,txt:"Restaurant",Icon:De})}),s.jsx("ul",{className:`w-full grid grid-cols-1 el__flow pl-1 gap-2 sm:gap-4 overflow-x-scroll hide_scrollbar ${a?"opacity-100 pointer-events-auto max-h-[250px] pb-4":"opacity-0 pointer-events-none max-h-0"}`,children:t==null?void 0:t.map(u=>s.jsx("li",{onClick:()=>{c("restaurant",o(u._id)?"":u._id,{shouldValidate:!0}),n(!1)},className:`grid w-full grid-cols-1 border-2 first:mt-3 rounded-xl py-1 sm:py-2 px-2 sm:px-3 cursor-pointer el__flow ${o(u._id)?"border-orange-500 text-orange-500":"border-[#333]"}`,children:s.jsx("span",{className:"txt__01 break-all",children:u.name})},u._id))})]})]})},dd=({formContext:e,indexForm:t})=>{var c,o,d,u;const{register:a,watch:n,setValue:r,formState:{errors:l}}=e,i=n(`items.${t}.images`);return s.jsxs("div",{className:"w-full flex flex-col gap-2",children:[s.jsxs("span",{className:"txt__03 el__sub_title_my_restaurants_form",children:[s.jsx(Ot,{className:"h-[35px] w-[35px]"}),"Dish images"]}),s.jsx("div",{className:`w-full flex flex-row overflow-x-auto border-[3px] snap-x snap-mandatory gap-5 sm:gap-10 hide_scrollbar rounded-xl el__flow ${(c=n(`items.${t}.images`))!=null&&c.length?"max-h-[500px] p-3 sm:p-6 border-orange-500 mb-2":"max-h-0 border-transparent p-0"}`,children:!!(i!=null&&i.length)&&[...i].map((p,m)=>s.jsx(lt,{img:i[m],images:i,setValue:r,indexForm:t},m))}),s.jsx(it,{register:a,watch:n,indexForm:t}),((d=(o=l==null?void 0:l.items)==null?void 0:o[t])==null?void 0:d.images)&&s.jsx("span",{className:"txt__01 text-red-600",children:(u=l==null?void 0:l.items)==null?void 0:u[t].images.message})]})},Ms={id:j(),label:"Name",field:"name",place:"Dish name...",required:!0,reg:Rl,msg:"Dish name must be between 2 and 50 characters"},Wa=[{field:"price",reg:Oe,msg:"Price must be a positive number with up to 2 decimal places"},{field:"quantity",reg:la,msg:"Quantity must be a prime number without decimals"}].map(e=>({...e,id:j(),label:e.field[0].toUpperCase()+e.field.slice(1),place:`Dish ${e.field}...`,required:!0,type:"number"})),ud=[{field:Ms.field,reg:Ms.reg},...Wa.map(e=>({field:e.field,reg:e.reg}))],md=({formContext:e,indexForm:t})=>{const{register:a,formState:{errors:n}}=e;return s.jsxs("div",{className:"w-full grid gap-3",children:[s.jsxs("span",{className:"txt__03 el__sub_title_my_restaurants_form",children:[s.jsx(Lt,{className:"h-[35px] w-[35px]"}),"Dish name"]}),s.jsx("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2",children:s.jsx(ie,{field:{...Ms,field:`items.${t}.name`},register:a,errors:n,indexForm:t})})]})},pd=({formContext:e,indexForm:t})=>{const{register:a,formState:{errors:n}}=e,r=l=>+l<.01?"Price must up greater than $0.01":!0;return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-5",children:[s.jsxs("div",{className:"txt__03 flex flex-wrap items-center gap-5 text-orange-500",children:[s.jsxs("span",{className:"txt__03 flex items-center gap-5 text-orange-500",children:[s.jsx(gs,{className:"h-[35px] w-[35px]"}),"Dish price and"]}),s.jsxs("span",{className:"txt__03 flex items-center gap-5 text-orange-500",children:[s.jsx(B,{className:"h-[35px] w-[35px]"}),"Dish quantity"]})]}),s.jsx("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 gap-y-3 gap-x-5",children:Wa.map(l=>s.jsx(ie,{field:{...l,field:`items.${t}.${l.field}`},register:a,errors:n,indexForm:t,customValidate:l.field==="price"?r:void 0},l.id))})]})},xd=({formContext:e,indexForm:t,removeForm:a})=>s.jsxs("div",{className:"w-full grid grid-cols-1 border-2 rounded-xl border-orange-500 p-5 py-8 gap-5 relative",children:[t!==0&&s.jsx("div",{className:"justify-self-end sm:absolute top-5 right-5",children:s.jsx(Se,{txt:"Remove",handleDelete:()=>a(t)})}),s.jsx(md,{formContext:e,indexForm:t}),s.jsx(dd,{formContext:e,indexForm:t}),s.jsx(pd,{formContext:e,indexForm:t})]}),Za=({formContext:e,handleSave:t,isPending:a,restInfo:n})=>{const[r,l]=f.useState(!0),i=A(),{control:c,watch:o}=e,{fields:d,append:u,remove:p}=Gs({control:c,name:"items"});f.useEffect(()=>{const x=o(y=>{var w,b;const _=(w=y.items)==null?void 0:w[d.length-1];let h=!((b=_==null?void 0:_.images)!=null&&b.length);for(const v of ud){const N=_==null?void 0:_[v.field];if(!v.reg.test(N)){h=!0;break}}l(h)});return()=>x.unsubscribe()},[d,o]);const m=()=>{u({name:"",price:"",quantity:"",images:[]}),l(!0)},g=x=>{d.length>1&&(p(x),l(!1))};return s.jsxs("form",{className:"w-full grid grid-cols-1 gap-5",children:[s.jsx(od,{restInfo:n,formContext:e}),d.map((x,y)=>s.jsx(xd,{formContext:e,restInfo:n,indexForm:y,removeForm:g},y)),s.jsx("div",{className:"w-full max-w-[250px] justify-self-center justify-center flex mt-5",children:s.jsx(J,{label:i.pathname==="/my-dishes/add-dish"?"Create":"Update",type:"submit",handleClick:t,isPending:a})}),/^\/(my-dishes)\/(add-dish)/.test(i.pathname)&&(d==null?void 0:d.length)<20&&s.jsx("div",{className:"w-full max-w-[150px] justify-self-start",children:s.jsx(le,{type:"button",label:"Add",styleTxt:"txt__02",handleClick:m,isDisabled:a||r})})]})},gd=()=>{k();const{isPendingIds:e,formContext:t,restInfo:a,isSuccessIds:n,handleSave:r,isPending:l,errorIds:i,isErrorIds:c}=cd();return s.jsx(X,{isPending:e,isError:c,error:i,children:s.jsxs("div",{className:"w-full grid grid-cols-1 gap-5 justify-items-center",children:[s.jsx("span",{className:"txt__04",children:"Add Dish"}),n&&s.jsx(re,{...t,children:s.jsx(Za,{formContext:t,restInfo:a,handleSave:r,isPending:l})})]})})},ht=({cbMutation:e,setSelected:t})=>{const a=Q(),{popup:n,setPopup:r}=Te(),{showToastMsg:l,handleErrAPI:i}=F(),{mutate:c,isPending:o}=R({mutationFn:()=>(r({...n,isPending:!0}),e()),onSuccess:()=>{l("Dishes Deleted successfully","SUCCESS"),t([]),a.removeQueries({queryKey:["myDishesSearch"]})},onError:u=>i({err:u}),onSettled:()=>r(null)});return{handleDelete:()=>c(),isPending:o}},fd=()=>{const[e,t]=f.useState([]),{formContextMyDishesSearch:a}=ue(),{setPopup:n}=Te(),{formVals:r,handleSave:l,handleClear:i,propsBlock:c,data:o,closeAllDrop:d,id:u,...p}=Be({formCtx:a,key:"myDishesSearch",cbAPI:Xo}),m=v=>t(N=>N.includes(v)?N.filter(C=>C!==v):[...N,v]),g=()=>t([]),{handleDelete:x,isPending:y}=ht({cbMutation:()=>td(e),setSelected:t}),_=()=>n({txt:`delete ${e.length} dish${e.length>1?"es":""} ?`,greenLabel:"I changes idea",redLabel:"Delete dishes",confirmAction:x,isPending:y}),{handleDelete:h,isPending:w}=ht({cbMutation:()=>ad(Ws(r)),setSelected:t}),b=()=>{var v;(v=o==null?void 0:o.dishes)!=null&&v.length&&t(o.dishes.map(N=>N._id)),n({txt:`delete ${o==null?void 0:o.nHits} dish${(o==null?void 0:o.nHits)>1?"es":""} ?`,redLabel:"Delete dishes",confirmAction:h,isPending:w})};return{propsForm:{handleSave:l,handleClear:i,formContext:a,isPending:p.isPending},propsBlock:c,data:o,toggleSelected:m,selected:e,clearSelected:g,handleOpenPopup:_,handleOpenPopupBulkQuery:b,closeAllDrop:d,id:u,...p}},Xa=e=>({id:j(),label:"Categories",icon:tr,vals:e}),hd=(...e)=>[{label:"Price",val:Z({price:e[0]}),icon:Ut},{label:"Quantity",val:e[1],icon:B}].map(t=>({...t,id:j()})),yd=({dish:e,toggleSelected:t,selected:a})=>{const[n,r]=f.useState(!1);return s.jsxs("div",{className:`card__el_grid ${a.includes(e._id)?"border-red-600 opacity-50 scale-105":"border-orange-500"}`,children:[s.jsxs("div",{className:"w-full flex flex-col",children:[s.jsx(ws,{id:e._id}),s.jsx(Pa,{images:e.images,name:e.name}),s.jsxs("div",{className:"w-full grid grid-cols-1",children:[s.jsx(Y,{isOpen:n,setIsOpen:r,txt:"Restaurant",Icon:xs,customStyle:"px-3 border-b-2 border-orange-500 py-1"}),s.jsxs("ul",{className:`w-full el__flow grid grid-cols-1 gap-3 px-3 ${n?"opacity-100 max-h-[500px] pointer-events-auto pt-3":"opacity-0 max-h-0 pointer-events-none"}`,children:[s.jsxs("li",{className:"w-full grid grid-cols-[80px_1fr]",children:[s.jsxs("div",{className:"w-full flex gap-5 justify-start items-center",children:[s.jsx(ar,{className:"icon__base"}),s.jsx("span",{className:"txt__01",children:"Name"})]}),s.jsx("span",{className:"txt__01 justify-self-end",children:e.restaurantName})]}),s.jsxs("li",{className:"w-full grid grid-cols-[80px_1fr]",children:[s.jsxs("div",{className:"w-full flex gap-5 justify-start items-center",children:[s.jsx(B,{className:"icon__base"}),s.jsx("span",{className:"txt__01",children:"Id"})]}),s.jsx("div",{className:"flex w-full justify-end",children:s.jsx(ct,{txt:e.restaurant,label:"Id"})})]}),s.jsx(de,{el:Xa(e.categories)})]}),s.jsx("ul",{className:"w-full grid grid-cols-1 gap-2 px-3",children:hd(e.price,e.quantity).map((l,i)=>s.jsxs("li",{className:"w-full grid grid-cols-[80px_1fr] first:pt-2",children:[s.jsxs("div",{className:"w-full flex gap-5 items-center",children:[s.jsx(l.icon,{className:"icon__base"}),s.jsx("span",{className:"txt__01",children:l.label})]}),s.jsx("span",{className:"txt__01 justify-self-end",children:l.val})]},i))})]})]}),s.jsxs("div",{className:"w-full grid grid-cols-2 mt-5 items-center",children:[s.jsxs(W,{to:`/my-dishes/update/${e._id}`,className:"el__flow el__after_below justify-self-center w-fit flex gap-3 group cursor-pointer",children:[s.jsx(nr,{className:"icon__base el__flow group-hover:text-orange-500"}),s.jsx("span",{className:"el__flow txt__02 group-hover:text-orange-500",children:"Update"})]}),s.jsx("div",{className:"w-fit justify-self-center",children:s.jsx(Se,{txt:"Delete",border:!1,handleDelete:()=>t(e._id)})})]})]})},jd=()=>{k();const{propsForm:e,propsBlock:t,data:a,toggleSelected:n,selected:r,clearSelected:l,handleOpenPopup:i,handleOpenPopupBulkQuery:c,isError:o,error:d,isSuccess:u,isPending:p,closeAllDrop:m,id:g}=fd(),{watch:x}=e.formContext,y=x("search"),_=x("searchVals"),{totDocuments:h,nHits:w,dishes:b}=a??{};return s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-5",children:[s.jsx("span",{className:"txt__04",children:"My Dishes"}),s.jsx(re,{...e.formContext,children:s.jsx(ls,{...e,searchFields:Ra,filters:Aa,sorters:dt,closeAllDrop:m,id:g})}),u&&s.jsx(is,{nHits:w,totDocuments:h,search:y,searchVal:_==null?void 0:_[0]}),!!(r!=null&&r.length)&&s.jsxs("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 mt-3 px-3 gap-4 justify-items-start sm:justify-items-center",children:[s.jsx("div",{className:"w-full flex gap-5 border-2 border-red-600 rounded-xl py-2 px-4 pr-6 max-w-fit items-center",children:s.jsxs("span",{className:"txt__01",children:["Items selected: ",r.length]})}),s.jsx("button",{onClick:l,className:"w-full flex gap-5 border-2 border-green-600 rounded-xl py-2 px-4 pr-6 max-w-fit el__flow hover:text-green-600 hover:scale-110 cursor-pointer items-center",children:s.jsx("span",{className:"txt__02",children:"Cancel operation"})}),s.jsx("div",{className:"w-fit",children:s.jsx(Se,{txt:"Delete selected",handleDelete:i})}),s.jsx("div",{className:"w-fit",children:s.jsx(Se,{txt:"Delete results searched",handleDelete:c})})]}),s.jsx(X,{isPending:p,isError:o,error:d,children:!!(b!=null&&b.length)&&s.jsx("div",{className:"container__cards__grid",children:b.map(v=>s.jsx(yd,{dish:v,toggleSelected:n,selected:r},v._id))})}),s.jsx(qe,{...t,totPages:a==null?void 0:a.totPages})]})},_d=()=>{const{formContextMyDishesUpdate:e,formContextMyDishesSearch:t}=ue(),{showToastMsg:a,handleErrAPI:n}=F(),{setPopup:r,popup:l}=Te(),{setValue:i,reset:c}=e,o=pe(),d=D(),u=o==null?void 0:o.dishId,p=z.test(u??""),{isPendingIds:m,restInfo:g,isSuccessIds:x,isErrorIds:y,errorIds:_}=Ya(),{data:h,isPending:w,isSuccess:b,isError:v,error:N}=ne({queryKey:["myDishInfo",u],queryFn:()=>Jo(u??""),enabled:p});f.useEffect(()=>{(()=>{if(v)n({err:N});else if(b&&Object.keys(h??{}).length){const{dish:{name:T="",price:se=0,quantity:we=0,images:cs=[],restaurant:te=""}={}}=h??{};c({restaurant:te,items:[{name:T,price:se+"",quantity:we+"",images:cs}]})}})()},[n,b,v,N,h,u,i,c]);const{mutate:C,isPending:S}=R({mutationFn:({formData:O,id:T})=>sd({formData:O,id:T}),onSuccess:O=>{a("Dish updated successfully","SUCCESS");const{setValue:T}=t;T("searchVals",["id"]),T("search",O.dishId),T("updatedAtSort",["desc"]),d("/my-dishes",{replace:!0}),c()},onError:O=>{n({err:O})}}),I=e.handleSubmit(O=>{const T=ql(O);C({formData:T,id:u??""})}),{mutate:q,isPending:$}=R({mutationFn:()=>(r({...l,isPending:!0}),ed(u??"")),onSuccess:()=>{var T;a("Dish deleted successfully","SUCCESS");const{setValue:O}=t;O("searchVals",["restaurantId"]),O("search",((T=h==null?void 0:h.dish)==null?void 0:T.restaurant)??""),d("/my-dishes",{replace:!0}),c()},onError:O=>{n({err:O})},onSettled:()=>r(null)}),ce=()=>{q()},oe=()=>{r({txt:"delete this dish ?",greenLabel:"I change idea",redLabel:"Delete dish",isPending:$,confirmAction:ce})};return{formContext:e,handleSave:I,isPendingPage:m||w,restInfo:g,isSuccess:x&&b&&Object.keys((h==null?void 0:h.dish)??{}).length,canStay:p,handleOpenPopup:oe,isPendingUpdate:S,errorInfo:N,errorIds:_,isErrorIds:y,isErrorInfo:v}},wd=()=>{k();const{formContext:e,handleSave:t,isPendingPage:a,restInfo:n,isSuccess:r,canStay:l,handleOpenPopup:i,isPendingUpdate:c,errorInfo:o,errorIds:d,isErrorIds:u,isErrorInfo:p}=_d();return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-5 justify-items-center",children:[s.jsx("span",{className:"txt__04",children:"Update Dish"}),r&&s.jsx("div",{className:"justify-self-start",children:s.jsx(Se,{txt:"Delete Dish",handleDelete:i})}),s.jsx(X,{isPending:a,isError:u||p,error:d||o,canStay:l,children:s.jsx(re,{...e,children:s.jsx(Za,{formContext:e,handleSave:t,restInfo:n,isPending:c})})})]})},bd=()=>s.jsx(xe,{}),vd=({formContext:e,i:t,fieldHook:a})=>{var o,d,u,p;const{register:n,formState:{errors:r}}=e,l=t||t===0?`items.${t}.search`:"search",i=t||t===0?(u=(d=(o=r==null?void 0:r.items)==null?void 0:o[t])==null?void 0:d.search)==null?void 0:u.message:(p=r==null?void 0:r.search)==null?void 0:p.message,{place:c}=Ua({customFilter:m=>{var g,x,y;return(y=(x=(g=m.filter(_=>_.field===(a==null?void 0:a.searchVal)))==null?void 0:g[0])==null?void 0:x.label)==null?void 0:y.toLowerCase()}});return s.jsxs("div",{className:"w-full flex flex-col gap-3",children:[s.jsxs("label",{className:"w-full grid grid-cols-1 justify-items-start gap-2 relative",children:[s.jsx("input",{type:"text",placeholder:c,className:"focus__base el__flow outline-none border-2 border-orange-500 rounded-full w-full px-5 pr-14 py-2 txt__01",...n(l,{pattern:{value:hs,message:"Invalid search length or chars 🥸"}})}),s.jsx(Vt,{className:"absolute top-1/2 -translate-y-1/2 right-[20px] w-[25px] h-[25px] text-orange-500 pointer-events-none"})]}),i&&s.jsx("span",{className:"txt__01 text-red-600",children:i})]})},Nd=({searchFields:e,formContext:t,append:a,remove:n,fields:r,closeAllDrop:l})=>{const[i,c]=f.useState(!1),{register:o,watch:d,setValue:u}=t,p=d("searchVals"),m=g=>{(p??[]).includes(g)?(u("searchVals",d("searchVals").filter(x=>x!==g)),n(r.findIndex(x=>x.searchVal===g))):(u("searchVals",[...p,g]),a({searchVal:g,search:""}))};return s.jsxs("div",{className:"w-full grid grid-cols-1",children:[s.jsx(Y,{isOpen:i,setIsOpen:c,txt:"Text",Icon:qt,closeAllDrop:l}),s.jsx("div",{className:`w-full grid grid-cols-[repeat(auto-fit,minmax(250px,1fr))] gap-5 transition-all duration-300 ${i?"max-h-[700px] opacity-100 pointer-events-auto py-2":"opacity-0 max-h-0 pointer-events-none"}`,children:!!(e!=null&&e.length)&&e.map(g=>s.jsx(Va,{register:o,el:g,watch:d,handleChange:m},g.id))})]})},Sd=({formContext:e,filters:t,children:a,closeAllDrop:n})=>{const[r,l]=f.useState(!1),i=A();return s.jsxs("div",{className:"w-full grid grid-cols-1 gap-3 mt-5",children:[s.jsx(Y,{txt:"Filter by",Icon:Bt,isOpen:r,setIsOpen:l,closeAllDrop:n,customStyle:"pb-1 border-b-[3px] border-orange-500"}),s.jsxs("div",{className:`w-full grid grid-cols-1 pb-3 transition-all duration-300 gap-2 ${r?"max-h-[2000px] opacity-100 pointer-events-auto":"opacity-0 max-h-0 pointer-events-none"}`,children:[a,/^\/(my-dishes).*/.test(i.pathname)&&s.jsx(qa,{formContext:e,closeAllDrop:n}),!!(t!=null&&t.length)&&t.map(c=>s.jsx($a,{field:c,formContext:e,closeAllDrop:n},c.id))]})]})},Cd=({searchFields:e,formContext:t,sorters:a,filters:n,handleSave:r,handleClear:l,isPending:i,closeAllDrop:c})=>{const o=f.useRef(!1),d=A().pathname,{control:u}=t,{fields:p,append:m,remove:g}=Gs({control:u,name:"items"});return f.useEffect(()=>{!p.length&&p.length+1<2&&!o.current&&/^\/search\/?$/.test(d)&&(o.current=!0,m({search:"",searchVal:"name"}))},[p,d,m]),t?s.jsxs("form",{className:"w-full max-w-[90%] border-[3px] border-orange-500 rounded-xl p-6",children:[s.jsxs("div",{className:"w-full grid grid-cols-1",children:[s.jsx("div",{className:"w-full grid grid-cols-1 gap-4",children:p.map((x,y)=>f.createElement(vd,{formContext:t,i:y,fieldHook:p==null?void 0:p[y],key:y}))}),s.jsx(Sd,{formContext:t,searchFields:e,filters:n,closeAllDrop:c,children:s.jsx(Nd,{append:m,remove:g,fields:p,formContext:t,searchFields:e,closeAllDrop:c})}),s.jsx(Ba,{formContext:t,sorters:a,closeAllDrop:c})]}),s.jsxs("div",{className:"w-full grid grid-cols-2 mt-5",children:[s.jsx("div",{className:"sm:w-full justify-self-start w-[30vw] sm:max-w-[200px] sm:justify-self-center",children:s.jsx(le,{type:"submit",label:"Search",styleBtn:"text-green-600",styleTxt:"text-green-600 txt__02",handleClick:r,isPending:i})}),s.jsx("div",{className:"sm:w-full justify-self-end w-[30vw] sm:max-w-[200px] sm:justify-self-center",children:s.jsx(le,{type:"button",label:"Clear",styleBtn:"text-red-600",styleTxt:"text-red-600 txt__02",handleClick:l,isDisabled:i})})]})]}):null},Ed=async e=>M(()=>E.get(`/search?${e}`)),Id=async e=>M(()=>E.get(`/search/${e}`)),Pd=async(e,t)=>M(()=>E.get(`/search/dishes/${t}?${e}`)),Rd=(...e)=>[{label:"Avg price",field:Z({price:e[0]})},{label:"Dishes count",field:e[1]}].map(t=>({...t,id:j()})),Ad=({rest:e})=>s.jsxs(s.Fragment,{children:[s.jsx(de,{el:ha,children:ja(e.avgRating,e.reviewsCount).map(t=>s.jsxs("li",{className:"w-full grid grid-cols-[1fr_50px] items-center",children:[s.jsx("span",{className:"txt__01",children:t.label}),s.jsx("span",{className:"txt__01 justify-self-end",children:t.field})]},t.id))}),s.jsx(de,{el:ya,children:Rd(e.avgPrice,e.dishesCount).map(t=>s.jsxs("li",{className:"w-full grid grid-cols-[1fr_50px] items-center",children:[s.jsx("span",{className:"txt__01",children:t.label}),s.jsx("span",{className:"txt__01 justify-self-end",children:t.field})]},t.id))})]}),Ja=({path:e})=>s.jsxs(W,{to:e,className:"absolute min-w-[150px] min-h-[50px] border-2 border-orange-500 rounded-xl bg-[#000] top-0 -translate-y-1/2 -right-6 z-20 flex gap-5 items-center px-3 pr-10 group cursor-pointer",children:[s.jsx(De,{className:"icon__base el__flow group-hover:text-orange-500"}),s.jsx("span",{className:"txt__02 el__flow group-hover:text-orange-500",children:"Admin page"})]}),Dd=({rest:e})=>s.jsxs("div",{className:"card__el border-orange-500 relative",children:[e.isAdmin&&s.jsx(Ja,{path:`/my-restaurants/${e._id}`}),s.jsx(ot,{name:e.name}),s.jsxs("div",{className:"sm:grid grid-cols-2 place-items-center place-content-center",children:[s.jsx("div",{className:"flex w-full sm:w-[90%] sm:h-[90%] sm:py-3 items-center sm:border-2 border-orange-500 rounded-xl",children:s.jsx(rs,{images:e.images})}),s.jsx("div",{className:"w-full grid grid-cols-1",children:s.jsxs("div",{className:"pt-3 w-full el__flow grid grid-cols-1 gap-3 px-3",children:[s.jsx(bs,{rest:e,Container:de}),s.jsx(Ad,{rest:e})]})})]}),s.jsx("div",{className:"w-full max-w-fit justify-center justify-self-center flex mt-5",children:s.jsx(W,{to:`/search/${e._id}`,className:"txt__02 border-2 border-orange-500 rounded-xl px-12 py-1 el__flow hover:text-orange-500 hover:scale-110 cursor-pointer",children:"View Menu"})})]}),Td=()=>{k();const{formContextSearchRestAllUsers:e}=ue(),{handleSave:t,handleClear:a,propsBlock:n,data:r,isPending:l,isError:i,error:c,isSuccess:o,closeAllDrop:d,id:u}=Be({formCtx:e,key:"searchAllUsersRest",cbAPI:Ed,cbProcessForm:kl}),{watch:p}=e,m=p("items"),g=(m==null?void 0:m.length)&&m.filter(b=>!!(b!=null&&b.search)),x=g==null?void 0:g[(g==null?void 0:g.length)-1],{totDocuments:y,nHits:_,totPages:h,restaurants:w}=r??{};return s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-5",children:[s.jsx(re,{...e,children:s.jsx(Cd,{searchFields:Da,filters:zc,sorters:Yc,formContext:e,isPending:l,handleSave:t,handleClear:a,closeAllDrop:d,id:u})}),o&&s.jsx(is,{nHits:_,totDocuments:y,search:x==null?void 0:x.search,searchVal:x==null?void 0:x.searchVal}),s.jsx(X,{isPending:l,isError:i,error:c,children:!!(w!=null&&w.length)&&s.jsx("div",{className:"container__cards",children:w.map(b=>s.jsx(Dd,{rest:b},b._id))})}),s.jsx(qe,{...n,totPages:h})]})},en=()=>s.jsx("div",{className:"w-[40px] h-[40px] border-[3px] border-orange-500 rounded-full border-l-transparent border-r-transparent mini_spinner"}),Fd=({dish:e})=>{const[t,a]=f.useState(null),n=Q(),{showToastMsg:r,handleErrAPI:l}=F(),{setInfoPop:i}=Fe(),{mutate:c}=R({mutationFn:()=>hl({dishId:t}),onSuccess:()=>{r("Cart replaced","SUCCESS")},onError:d=>l({err:d}),onSettled:()=>{i(null),n.removeQueries({queryKey:["myCart"]})}});return{handleOpenInfoPop:()=>{a(e._id),i({msg:"Do you prefer keeping existing cart or delete it and start new one ?",confirmActMsg:"Start new cart",cancelActMsg:"Keep existing cart",confirmActCb:()=>{i(d=>({...d,isPendingConfirm:!0})),c()},cancelActCb:()=>i(null)})}}},sn=({dish:e})=>{const t=Q(),{showToastMsg:a,handleErrAPI:n}=F(),{mutate:r,isPending:l}=R({mutationFn:c=>c==="inc"?ul({dishId:e._id}):c==="dec"?ml({dishId:e._id}):c==="del-item"?pl({dishId:e.dishId??e._id}):null,onSuccess:c=>{Pe(()=>a((c==null?void 0:c.msg)??"","SUCCESS"))},onError:c=>{Pe(()=>{var o,d,u;[400,404].includes(((o=c==null?void 0:c.response)==null?void 0:o.status)??400)&&/^\/(my-cart)\/(del-item)\?dishId=([a-f0-9]{24})$/.test(((u=(d=c==null?void 0:c.response)==null?void 0:d.config)==null?void 0:u.url)??"")?a("Item removed from cart","SUCCESS"):n({err:c})})},onSettled:()=>t.resetQueries({queryKey:["myCart"]})});return{handleClickCart:c=>r(c),isPending:l}},Md=({dish:e})=>{var C;const[t,a]=f.useState(0),n=f.useRef(null),[r,l]=f.useState(!1),i=Q(),{showToastMsg:c,handleErrAPI:o}=F(),{handleOpenInfoPop:d}=Fd({dish:e}),{cart:u}=ye(),p=V(u)&&(u!=null&&u.items)&&((C=u.items.find(S=>S.dishId===e._id))==null?void 0:C.quantity)||0;let m=!0;p>=e.quantity&&(m=!1),f.useEffect(()=>{a(p)},[p]);const{handleClickCart:g,isPending:x}=sn({dish:e}),y=()=>{clearInterval(n.current),n.current=null},_=S=>{a(S==="inc"?I=>I+1:S==="dec"?I=>I-1:0)},h=()=>{y(),l(!0),n.current=setInterval(()=>{a(S=>S>=e.quantity?(y(),S):S+1)},150)},w=()=>{y(),l(!0),n.current=setInterval(()=>{a(S=>S<=1?(y(),S):S-1)},150)},{isPending:b,mutate:v}=R({mutationFn:({dishId:S,quantity:I})=>fl({dishId:S,quantity:I}),onSuccess:()=>Pe(()=>{c("Cart updated ✌🏼","SUCCESS")}),onError:S=>Pe(()=>{o({err:S})}),onSettled:()=>i.resetQueries({queryKey:["myCart"]})});return{handleClickCart:g,handleAddInt:h,handleDecInt:w,handleMouseUp:S=>{if(n!=null&&n.current&&y(),r){if(l(!1),V(u)&&(u==null?void 0:u.restaurant)!==(e==null?void 0:e.restaurant)){d();return}t===p?(_(S),g(S)):v({dishId:e._id,quantity:t})}},isPending:x||b,setLocalQty:a,localQty:t,qtyItem:p,isAvl:m}},kd=({dish:e})=>{const{handleClickCart:t,handleAddInt:a,handleDecInt:n,handleMouseUp:r,isPending:l,setLocalQty:i,localQty:c,qtyItem:o,isAvl:d}=Md({dish:e});return s.jsxs("div",{className:"w-full max-w-full grid grid-cols-[1fr_75px] mt-3",children:[s.jsxs("div",{className:"w-full flex gap-6 items-center justify-center",children:[s.jsx("button",{disabled:!e.quantity||!d||l,onMouseDown:a,onMouseUp:()=>r("inc"),onMouseLeave:()=>r("inc"),className:"border-green-600 el__flow btn__icon group",children:s.jsx(Ht,{className:"group-hover:text-green-600 el__flow btn__icon_icon"})}),l?s.jsx(en,{}):s.jsx("span",{className:"txt__03",children:c}),s.jsx("button",{onMouseDown:n,onMouseUp:()=>r("dec"),onMouseLeave:()=>r("dec"),disabled:!o||o===1||l,className:"border-yellow-600 el__flow btn__icon group",children:s.jsx(Kt,{className:"btn__icon_icon  group-hover:text-yellow-600 el__flow"})})]}),s.jsx("button",{onClick:()=>{i(0),t("del-item")},disabled:!o||l,className:"btn__icon el__flow border-red-600   justify-self-end group",children:s.jsx(Ce,{className:"btn__icon_icon el__flow  group-hover:text-red-600"})})]})},Ld=({dish:e})=>{var C;const t=f.useRef(null),a=f.useRef(!1),[n,r]=f.useState(0),l=(C=pe())==null?void 0:C.restId,{handleClickCartNonLogged:i,cartNonLogged:c,handleUpdateByInt:o,changeRest:d}=ye(),{setInfoPop:u}=Fe(),p=V(c)&&(c!=null&&c.items)?c.items.findIndex(S=>S.dishId===e._id):-1,m=p!==-1?c==null?void 0:c.items[p].quantity:0,g=m<e.quantity,x=()=>u({msg:"Do you prefer keeping old cart or delete it and start ordering from this restaurant ?",confirmActMsg:"Start new cart",confirmActCb:()=>{d({dish:e,restId:l??""}),u(null)},cancelActMsg:"Keep existing cart",cancelActCb:()=>u(null)});f.useEffect(()=>{r(m)},[m]);const y=()=>{clearInterval(t.current),t.current=null},_=S=>r(I=>S==="inc"?I+1:I-1),h=()=>{if(V(c)&&(c!=null&&c.totQty)&&c.restaurant!==l){x();return}y(),a.current=!0,t.current=setInterval(()=>{r(S=>S>=e.quantity?(y(),S):S+1)},125)},w=()=>{y(),a.current=!0,t.current=setInterval(()=>{r(S=>S<=1?(y(),S):S-1)},125)},b=S=>{a.current&&(y(),a.current=!1,n===m?(_(S),i({restId:l,dish:e,action:S})):o({dish:e,restId:l??"",quantity:n}))},v=()=>b("inc"),N=()=>b("dec");return s.jsxs("div",{className:"w-full max-w-full grid grid-cols-[1fr_75px] mt-3",children:[s.jsxs("div",{className:"w-full flex gap-6 items-center justify-center",children:[s.jsx("button",{disabled:!e.quantity||!g,onMouseDown:h,onMouseLeave:v,onMouseUp:v,className:"border-green-600 el__flow btn__icon group",children:s.jsx(Ht,{className:"group-hover:text-green-600 el__flow btn__icon_icon"})}),s.jsx("span",{className:"txt__03",children:n}),s.jsx("button",{onMouseDown:w,onMouseLeave:N,onMouseUp:N,disabled:!m||m===1,className:"border-yellow-600 el__flow btn__icon group",children:s.jsx(Kt,{className:"btn__icon_icon  group-hover:text-yellow-600 el__flow"})})]}),s.jsx("button",{onClick:()=>i({action:"del-item",dish:e}),disabled:!m,className:"btn__icon el__flow border-red-600   justify-self-end group",children:s.jsx(Ce,{className:"btn__icon_icon el__flow  group-hover:text-red-600"})})]})},Od=({dish:e,isAdmin:t})=>{const{isLogged:a}=L();return s.jsxs("div",{className:"card__el border-orange-500 relative",children:[t&&s.jsxs(W,{to:`/my-dishes/update/${e._id}`,className:"absolute min-w-[150px] min-h-[50px] border-2 border-orange-500 rounded-xl bg-[#000] top-0 -translate-y-1/2 -right-6 z-20 flex gap-5 items-center px-3 pr-10 group cursor-pointer",children:[s.jsx(De,{className:"icon__base el__flow group-hover:text-orange-500"}),s.jsx("span",{className:"txt__02 el__flow group-hover:text-orange-500",children:"Update dish"})]}),s.jsx(ot,{name:e.name}),s.jsxs("div",{className:"sm:grid grid-cols-2 place-items-center place-content-center",children:[s.jsx("div",{className:"flex w-full sm:w-[90%] sm:h-[90%] sm:py-3 items-center sm:border-2 border-orange-500 rounded-xl",children:s.jsx(rs,{images:e.images})}),s.jsxs("ul",{className:"w-full grid grid-cols-1 gap-4 px-3 pr-6 sm:py-1 self-start",children:[Zc(e.price,e.quantity).map((n,r)=>s.jsxs("li",{className:"w-full grid grid-cols-[1fr_50px] first:pt-2",children:[s.jsxs("div",{className:"w-full flex gap-5 items-center",children:[s.jsx(n.icon,{className:"icon__base"}),s.jsx("span",{className:"txt__01",children:n.label})]}),s.jsx("span",{className:"txt__01 justify-self-end",children:n.val})]},r)),a?s.jsx(kd,{dish:e}):s.jsx(Ld,{dish:e})]})]})]})},Ud=({nHits:e,totDocuments:t,minPrice:a,maxPrice:n,minQuantity:r,maxQuantity:l,errors:i})=>{let c="";if(!(i!=null&&i.minPrice)&&!(i!=null&&i.maxPrice)){a&&(c+=` above ${Z({price:+a})}`);const o=Z({price:+n||0});n&&(c+=` ${a&&n?"and":""} below ${o}`)}return!(i!=null&&i.minQuantity)&&!(i!=null&&i.maxQuantity)&&(r&&(c+=` ${a||n?", and ":""}above ${r}`),l&&(c+=`${r?" and":a||n?", and":" "} below ${l}`)),s.jsx("div",{className:"w-full grid grid-cols-1",children:t?e?s.jsxs("div",{className:"w-full flex gap-5 items-center mt-[25px]",children:[s.jsx(Qt,{className:"min-w-[35px] min-h-[35px]"}),s.jsxs("div",{className:"w-fit flex gap-2 items-center",children:[s.jsxs("span",{className:"txt__04",children:[e," "]}),s.jsxs("span",{className:"txt__03",children:["Result",e>1?"s":"",c]})]})]}):s.jsx("div",{className:"w-full flex justify-self-center justify-center items-center mt-[50px]",children:s.jsxs("span",{className:"txt__03",children:["Results Number(new String()) 🥸",c]})}):s.jsx("div",{className:"w-full flex justify-self-center justify-center mt-[50px]",children:s.jsx("span",{className:"txt__03",children:"This restaurant does not have dishes right now, they are strategically preparing 🧐"})})})},$d=({coupon:e})=>M(()=>E.post("/my-orders/checkout",{coupon:e??null})),Vd=e=>M(()=>E.get(`/my-orders/checkout?orderId=${e}`)),qd=(e,t)=>M(()=>E.put(`/my-orders/checkout?orderId=${e}`,{...t})),Bd=async e=>M(()=>E.get(`/my-orders/checkout-poll?orderId=${e}`)),Qd=e=>M(()=>E.get(`/my-orders?${e}`)),Gd=e=>M(()=>E.delete(`/my-orders/del-pending/${e}`)),zd=e=>M(()=>E.patch(`/my-orders/refund-confirmed/${e}`)),Yd=e=>M(()=>E.get(`/my-orders/fresh-status/${e}`)),Hd=({dish:e})=>{const t=f.useRef(!1),a=Q(),{showToastMsg:n,handleErrAPI:r}=F(),{register:l,setValue:i,formState:{errors:c},handleSubmit:o,getValues:d}=U({mode:"onChange",defaultValues:{quantity:(e==null?void 0:e.quantity)+""}});f.useEffect(()=>{i("quantity",(e==null?void 0:e.quantity)+"")},[e,i]);const{isPending:u,mutate:p}=R({mutationFn:g=>gl({dishId:e.dishId,quantity:g||"1"}),onSuccess:()=>{Pe(()=>{n("Cart updated","SUCCESS");const g=document.querySelectorAll(".input__blur");if(g!=null&&g.length){let x=0;do if(document.activeElement===g[x]){g[x].blur();break}else x++;while(x<g.length)}})},onError:g=>{Pe(()=>{r({err:g}),i("quantity",(e==null?void 0:e.quantity)+"")})},onSettled:()=>{t.current=!1,a.resetQueries({queryKey:["myCart"]})}}),m=o(g=>{+d("quantity")!==e.quantity&&(t.current=!0,p(g.quantity))});return{register:l,errors:c,isPendingInputQTy:u,changeQtyInput:m,isMutating:t}},Le={field:"quantity",msg:"Invalid quantity value",reg:la},Kd=({item:e})=>{const{handleClickCart:t,isPending:a}=sn({dish:e}),{register:n,errors:r,isPendingInputQTy:l,changeQtyInput:i,isMutating:c}=Hd({dish:e}),{data:o,mutate:d}=R({mutationFn:()=>sa({dishId:e.dishId})}),u=()=>d();return s.jsxs("li",{className:"w-full grid gap-y-1 items-center md:grid-cols-2 gap-10",children:[s.jsxs("form",{onSubmit:i,className:"w-full flex gap-5 justify-between items-center",children:[s.jsx("span",{className:"txt__01",children:e.name}),s.jsx("span",{className:"txt__03 md:justify-self-start",children:"x"}),s.jsx("input",{step:"any",type:"number",className:"txt__01 border-orange-500 border-2 outline-none rounded-xl focus__base el__flow px-3 py-[0.1rem] max-w-[100px] md:justify-self-start input__blur",...n(Le.field,{pattern:{value:Le.reg,message:Le.msg},validate:p=>{var m;return+p?+p>(((m=o==null?void 0:o.dish)==null?void 0:m.quantity)??0)?"Dish not available":!0:"Quantity must be a positive number"}}),onBlur:()=>{var p;return(p=r==null?void 0:r.quantity)!=null&&p.message||c.current?null:i()},onFocus:u})]}),s.jsxs("div",{className:"w-full flex gap-5 justify-between items-center",children:[s.jsx("span",{className:"txt__01 justify-self-start",children:Z({price:e.price})}),s.jsx("span",{className:"txt__01 justify-self-center",children:js(e)}),a||l?s.jsx("div",{className:"justify-self-end",children:s.jsx(en,{})}):s.jsx("button",{disabled:a,onClick:()=>t("del-item"),className:"w-fit p-1 border-2 border-red-600 rounded-xl group hover:scale-120 el__flow flex items-center justify-center cursor-pointer justify-self-end",children:s.jsx(Ce,{className:"min-w-[25px] min-h-[25px] group-hover:text-red-600 el__flow"})})]}),(r==null?void 0:r.quantity)&&s.jsx("span",{className:"txt__01 text-red-600",children:r.quantity.message})]})},Wd=({item:e})=>{const{handleClickCartNonLogged:t,handleUpdateByInput:a}=ye(),{register:n,formState:{errors:r},setValue:l,handleSubmit:i,getValues:c}=U({mode:"onChange",defaultValues:{quantity:e.quantity+""}}),o=i(m=>{if(+m.quantity===e.quantity)return;a({dishId:e.dishId,quantity:m.quantity});const g=document.getElementsByClassName("input__blur");if(!(g!=null&&g.length))return;let x=0;do{if(document.activeElement===g[x]){g[x].blur();break}x++}while(x<g.length)});f.useEffect(()=>{l("quantity",e.quantity+"")},[l,e.quantity]);const{data:d,mutate:u}=R({mutationFn:()=>sa({dishId:e.dishId})}),p=()=>u();return s.jsxs("li",{className:"w-full grid gap-y-1 items-center md:grid-cols-2 gap-10",children:[s.jsxs("form",{onSubmit:o,className:"w-full flex gap-5 justify-between items-center",children:[s.jsx("span",{className:"txt__01",children:e.name}),s.jsx("span",{className:"txt__03 md:justify-self-start",children:"x"}),s.jsx("input",{step:"any",type:"number",className:"txt__01 border-orange-500 border-2 outline-none rounded-xl focus__base el__flow px-3 py-[0.1rem] max-w-[100px] md:justify-self-start input__blur",...n(Le.field,{pattern:{value:Le.reg,message:Le.msg},validate:m=>{var g;return+m?+m>(((g=d==null?void 0:d.dish)==null?void 0:g.quantity)??0)?"Dish not available":!0:"Quantity must be a positive number"}}),onBlur:()=>{var m;return(m=r==null?void 0:r.quantity)!=null&&m.message?null:a({quantity:c("quantity"),dishId:e.dishId})},onFocus:p})]}),s.jsxs("div",{className:"w-full flex gap-5 justify-between items-center",children:[s.jsx("span",{className:"txt__01 justify-self-start",children:Z({price:e.price})}),s.jsx("span",{className:"txt__01 justify-self-center",children:js(e)}),s.jsx("button",{onClick:()=>t({action:"del-item",dish:e}),className:"w-fit p-1 border-2 border-red-600 rounded-xl group hover:scale-120 el__flow flex items-center justify-center cursor-pointer justify-self-end",children:s.jsx(Ce,{className:"min-w-[25px] min-h-[25px] group-hover:text-red-600 el__flow"})})]}),(r==null?void 0:r.quantity)&&s.jsx("span",{className:"txt__01 text-red-600",children:r.quantity.message})]})},Zd=({cart:e,rest:t})=>{const a=((e==null?void 0:e.totPrice)??0)>=t.delivery.freeDeliveryPrice;return s.jsxs("div",{className:"w-full flex flex-col gap-2",children:[s.jsxs("div",{className:"w-full flex justify-between items-center",children:[s.jsx("span",{className:"txt__01",children:a?"Total":"Subtotal"}),s.jsx("span",{className:"txt__01",children:Z({price:(e==null?void 0:e.totPrice)??0})})]}),!a&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"w-full flex justify-between items-center",children:[s.jsx("span",{className:"txt__01",children:"Delivery"}),s.jsx("span",{className:"txt__01",children:Z({price:t.delivery.price})})]}),s.jsxs("div",{className:"w-full flex justify-between items-center",children:[s.jsx("span",{className:"txt__01",children:"Total"}),s.jsx("span",{className:"txt__01",children:Bl((e==null?void 0:e.totPrice)??0,t.delivery.price)})]})]})]})},Xd=()=>{const e=Q(),{showToastMsg:t,handleErrAPI:a}=F(),{isLogged:n}=L(),{mutate:r,isPending:l}=R({mutationFn:xl,onSuccess:c=>{t((c==null?void 0:c.msg)??"","SUCCESS")},onError:c=>{var o,d,u;[400,404].includes(((o=c==null?void 0:c.response)==null?void 0:o.status)??400)&&/^\/(my-cart)\/(del-item)\?dishId=([a-f0-9]{24})$/.test(((u=(d=c==null?void 0:c.response)==null?void 0:d.config)==null?void 0:u.url)??"")?t("Cart deleted","SUCCESS"):a({err:c})},onSettled:()=>e.removeQueries({queryKey:["myCart"]})});return{handleDeleteCart:()=>n?r():null,isPending:l}},Jd=({rest:e})=>{const t=D(),a=A(),n=Q(),{handleErrAPI:r}=F(),{register:l,formState:{errors:i},handleSubmit:c}=U({mode:"onChange"}),{isPending:o,mutate:d}=R({mutationFn:v=>$d({coupon:v}),onSuccess:v=>Pe(()=>{t(`/my-orders/checkout?orderId=${v.orderId}`,{state:{from:a.pathname}})}),onError:v=>r({err:v}),onSettled:()=>n.removeQueries({queryKey:["myCart"]})}),u=c(v=>{d((v==null?void 0:v.coupon)??void 0)}),{cart:p,cartNonLogged:m,setCartNonLogged:g}=ye(),{isLogged:x}=L(),{isPending:y,handleDeleteCart:_}=Xd(),h=x?p:m,w=()=>x?null:t("/auth/login",{state:{from:a.pathname}}),b=()=>g(null);return h&&V(h)&&s.jsxs("div",{className:"w-full grid grid-cols-1 gap-4 border-[3px] border-orange-500 rounded-xl p-6 mb-6",children:[s.jsx("span",{className:"txt__03 justify-self-center",children:"Your Order"}),s.jsx("ul",{className:"w-full grid gap-5",children:h.items.map(v=>x?s.jsx(Kd,{item:v},v.dishId):s.jsx(Wd,{item:v},v.dishId))}),s.jsx(Zd,{cart:h,rest:e}),s.jsxs("form",{onSubmit:u,className:"w-full grid gap-6",children:[x&&s.jsx(ie,{field:Wc,register:l,errors:i}),s.jsxs("div",{className:"w-full grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-4 sm:gap-0 sm:grid-cols-2 items-center",children:[s.jsx("div",{className:`${x?"w-[200px]":"w-[250px]"} justify-self-center flex `,children:s.jsx(J,{label:x?"Checkout":"Login now to order",type:x?"submit":"button",isDisabled:y,handleClick:w,isPending:o})}),s.jsx("div",{className:"w-[200px] justify-self-center",children:s.jsx(Se,{txt:"Clear",handleDelete:x?_:b,isDisabled:o,isPending:y})})]})]})]})},eu=()=>{var os;k();const{handleErrAPI:e}=je(),{isLogged:t}=L(),{cart:a,cartNonLogged:n}=ye(),{formContextSearchDishesAllUSers:r}=ue(),{watch:l,formState:{errors:i}}=r,c=l("minPrice"),o=l("maxPrice"),d=l("minQuantity"),u=l("maxQuantity"),p=(os=pe())==null?void 0:os.restId,m=z.test(p??""),{data:g,isPending:x,isSuccess:y,isError:_,error:h}=ne({queryKey:["restAsUser",p],queryFn:()=>Id(p??""),enabled:m});f.useEffect(()=>{_&&e({err:h})},[y,_,h,g,e]);const{restaurant:w}=g??{},b=t?a:n,v=V(b)&&(b==null?void 0:b.totQty)&&(b==null?void 0:b.restaurant)===(w==null?void 0:w._id),{handleSave:N,handleClear:C,propsBlock:S,data:I,isPending:q,isError:$,error:ce,isSuccess:oe,closeAllDrop:O,id:T}=Be({formCtx:r,key:"searchDishesAsUser",cbAPI:Ee=>Pd(Ee,p??""),cbProcessForm:Ws}),{dishes:se,totDocuments:we,totPages:cs,nHits:te,isAdmin:me}=I??{};return s.jsx(X,{isPending:x,isError:_,error:h,canStay:m,children:w&&V(w)&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"w-full grid grid-cols-1 justify-items-center gap-5",children:[s.jsx("span",{className:"txt__04 truncate max-w-full",children:w.name}),w.isAdmin&&s.jsxs(W,{to:`/my-restaurants/${w._id}`,className:"justify-self-end border-2 border-orange-500 py-1 sm:py-2 px-4 pr-6 rounded-xl group flex gap-4 items-center hover:scale-110 el__flow cursor-pointer",children:[s.jsx(De,{className:"icon__base group-hover:text-orange-500 el__flow"}),s.jsx("span",{className:"txt__02 group-hover:text-orange-500 el__flow",children:"Admin page"})]}),s.jsx(ut,{images:w.images}),s.jsx("div",{className:"w-full grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-y-3 gap-x-6 items-start",children:s.jsx(bs,{rest:w,Container:de})}),v&&s.jsx("div",{className:"w-full mt-6",children:s.jsx(Jd,{rest:w})}),s.jsx(re,{...r,children:s.jsx(ls,{formContext:r,handleSave:N,handleClear:C,closeAllDrop:O,isPending:q,sorters:Kc,id:T})}),oe&&s.jsx(Ud,{nHits:te,totDocuments:we,minPrice:c,maxPrice:o,minQuantity:d,maxQuantity:u,errors:i}),s.jsx(X,{isPending:q,isError:$,error:ce,children:!!(se!=null&&se.length)&&s.jsx("div",{className:"container__cards",children:se.map(Ee=>s.jsx(Od,{dish:Ee,isAdmin:me},Ee._id))})}),s.jsx(qe,{...S,totPages:cs})]})})})},su=()=>{var i;const[e]=ae(),t=A(),{notice:a}=Fr(),n=e.get("type"),r=(i=t==null?void 0:t.state)==null?void 0:i.from;return ve(["verify-account","recover-pwd","sentEmailUnsubscribe","change-email","change-pwd"],n??"")&&ve(["/auth/register","/auth/login","/newsletter/notice-unsubscribe-with-retry","/user/manage-account"],r)?s.jsx("div",{className:"w-full flex justify-center items-center",children:s.jsx("div",{className:"w-full flex flex-col items-center gap-30",children:a?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"txt__04 leading-10 lg:leading-16",children:a.msg}),s.jsx("div",{className:"w-full flex justify-center items-center",children:a.type==="success"?s.jsx(Xe,{className:"notice text-red-600"}):s.jsx(rr,{className:"notice text-red-600"})})]}):null})}):s.jsx(G,{to:"/",replace:!0})},tn=[...[Ve].map(({svg:e,...t})=>({...t,id:j(),required:!0})),..._s.map(e=>({...e,id:j(),required:!0}))],an=[...ss.map(e=>({...e,id:j(),required:!0}))],nn=[...ts.map(e=>({...e,id:j(),required:!0}))],rn={fields_0:{id:j(),sudFields:tn},fields_1:{id:j(),sudFields:an},fields_2:{id:j(),sudFields:nn}},Is=Object.keys(rn).length,ks=[[...tn.map(e=>({field:e.field,reg:e.reg}))],[...an.map(e=>({field:e.field,reg:e.reg}))],[...nn.map(e=>({field:e.field,reg:e.reg}))]],tu=(...e)=>[{label:"Subtotal",val:e[0]},{label:"Delivery",val:e[1]},{label:"Discount",val:e[2]},{label:"Total",val:e[3]}].map(t=>({...t,id:j()})),ln={email:"",firstName:"",lastName:"",country:"",state:"",city:"",street:"",zipCode:"",phone:""},au=()=>{var y;const[e]=ae(),t=A(),a=D(),n=U({mode:"onChange",defaultValues:ln}),r=Q(),l=e.get("orderId"),{handleErrAPI:i}=F(),c=z.test(l??"")&&/^\/(search)\/([a-f0-9]{24})$/.test((y=t==null?void 0:t.state)==null?void 0:y.from),o=Mr(),{setInfoPop:d}=Fe(),{data:u,isPending:p,isError:m,isSuccess:g,error:x}=ne({queryKey:["infoOrder",l],queryFn:()=>Vd(l??""),enabled:c});return f.useEffect(()=>{var _,h,w,b;if(g){const{order:v}=u??{};if(V(v)){for(const N in v.infoUser)n.setValue(N,v.infoUser[N]);for(const N in v.addressUser)n.setValue(N,v.addressUser[N])}}m&&(i({err:x,push:!0}),(h=(_=x==null?void 0:x.response)==null?void 0:_.data)!=null&&h.remakeCart?(r.removeQueries({queryKey:["myCart"]}),setTimeout(()=>{var v,N;d({msg:`We thought you might want to review cart up to stock to make new order ${(N=(v=x==null?void 0:x.response)==null?void 0:v.data)!=null&&N.resetCoupon?"and do not worry about coupon, we made it active again":""}`,confirmActMsg:"Go to cart",cancelActMsg:"Close",confirmActCb:()=>{var C,S;a(`/search/${((S=(C=x==null?void 0:x.response)==null?void 0:C.data)==null?void 0:S.restId)??""}`),d(null)},cancelActCb:()=>d(null)})},100)):(b=(w=x==null?void 0:x.response)==null?void 0:w.data)!=null&&b.resetCoupon&&setTimeout(()=>{d({msg:"Do not worry about coupon, we made it active again so you will be able to use again",confirmActMsg:"Get it",cancelActMsg:"_",confirmActCb:()=>d(null),cancelActCb:()=>d(null)})},100))},[u,p,m,g,x,n,i,d,r,a]),{formContext:n,stripePromise:o,canStay:c,isErrorInfo:m,isPendingInfo:p,errorInfo:x,dataInfo:u}},cn=({order:e,totOrder:t})=>s.jsx("ul",{className:"w-full grid gap-3 ",children:(()=>{const a=[],n=tu(e.totPrice,e.delivery,e.discount,t/100);let r=0;do{const l=n[r];if(l.label==="Discount"&&!l.val){r++;continue}a.push(s.jsxs("li",{className:"w-full flex justify-between items-center",children:[s.jsx("span",{className:"txt__02",children:l.label}),s.jsx("span",{className:"txt__02",children:l.label==="Delivery"&&!l.val?"Free":Z({price:l.val})})]},l.id)),r++}while(r<n.length);return a})()}),nu=({order:e,totStripe:t,children:a})=>s.jsxs("div",{className:"w-full grid gap-5 items-start h-fit",children:[s.jsx("span",{className:"txt__03 justify-self-center",children:"Order Details"}),s.jsxs("div",{className:"justify-items-center items-start border-[3px] border-orange-500 rounded-xl p-6",children:[s.jsx(cn,{order:e,totOrder:t}),s.jsx(Wt,{className:"w-full mt-6 border-2 border-orange-500 py-3 px-4 rounded-xl",options:{style:{base:{color:"#ffffff",fontSize:"18px"}}}}),a]})]}),ru=({formContext:e,currForm:t,setCurrForm:a})=>{const[n,r]=f.useState(!0),[l,i]=f.useState(!0),{register:c,formState:{errors:o},watch:d}=e,u=d();f.useEffect(()=>{(()=>{var _;const x=ks[t];let y=!0;for(const h in u){const w=x.find(b=>b.field===h);if(w&&!((_=w==null?void 0:w.reg)!=null&&_.test(u[h]))){y=!1;break}}i(!y),r(!t)})()},[d,t,u]);const p=()=>t?a(g=>g-1):null,m=()=>t>=Is||l?null:a(g=>g+1);return s.jsxs("div",{className:"w-full grid gap-4",id:"swapFormOrders",children:[s.jsx("span",{className:"txt__03 justify-self-center",children:"Your profile details"}),s.jsxs("div",{className:"w-full p-6 border-[3px] border-orange-500 max-w-[600px] rounded-xl grid place-content-center gap-10",children:[s.jsx("div",{className:"w-full overflow-hidden py-5",children:s.jsx("div",{className:"w-full grid grid-cols-3 min-w-[300%] transition-all duration-500",style:{transform:`translateX(-${t*100/Is}%)`},children:Object.entries(rn).map(([g,x],y)=>s.jsx("div",{className:`w-full grid justify-items-center h-fit items-start gap-6 sm:px-3 transition-all duration-300 ${y===t?"opacity-100":"opacity-0"}`,children:x.sudFields.map(_=>s.jsx(ie,{register:c,errors:o,field:_},_.id))},x.id))})}),s.jsx("div",{className:"w-full",children:s.jsx(ns,{handleNext:m,handlePrev:p,totLen:Is,hiddenLg:!1,isNextDisabled:l,isPrevDisabled:n,currForm:t})})]})]})},lu=({formContext:e,order:t,backPaymentInt:a})=>{const[n,r]=f.useState(!1),l=D(),[i,c]=f.useState(0),o=lr(),d=ir(),u=Q(),{handleErrAPI:p,showToastMsg:m}=F(),{formContextSearchMyOrders:g}=ue(),{setInfoPop:x}=Fe(),y=()=>{let N=!1;for(const C in ln)if(e.formState.errors[C]){N=!0;break}return N},_=async(N=0)=>{if(N>=10){m("Error processing order payment","ERROR"),r(!1);return}try{await Bd((t==null?void 0:t._id)??""),m("Payment successful","SUCCESS"),r(!1);const{setValue:S}=g;S("createdAtSort",["desc"]),S("search",t._id),S("searchVals",["id"]),l("/my-orders",{replace:!0})}catch{setTimeout(()=>{_(N+1)},2e3)}},{mutate:h,isPending:w}=R({mutationFn:N=>qd((t==null?void 0:t._id)??"",N),onSuccess:async()=>{const{paymentClientSecret:N}=t??{};if(!o||!d||!N)return;const C=d.getElement(Wt);if(!C)return;r(!0);const{error:S,paymentIntent:I}=await o.confirmCardPayment(N,{payment_method:{card:C}});(I==null?void 0:I.status)==="succeeded"&&!S?_():(m("Payment failed","ERROR"),r(!1))},onError:N=>{var C,S,I,q;p({err:N,push:!0}),(S=(C=N==null?void 0:N.response)==null?void 0:C.data)!=null&&S.remakeCart?(u.removeQueries({queryKey:["myCart"]}),setTimeout(()=>{var $,ce;x({msg:`We thought you might want to review cart up to stock to make new order ${(ce=($=N==null?void 0:N.response)==null?void 0:$.data)!=null&&ce.resetCoupon?"and do not worry about coupon, we made it active again":""}`,confirmActMsg:"Go to cart",cancelActMsg:"Close",confirmActCb:()=>{var oe,O;l(`/search/${((O=(oe=N==null?void 0:N.response)==null?void 0:oe.data)==null?void 0:O.restId)??""}`),x(null)},cancelActCb:()=>x(null)})},100)):(q=(I=N==null?void 0:N.response)==null?void 0:I.data)!=null&&q.resetCoupon&&setTimeout(()=>{x({msg:"Do not worry about coupon, we made it active again so you will be able to use again",confirmActMsg:"Get it",cancelActMsg:"_",confirmActCb:()=>x(null),cancelActCb:()=>x(null)})},100)}}),b=N=>{N.preventDefault();const C=e.getValues();let S=0,I=!0;do{if(ks[S].some($=>!$.reg.test(C[$.field]))){I=!1,c(S),e.trigger();break}S++}while(S<ks.length);if(I)h(C);else{const q=document.getElementById("swapFormOrders"),$=q==null?void 0:q.getBoundingClientRect();$&&setTimeout(()=>{window.scrollTo({top:$.top,behavior:"smooth"})},0)}},v=w||n;return!o||!d?null:s.jsxs("form",{onSubmit:b,className:"w-full grid gap-10 xl:grid-cols-2",children:[s.jsx(ru,{formContext:e,currForm:i,setCurrForm:c}),s.jsx(nu,{order:t,totStripe:a.amount,children:s.jsx("div",{className:"w-full max-w-[250px] mt-10",children:s.jsx(J,{label:"Order now",type:"submit",isDisabled:y(),isPending:v})})})]})};j();const iu=e=>{const t=["country","state","city","street","zipCode","phone"],a=[];let n=0;do e[t[n]]&&a.push(e[t[n]]),n++;while(n<t.length);return a},cu=e=>({icon:Zt,label:"User address",id:j(),vals:iu(e)}),ou={icon:or,label:"Items list",id:j()},du=(e,t)=>[{icon:cr,label:"User details",pairs:e.map(a=>({pair:a,id:j()}))},{icon:Zt,label:"User address",pairs:t.map(a=>({pair:a,id:j()}))}].map(a=>({...a,id:j()})),ze=Ue.slice(0,Ue.length-1).map(e=>{var t;return{field:e,label:((t=e.at(0))==null?void 0:t.toUpperCase())+e.slice(1),id:j()}}),uu=(...e)=>[{label:"Created at",val:ms(e[0])},{label:"Delivery time",val:Zs(e[1])},{label:"Est arrive",val:ms(new Date(new Date(e[0]).getTime()+e[1]*60*1e3).toISOString())}].map(t=>({...t,id:j()})),on=({order:e})=>s.jsx("div",{className:"w-full grid",children:s.jsx(ke,{el:ou,children:e.items.map(t=>s.jsxs("li",{className:`w-full grid grid-cols-2 sm:grid-cols-3\r
           items-center gap-y-3`,children:[s.jsx("img",{src:t.images[0].url,alt:"first image item",className:"w-[50px] h-[50px] object-cover rounded-xl"}),s.jsx("span",{className:"txt__01 justify-self-center",children:t.name}),s.jsxs("div",{className:"grid w-full grid-cols-2 col-span-2 sm:col-span-1",children:[s.jsxs("div",{className:"w-full flex items-center gap-5 justify-center",children:[s.jsx("span",{className:"txt__01",children:"x"}),s.jsx("span",{className:"txt__01",children:t.quantity})]}),s.jsx("span",{className:"txt__01 justify-self-center",children:js(t)})]})]},t._id))})}),mu=()=>{k();const{formContext:e,stripePromise:t,canStay:a,isPendingInfo:n,isErrorInfo:r,errorInfo:l,dataInfo:i}=au(),{order:c,backPaymentInt:o}=i??{};return s.jsx(X,{canStay:a,isError:r,error:l||"",isPending:n,children:!!(c!=null&&c.paymentClientSecret)&&!!t&&!!o&&s.jsx(dr,{stripe:t,options:{clientSecret:c.paymentClientSecret},children:s.jsxs("div",{className:"w-full grid justify-items-center place-content-center gap-6",children:[s.jsx("span",{className:"txt__04",children:"Checkout"}),s.jsx(on,{order:c}),s.jsx(re,{...e,children:s.jsx(lu,{formContext:e,order:c,backPaymentInt:o})})]})})})},pu=()=>{const{isLogged:e}=L();return e?s.jsx(xe,{}):s.jsx(G,{to:"/auth/login",replace:!0})},xu={icon:xr,label:"Items",id:j()},gu={icon:gr,label:"Amount",id:j()},fu=(...e)=>["Subtotal","Delivery","Discount","Total"].map((t,a,n)=>({label:t,val:a===n.length-1?e[0]+e[a-2]-e[a-1]:e[a],id:j()})),hu=(...e)=>[{label:"Created at",val:ms(e[0])},{label:"Delivery time",val:Zs(e[1])},{label:"Est arrive",val:ms(new Date(new Date(e[0]).getTime()+e[1]*60*1e3).toISOString())}].map(t=>({...t,id:j()})),yu={label:"Delivery",icon:Ye,id:j()};var H=(e=>(e.CHECKOUT="CHECKOUT",e.DELETE="DELETE",e.REFUND="REFUND",e.REFRESH="REFRESH",e.REVIEW="REVIEW",e))(H||{});const yt=[{label:"Checkout",icon:Yt,action:"CHECKOUT"},{label:"Delete",icon:ur,action:"DELETE"},{label:"Refund",icon:mr,action:"REFUND"},{label:"Refresh",icon:pr,action:"REFRESH"},{label:"Leave Review",icon:Pt,action:"REVIEW"}].map(e=>({...e,id:j()})),dn=({order:e,children:t,freshStatus:a})=>{var l;const n=A().pathname,r=a||e.status;return e?s.jsxs("div",{className:"w-full grid gap-3",children:[t,s.jsx(de,{el:xu,children:e.items.map(i=>s.jsxs("li",{className:"w-full grid grid-cols-[repeat(auto-fit,minmax(75px,1fr))] justify-items-center",children:[s.jsx("span",{className:"txt__01 max-w-full justify-self-start",children:i.name}),s.jsxs("div",{className:"flex items-center gap-1 justify-self-center",children:[s.jsx("span",{className:"txt__01",children:"x"}),s.jsx("span",{className:"txt__01",children:i.quantity})]}),s.jsx("span",{className:"txt__01 justify-self-end",children:js(i)})]},i._id))}),s.jsx(de,{el:gu,children:fu(e.totPrice,e.delivery,e.discount).map((i,c,o)=>i.label==="Discount"&&!o[c].val?null:s.jsxs("li",{className:"w-full flex justify-between items-center",children:[s.jsx("span",{className:"txt__01",children:i.label}),s.jsx("span",{className:"txt__01",children:Z({price:i.val,showStr:!0})})]},i.id))}),!["pending","delivered","cancelled"].includes(e.status)&&s.jsx(de,{el:yu,children:hu(e.timeConfirmed,e.restaurantId.delivery.estTimeDelivery).map(i=>s.jsxs("li",{className:"w-full grid grid-cols-[repeat(auto-fit,minmax(100px,1fr))]",children:[s.jsx("span",{className:"txt__01",children:i.label}),s.jsx("span",{className:"txt__01 justify-self-end",children:i.val})]},i.id))}),es.test(n)&&Object.values(e.addressUser).every(i=>!!i)&&s.jsx(de,{el:cu(e.addressUser)}),s.jsx("div",{className:"w-full grid grid-cols-2",children:s.jsxs("div",{className:"w-fit flex gap-5 justify-start items-center",children:[s.jsx(fr,{className:"min-w-[25px] min-h-[25px]"}),s.jsx("span",{className:"txt__01",children:((l=r==null?void 0:r.at(0))==null?void 0:l.toUpperCase())+(r==null?void 0:r.slice(1))})]})})]}):null},ds=({order:e,el:t,setFreshStatus:a})=>{const n=D(),r=Q(),{popup:l,setPopup:i}=Te(),{showToastMsg:c,handleErrAPI:o}=F(),d=t.action===H.DELETE,u=()=>{r.removeQueries({queryKey:["infoOrder"]}),n(`/my-orders/checkout?orderId=${e._id}`,{state:{from:`/search/${e._id}`}})},{mutate:p}=R({mutationFn:()=>(i({...l,isPending:!0}),d?Gd(e._id):zd(e._id)),onSuccess:()=>c(d?"Order deleted":"Refund successful","SUCCESS"),onError:b=>o({err:b}),onSettled:()=>{r.removeQueries({queryKey:["myOrdersSearch"]}),i(null)}}),m=()=>i({txt:t.action===H.DELETE?"delete this order ?":"ask refund for this order ?",greenLabel:"I change idea",redLabel:d?"Delete order":"Ask refund",confirmAction:()=>p(),isPending:!1}),{mutate:g,isPending:x}=R({mutationFn:()=>Yd(e._id),onSuccess:b=>a==null?void 0:a(b.status),onError:b=>o({err:b})}),y=()=>g(),_=()=>n(`/my-reviews/add/${e.restaurantId._id}`);let h="#ea580c",w=()=>null;return t.action===H.CHECKOUT?(h="#16a34a",w=u):t.action===H.DELETE||t.action===H.REFUND?(h="#dc2626",w=m):t.action===H.REFRESH?w=y:t.action===H.REVIEW&&(w=_),t.action===H.REFRESH&&x?s.jsx(_e,{}):s.jsxs("button",{onClick:w,className:"btn__order el__after_below_dynamic el__flow justify-self-center",style:{"--col-btn":h},children:[s.jsx(t.icon,{className:"icon__base"}),s.jsx("span",{className:"txt__02",children:t.label})]})},ju=({order:e})=>e.restaurantId?s.jsx("li",{className:"w-full grid",children:s.jsxs(W,{to:`/search/${e.restaurantId._id}`,className:"w-fit el__after_below el__flow cursor-pointer hover:text-orange-500 flex gap-5 justify-start items-center",children:[s.jsx(Xt,{className:"icon__base"}),s.jsx("span",{className:"txt__01",children:e.restaurantName})]})}):s.jsx("li",{className:"w-full grid",children:s.jsxs("div",{className:"w-fit flex gap-5 justify-start items-center",children:[s.jsx(Jt,{className:"icon__base text-red-600"}),s.jsxs("span",{className:"txt__01",children:[e.restaurantName," ( Activity closed )"]})]})}),_u=({order:e})=>{const[t,a]=f.useState(null);return f.useEffect(()=>{a(e.status)},[e.status]),s.jsxs("div",{className:"card__el border-orange-500 relative",children:[s.jsx(ws,{id:e._id}),e.isAdmin&&s.jsx(Ja,{path:`/manage-orders/${e._id}`}),s.jsxs("div",{className:"sm:grid grid-cols-2 place-items-center place-content-center",children:[s.jsx("div",{className:"flex w-full sm:w-[90%] sm:h-[90%] sm:py-3 items-center sm:border-2 border-orange-500 rounded-xl",children:s.jsx(rs,{images:e.items.map(n=>n.images[0])})}),s.jsx("div",{className:"w-full grid grid-cols-1 h-full",children:s.jsx("div",{className:"pt-3 w-full el__flow grid grid-cols-1 gap-3 items-start h-full px-3 sm:pr-2 sm:pl-0",children:s.jsx(dn,{order:e,freshStatus:t,children:s.jsx(ju,{order:e})})})})]}),s.jsx("div",{className:"w-full grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] px-3 mt-2 gap-y-4",children:(()=>{const n=[];let r=0;do{const l=yt[r];if(t==="pending"&&[H.CHECKOUT,H.DELETE].includes(l.action))n.push(s.jsx(ds,{el:l,order:e},l.id));else if(t==="confirmed"&&[H.REFRESH,H.REFUND].includes(l.action))n.push(s.jsx(ds,{el:l,order:e,setFreshStatus:a},l.id));else if(["processing","shipped"].includes(t??"")&&l.action===H.REFRESH)n.push(s.jsx(ds,{el:l,order:e,setFreshStatus:a},l.id));else if(t==="delivered"&&l.action===H.REVIEW&&!e.hasLeftReview)n.push(s.jsx(ds,{el:l,order:e},l.id));else{r++;continue}r++}while(r<yt.length);return n})()})]})},wu=()=>{k();const{formContextSearchMyOrders:e}=ue(),{watch:t}=e,a=t("searchVals"),n=t("search"),{handleSave:r,handleClear:l,propsBlock:i,data:c,isPending:o,isError:d,error:u,isSuccess:p,closeAllDrop:m,id:g}=Be({formCtx:e,key:"myOrdersSearch",cbAPI:Qd}),{totDocuments:x,nHits:y,orders:_,totPages:h}=c??{};return s.jsxs("div",{className:"w-full grid justify-items-center",children:[s.jsx(re,{...e,children:s.jsx(ls,{formContext:e,searchFields:Fa,filters:Jc,sorters:so,handleSave:r,handleClear:l,isPending:o,closeAllDrop:m,id:g})}),p&&s.jsx(is,{nHits:y,totDocuments:x,search:n,searchVal:a==null?void 0:a[0]}),s.jsx(X,{isPending:o,isError:d,error:u,children:s.jsx("div",{className:"w-full grid grid-cols-1 justify-items-center gap-10 mt-10 items-start",children:!!(_!=null&&_.length)&&_.map(w=>s.jsx(_u,{order:w},w._id))})}),s.jsx(qe,{...i,totPages:h})]})},bu=()=>{const{isLogged:e}=L();return e?s.jsx(xe,{}):s.jsx(G,{to:"/auth/login",replace:!0})},vu=e=>M(()=>E.get(`/manage-orders?${e}`)),Nu=e=>M(()=>E.get(`/manage-orders/${e}`)),Su=({orderId:e,status:t})=>M(()=>E.patch(`/manage-orders/${e}`,{status:t})),Cu=({order:e})=>{var n;const[t,a]=f.useState(!1);return e!=null&&e.restaurantId?s.jsxs(s.Fragment,{children:[s.jsx(Y,{isOpen:t,setIsOpen:a,txt:"Restaurant",Icon:xs,customStyle:"px-3 border-b-2 border-orange-500 py-1"}),s.jsxs("ul",{className:`w-full el__flow grid grid-cols-1 gap-4 px-3 ${t?"opacity-100 max-h-[500px] pointer-events-auto pt-3":"opacity-0 max-h-0 pointer-events-none"}`,children:[s.jsx("li",{className:"w-full grid",children:s.jsxs(W,{to:`/my-restaurants/${e.restaurantId._id}`,className:"w-fit el__after_below el__flow cursor-pointer hover:text-orange-500 flex gap-5 justify-start items-center",children:[s.jsx(Xt,{className:"icon__base"}),s.jsx("span",{className:"txt__01",children:e.restaurantName})]})}),s.jsxs("li",{className:"w-full grid grid-cols-[80px_1fr]",children:[s.jsxs("div",{className:"w-full flex gap-5 justify-start items-center",children:[s.jsx(B,{className:"icon__base"}),s.jsx("span",{className:"txt__01",children:"Id"})]}),s.jsx("div",{className:"flex w-full justify-start max-w-[95%]",children:s.jsx(ct,{txt:e.restaurantId._id,label:"Id"})})]}),s.jsx(de,{el:Xa(((n=e.restaurantId)==null?void 0:n.categories)??[])})]})]}):s.jsx("li",{className:"w-full grid px-3",children:s.jsxs("div",{className:"w-fit flex gap-5 justify-start items-center",children:[s.jsx(Jt,{className:"icon__base text-red-600 break-all"}),s.jsxs("span",{className:"txt__01",children:[e.restaurantName," ",s.jsx("span",{className:"txt__00",children:"( Activity closed )"})]})]})})},Eu=({order:e})=>{const t=D(),{formContextSearchMyOrders:a}=ue(),n=()=>{const{setValue:r}=a;r("searchVals",["id"]),r("search",e._id),t("/my-orders")};return s.jsxs("div",{className:"card__el_grid border-orange-500 relative",children:[e.isAdmin&&s.jsxs("button",{onClick:n,className:"absolute min-w-[150px] min-h-[50px] border-2 border-orange-500 rounded-xl bg-[#000] top-0 -translate-y-3/4 -right-6 z-20 flex gap-5 items-center px-3 pr-10 group cursor-pointer",children:[s.jsx(De,{className:"icon__base el__flow group-hover:text-orange-500"}),s.jsx("span",{className:"txt__02 el__flow group-hover:text-orange-500",children:"My order"})]}),s.jsxs("div",{className:"w-full flex flex-col",children:[s.jsx(ws,{id:e._id}),s.jsx(rs,{images:e.items.map(r=>r.images[0])}),s.jsx(Cu,{order:e}),s.jsx("div",{className:"px-3 mt-3",children:s.jsx(dn,{order:e})})]}),e.status!=="pending"&&(e==null?void 0:e.restaurantId)&&s.jsx(W,{to:`/manage-orders/${e._id}`,className:"btn__order el__after_below_dynamic el__flow justify-self-center mt-4",style:{"--col-btn":"#ea580c"},children:s.jsx("span",{className:"txt__02",children:"Info order"})})]})},Iu=()=>{k();const{formContextManageOrdersSearch:e}=ue(),{watch:t}=e,a=t("search"),n=t("searchVals"),{handleSave:r,handleClear:l,propsBlock:i,data:c,isPending:o,isError:d,error:u,isSuccess:p,closeAllDrop:m,id:g}=Be({formCtx:e,key:"manageOrdersSearch",cbAPI:vu,cbProcessForm:Ws}),{nHits:x,totPages:y,orders:_,totDocuments:h}=c??{};return s.jsxs("div",{className:"w-full grid justify-items-center",children:[s.jsx(re,{...e,children:s.jsx(ls,{formContext:e,searchFields:ka,filters:ao,sorters:no,closeAllDrop:m,isPending:o,handleClear:l,handleSave:r,id:g})}),p&&s.jsx(is,{nHits:x,totDocuments:h,search:a,searchVal:n==null?void 0:n[0]}),s.jsx(X,{isPending:o,isError:d,error:u,children:!!(_!=null&&_.length)&&s.jsx("div",{className:"container__cards__grid mt-10",children:_.map(w=>s.jsx(Eu,{order:w},w._id))})}),s.jsx(qe,{...i,totPages:y})]})},Pu=({order:e,isOrderOk:t})=>{const[a,n]=f.useState(25);return f.useEffect(()=>{if(!V(e)||["pending","cancelled"].includes(e==null?void 0:e.status))return;if(t){n(100);return}const r=setInterval(()=>{n(Ol(e))},1e3);return()=>clearInterval(r)},[t,e]),!["pending","cancelled"].includes(e.status)&&s.jsxs("div",{className:"w-full relative",children:[s.jsx("div",{className:"w-full absolute h-[30px] border-2 border-orange-500  rounded-full"}),s.jsx("div",{style:{left:`calc(${a}% - 45px)`},className:"absolute border-2 -top-[10px] h-[50px] w-[50px] rounded-full bg-[#111] border-orange-500 text-orange-500 z-60 flex justify-center items-center",children:t?s.jsx(hr,{className:"w-[50px] h-[50px]"}):s.jsx(yr,{className:"w-[50px] h-[50px]"})}),s.jsx("div",{className:"absolute rounded-full h-[30px] w-full flex justify-start items-center p-1",children:s.jsx("span",{style:{width:`${a}%`},className:`h-full rounded-full ${Ul(t,a)}`})})]})},Ps=(e,t,a)=>{const n=ze.findIndex(l=>l.field===(a?t.curr:t.prev)),r=ze.findIndex(l=>l.field===e);return{oldI:n,newI:r}},Ru=({order:e,setIsDelivered:t})=>{var w;const[a,n]=f.useState({prev:null,curr:e.status}),[r,l]=f.useState(!1),i=(w=pe())==null?void 0:w.orderId,{showToastMsg:c,handleErrAPI:o}=F(),{isPending:d,mutate:u}=R({mutationFn:({orderId:b,status:v})=>Su({orderId:b,status:v}),onError:b=>{o({err:b}),n(v=>({prev:null,curr:v.prev}))},onSuccess:()=>{a.curr==="delivered"&&t(!0),c("Status updated","SUCCESS")}}),p=f.useMemo(()=>ze.findIndex(b=>b.field===a.curr),[a.curr]),m=()=>{n(b=>({...b,prev:b.curr})),l(!0)},g=()=>{l(!1)},x=b=>{var S;b.preventDefault();const v=b.currentTarget.dataset.status,{oldI:N,newI:C}=Ps(v,a);((S=b.currentTarget.dataset)==null?void 0:S.status)!==a.prev&&C>N&&b.currentTarget.classList.add("el__drag_over")},y=b=>{b.currentTarget.classList.remove("el__drag_over")},_=b=>{const v=b.currentTarget.dataset.status;l(!1),b.currentTarget.classList.remove("el__drag_over");const{oldI:N,newI:C}=Ps(v,a);if(C<=N){n(S=>({prev:null,curr:S.prev}));return}n({prev:null,curr:v}),u({orderId:i,status:v})},h=b=>{const v=b.currentTarget.dataset.status,{oldI:N,newI:C}=Ps(v,a,!0);C>N&&(n({prev:null,curr:v}),u({orderId:i,status:v}))};return s.jsx("div",{className:"w-full grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-x-10 gap-y-5",children:ze.map((b,v)=>{const N=ze.findIndex(C=>C.field===a.curr);return v===N&&d?s.jsx(_e,{}):s.jsxs("div",{"data-status":b.field,onDragOver:x,onDragLeave:y,onDrop:_,onClick:C=>window.innerWidth<768?h(C):null,className:"border-2 border-[#333] cursor-pointer md:cursor-default rounded-xl px-6 py-2 flex justify-center items-center relative el__flow",children:[v===p&&s.jsx("div",{draggable:!0,onDragStart:m,onDragEnd:g,className:`bg-[#111] border-2 border-orange-500 text-orange-500 rounded-xl p-2 el__flow hover:scale-110 cursor-pointer w-fit h-fit flex justify-center items-center right-0 bottom-1/2 absolute ${r?"opacity-50":"opacity-100"}`,children:s.jsx(kt,{className:"min-w-[35px] min-h-[35px] "})}),s.jsx("span",{className:"txt__02",children:b.label})]},b.id)})})},Au=()=>{var _;const[e,t]=f.useState(!1),a=(_=pe())==null?void 0:_.orderId,[n,r]=f.useState(0),[l,i]=f.useState(!1),c=z.test(a??"");k();const{handleErrAPI:o}=F(),{data:d,isPending:u,isSuccess:p,isError:m,error:g}=ne({queryKey:["manageSingleOrder"],queryFn:()=>Nu(a??""),enabled:c});f.useEffect(()=>{m&&o({err:g})},[m,g,p,d,o]);const{order:x}=d??{};f.useEffect(()=>{let h;if(!x||(x==null?void 0:x.status)==="delivered"||e){r(null);return}else h=setInterval(()=>{r($l(x==null?void 0:x.timeConfirmed,(x==null?void 0:x.restaurantId).delivery.estTimeDelivery))},1e3);return()=>clearInterval(h)},[x,e]),f.useEffect(()=>{const h=setTimeout(()=>{i(!0)},2e3);return()=>clearTimeout(h)},[]);const y=(x==null?void 0:x.status)==="delivered"||e;return s.jsx(X,{isPending:u,isError:m,error:g,canStay:c,children:x&&V(x)&&s.jsxs("div",{className:"w-full grid justify-items-center gap-6",children:[s.jsx("span",{className:"txt__04",children:x.restaurantName}),s.jsx(on,{order:x}),s.jsx("div",{className:"w-full grid grid-rows-1 gap-x-10 gap-y-5 items-start md:grid-cols-2",children:du(Object.entries(x.infoUser),Object.entries(x.addressUser)).map(h=>s.jsx(ke,{el:h,children:h.pairs.map(w=>s.jsxs("li",{className:"w-full grid grid-cols-[75px_1fr] gap-5",children:[s.jsx("span",{className:"txt__01",children:w.pair[0]}),s.jsx("span",{className:"txt__01 justify-self-end block overflow-x-scroll hide_scrollbar max-w-full",children:w.pair[1]})]},w.id))}))}),s.jsx("div",{className:"w-full",children:s.jsx(cn,{order:x,totOrder:Ql(x)})}),s.jsxs("ul",{className:"w-full grid items-center gap-2",children:[uu(x.timeConfirmed,x.restaurantId.delivery.estTimeDelivery).map(h=>y?null:s.jsxs("li",{className:"w-full grid grid-cols-2 items-center",children:[s.jsx("span",{className:"txt__01",children:h.label}),s.jsx("span",{className:"txt__01 justify-self-end sm:justify-self-center",children:h.val})]},h.id)),y||(n??-1)<0?null:s.jsxs("li",{className:`w-full grid grid-cols-2 items-center el__flow ${l?"opacity-100 max-h-[300px]":"opacity-0 max-h-0"}`,children:[s.jsxs("div",{className:"w-full flex items-center gap-5",children:[s.jsx(Gt,{className:"min-h-[40px] min-w-[40px] text-red-600"}),s.jsx("span",{className:"txt__02 text-red-600",children:"Delay"})]}),s.jsx("span",{className:"txt__01 justify-self-end sm:justify-self-center border-b-[3px] text-red-600 pb-1 border-red-600",children:n})]})]}),!l&&s.jsx(_e,{}),s.jsx("div",{className:`w-full grid h-[50px] el__flow ${l?"scale-100 max-h-[300px]":"scale-0 max-h-0"}`,children:s.jsx(Pu,{order:x,isOrderOk:y})}),!["cancelled","delivered"].includes(x.status)&&s.jsx(Ru,{order:x,setIsDelivered:t})]})})},Du=()=>{const{isLogged:e}=L();return e?s.jsx(xe,{}):s.jsx(G,{to:"/auth/login",replace:!0})},Tu=()=>s.jsx("div",{children:"MyReviews"}),un=({key:e,enabled:t,cbAPI:a,cbSuccess:n,alias:r})=>{const{handleErrAPI:l}=je(),{isPending:i,isError:c,error:o,isSuccess:d,data:u}=ne({queryKey:[e],enabled:t??!0,queryFn:a});f.useEffect(()=>{c&&l({err:o}),d&&n(u)},[i,c,o,d,u,l,n]);const p=m=>{var g;return r?m+((g=r==null?void 0:r.at(0))==null?void 0:g.toUpperCase())+(r==null?void 0:r.slice(1)):m};return{[p("data")]:u,[p("isPending")]:i,[p("isError")]:c,[p("error")]:o,[p("isSuccess")]:d}},Fu=e=>M(()=>E.get(`/my-reviews/rest-info/${e}`)),Mu=({restId:e,formData:t})=>M(()=>E.post(`/my-reviews/${e}`,t)),ku=e=>M(()=>E.get(`/my-reviews/${e}`)),Lu=({revId:e,formData:t})=>M(()=>E.put(`/my-reviews/${e}`,t)),mn=({rest:e})=>{var t;return s.jsxs("div",{className:"min-w-full grid p-6 border-[3px] rounded-xl border-orange-500 justify-items-center gap-4",children:[s.jsx("div",{className:"w-full flex items-center justify-center gap-5",children:Array.from({length:5}).map((a,n)=>n+1<=e.avgRating?s.jsx($s,{className:"text-orange-500 min-w-[40px] min-h-[40px]"}):n+.5<=e.avgRating?s.jsx(jr,{className:"text-orange-500 min-w-[40px] min-h-[40px]"}):s.jsx(Ae,{className:"text-orange-500 min-w-[40px] min-h-[40px]"}))}),s.jsxs("div",{className:"w-full grid items-center grid-cols-2",children:[s.jsxs("div",{className:"w-full flex items-center gap-5",children:[s.jsx("span",{className:"txt__01",children:"Avg rating:"}),s.jsx("span",{className:"txt__02",children:e.avgRating})]}),s.jsxs("span",{className:"txt__01 justify-self-end",children:["Reviews (",(t=e.reviews)==null?void 0:t.length,")"]})]})]})},Ou=({formContext:e})=>{var u;const[t,a]=f.useState(0),n=f.useRef(!1),{formState:{errors:r},watch:l,setValue:i,setError:c,clearErrors:o}=e,d=l("rating");return f.useEffect(()=>{const p=m=>{const g=document.getElementsByClassName("star__rev");let x=g.length-1;do{const y=g[x];if(y.contains(m.target)){y.classList.remove("register__checkbox"),requestAnimationFrame(()=>{y.classList.add("register__checkbox")});break}x--}while(x>=0)};return document.addEventListener("click",p),()=>{document.removeEventListener("click",p)}},[]),f.useEffect(()=>{const p=l(m=>{m.rating===0?c("rating",{message:"Rating is required if you want to leave a review"}):o("rating")});return()=>p.unsubscribe()},[l,c,o]),s.jsxs("div",{className:"w-full grid justify-items-center gap-3",children:[s.jsx("span",{className:"txt__03 justify-self-start",children:"Rating"}),s.jsx("div",{className:"w-full flex items-center justify-center gap-3",children:Array.from({length:5}).map((p,m)=>s.jsx("label",{onMouseOver:()=>a(m+1),onMouseLeave:()=>{n.current=!1,a(d)},onClick:()=>{d===m+1&&(n.current=!0),i("rating",m===d-1?m:m+1,{shouldValidate:!0})},className:"w-fit flex items-center justify-center cursor-pointer el__flow star__rev",children:(n.current?d:Math.max(t,d))>=m+1?s.jsx($s,{className:"text-orange-500 min-w-[40px] min-h-[40px]"}):s.jsx(Ae,{className:"text-orange-500 min-w-[40px] min-h-[40px]"})},m))}),((u=r==null?void 0:r.rating)==null?void 0:u.message)&&s.jsx("span",{className:"txt__01 text-red-600 justify-self-start",children:r.rating.message})]})},Uu={field:"title",label:"Title",required:!0,reg:Tl,id:j(),msg:"Title must have at least 4 chars"},$u=({formContext:e})=>{var c;const[t,a]=f.useState(!1),[n,r]=f.useState({startY:0,startTop:0}),{register:l,formState:{errors:i}}=e;return f.useEffect(()=>{const o=d=>{if(!t)return;const u=document.getElementById("textAreaId"),p=document.getElementById("txtThumb"),m=d.clientY-n.startY,g=Math.min(Math.max(0,n.startTop+m),((u==null?void 0:u.clientHeight)??0)-((p==null?void 0:p.offsetHeight)??0));p.style.top=`${g}px`;const x=g/(((u==null?void 0:u.clientHeight)??0)-((p==null?void 0:p.offsetHeight)??0));u.scrollTop=x*((u==null?void 0:u.scrollHeight)??0)-((u==null?void 0:u.clientHeight)??0)};return document.addEventListener("mousemove",o),()=>document.removeEventListener("mousemove",o)},[t,n]),f.useEffect(()=>{const o=()=>{a(!1),document.body.style.userSelect="auto"};return document.addEventListener("mouseup",o),()=>document.removeEventListener("mouseup",o)},[]),s.jsxs("div",{className:"w-full grid gap-3 ",children:[s.jsx("span",{className:"txt__03",children:"Comment (optional)"}),s.jsxs("div",{className:"relative w-full h-fit",children:[s.jsx("textarea",{className:"w-full border-2 border-orange-500 rounded-xl p-3 focus__base outline-0 hide_scrollbar pr-[20px] h-fit",rows:4,id:"textAreaId",...l("comment",{required:!1,pattern:{value:Fl,message:"Message must have at least 10 chars and at most 1000"}}),onScroll:o=>{const d=o.currentTarget,u=document.getElementById("txtThumb"),m=d.scrollTop/(d.scrollHeight-d.clientHeight)*(d.clientHeight-(u==null?void 0:u.offsetHeight)+5);u.style.top=`${m}px`}}),s.jsx("div",{className:"absolute top-0 right-0 w-[15px] rounded-full bg-orange-500 h-[95%]",children:s.jsx("div",{onMouseDown:o=>{a(!0),r({startY:o.clientY,startTop:o.currentTarget.offsetTop}),document.body.style.userSelect="none"},className:"bg-black w-full rounded-full absolute top-0 z-60 h-[50px] right-0 cursor-pointer",id:"txtThumb"})})]}),((c=i==null?void 0:i.comment)==null?void 0:c.message)&&s.jsx("span",{className:"txt__01 text-red-600",children:i.comment.message})]})},pn=({formContext:e,isPending:t,handleSave:a})=>{var d;const n=A().pathname,{register:r,formState:{errors:l},watch:i,setValue:c}=e,o=((d=i("images"))==null?void 0:d[0])instanceof File?[...i("images")]:i("images");return s.jsxs("form",{onSubmit:a,className:"w-full grid mt-10 gap-6",children:[s.jsx(Ou,{formContext:e}),s.jsxs("div",{className:"w-full grid gap-3 md:max-w-1/2",children:[s.jsx("span",{className:"txt__03",children:"Title of review"}),s.jsx(ie,{register:r,errors:l,field:Uu})]}),s.jsx($u,{formContext:e}),s.jsxs("div",{className:"w-full grid gap-3",children:[s.jsx("span",{className:"txt__03",children:"Images (optional)"}),!!(o!=null&&o.length)&&s.jsx("div",{className:"w-full flex gap-5 overflow-x-scroll hide_scrollbar border-2 border-orange-500 rounded-xl p-3",children:o.map((u,p)=>s.jsx(lt,{images:o,img:u,setValue:c},p))}),s.jsx(it,{register:r,watch:i}),(l==null?void 0:l.images)&&s.jsx("span",{className:"text-red-500",children:l.images.message})]}),s.jsx("div",{className:"w-[250px] justify-self-center mt-10",children:s.jsx(J,{label:`${n.includes("put")?"Update":"Leave"} review`,isPending:t,type:"submit"})})]})},Vu=()=>{var _;const e=(_=pe())==null?void 0:_.restId,t=D(),a=z.test(e??""),n=Q();k();const{showToastMsg:r,handleErrAPI:l}=F(),i=f.useCallback(h=>{},[]),{isPendingRest:c,isErrorRest:o,errorRest:d,dataRest:u}=un({cbAPI:()=>Fu(e??""),enabled:a,alias:"rest",key:"restInfoRev",cbSuccess:i}),{restaurant:p}=u??{},m=U({mode:"onChange"}),{mutate:g,isPending:x}=R({mutationFn:h=>Mu({restId:e??"",formData:h}),onSuccess:h=>{n.removeQueries({queryKey:["restInfoRev"]}),r("Review created","SUCCESS"),t(`/my-reviews/put/${h.revId}`)},onError:h=>l({err:h})}),y=m.handleSubmit(h=>{const{formData:w}=oa(h);g(w)});return s.jsx(X,{isPending:!1,isError:o,error:d,canStay:a,children:s.jsxs(s.Fragment,{children:[c?s.jsx("div",{className:"mt-20",children:s.jsx(_e,{})}):V(p)&&s.jsxs("div",{className:"w-full grid gap-8 justify-items-center",children:[s.jsx("span",{className:"txt__04",children:p.name}),s.jsx(mn,{rest:p})]}),s.jsx(re,{...m,children:s.jsx(pn,{formContext:m,handleSave:y,isPending:x})})]})})},qu=()=>{var y;const e=(y=pe())==null?void 0:y.revId,t=z.test(e??""),a=U({mode:"onChange"}),n=Q(),r=f.useCallback(_=>{const{setValue:h}=a;h("title",_.review.title),h("comment",_.review.comment),h("rating",_.review.rating),h("images",_.review.images)},[a]),{showToastMsg:l,handleErrAPI:i}=F(),{mutate:c,isPending:o}=R({mutationFn:_=>Lu({revId:e,formData:_}),onSuccess:()=>{l("Review updated","SUCCESS"),setTimeout(()=>{window.scroll({top:0,behavior:"smooth"})},250)},onError:_=>i({err:_}),onSettled:()=>n.removeQueries({queryKey:["infoRev"]})}),d=a.handleSubmit(_=>{const{formData:h}=oa(_);c(h)});k();const{isPendingRev:u,isErrorRev:p,errorRev:m,dataRev:g}=un({cbAPI:()=>ku(e??""),enabled:t,alias:"rev",key:"infoRev",cbSuccess:r}),{review:x}=g??{};return s.jsx(X,{canStay:t,isPending:u,isError:p,error:m,children:V(x)&&s.jsxs("div",{className:"w-full grid gap-8 justify-items-center",children:[s.jsx("span",{className:"txt__04",children:x.restaurant.name}),s.jsx(mn,{rest:x.restaurant}),s.jsx(re,{...a,children:s.jsx(pn,{formContext:a,handleSave:d,isPending:o})})]})})},Bu=()=>(wo(),s.jsxs(_r,{children:[s.jsxs(P,{path:"/",element:s.jsx(Vo,{}),children:[s.jsx(P,{index:!0,element:s.jsx(Ar,{})}),s.jsxs(P,{path:"auth",element:s.jsx(qo,{}),children:[s.jsx(P,{path:"login",element:s.jsx(Oi,{})}),s.jsx(P,{path:"register",element:s.jsx(qi,{})}),s.jsx(P,{path:"send-email",element:s.jsx(Gi,{})}),s.jsx(P,{path:"verify",element:s.jsx(Ki,{})}),s.jsx(P,{path:"recover-pwd",element:s.jsx(Zi,{})})]}),s.jsxs(P,{path:"user",element:s.jsx(Bo,{}),children:[s.jsx(P,{path:"profile",element:s.jsx(mc,{})}),s.jsx(P,{path:"manage-account",element:s.jsx(Ic,{})})]}),s.jsx(P,{path:"verify-new-email",element:s.jsx(Rc,{})}),s.jsx(P,{path:"notice-email",element:s.jsx(Tr,{})}),s.jsx(P,{path:"notice",element:s.jsx(su,{})}),s.jsxs(P,{path:"newsletter",element:s.jsx(Qo,{}),children:[s.jsx(P,{path:"verify-unsubscribe",element:s.jsx(xc,{})}),s.jsx(P,{path:"notice-unsubscribe-with-retry",element:s.jsx(fc,{})})]}),s.jsxs(P,{path:"my-restaurants",element:s.jsx(Go,{}),children:[s.jsx(P,{index:!0,element:s.jsx(xo,{})}),s.jsx(P,{path:":restId",element:s.jsx(Ho,{})}),s.jsx(P,{path:"add-restaurant",element:s.jsx(qc,{})}),s.jsx(P,{path:"update/:restId",element:s.jsx(fo,{})})]}),s.jsxs(P,{path:"my-dishes",element:s.jsx(Ko,{}),children:[s.jsx(P,{index:!0,element:s.jsx(jd,{})}),s.jsx(P,{path:"add-dish",element:s.jsx(gd,{})}),s.jsx(P,{path:"update/:dishId",element:s.jsx(wd,{})})]}),s.jsxs(P,{path:"manage-orders",element:s.jsx(bu,{}),children:[s.jsx(P,{index:!0,element:s.jsx(Iu,{})}),s.jsx(P,{path:":orderId",element:s.jsx(Au,{})})]}),s.jsxs(P,{path:"search",element:s.jsx(bd,{}),children:[s.jsx(P,{index:!0,element:s.jsx(Td,{})}),s.jsx(P,{path:":restId",element:s.jsx(eu,{})})]}),s.jsxs(P,{path:"my-orders",element:s.jsx(pu,{}),children:[s.jsx(P,{index:!0,element:s.jsx(wu,{})}),s.jsx(P,{path:"checkout",element:s.jsx(mu,{})})]}),s.jsxs(P,{path:"my-reviews",element:s.jsx(Du,{}),children:[s.jsx(P,{index:!0,element:s.jsx(Tu,{})}),s.jsx(P,{path:"add/:restId",element:s.jsx(Vu,{})}),s.jsx(P,{path:"put/:revId",element:s.jsx(qu,{})})]})]}),s.jsx(P,{path:"*",element:s.jsx(G,{to:"/",replace:!0})})]}));var Ns=(e=>(e.SET_CART="SET_CART",e))(Ns||{}),K=(e=>(e.SET_CART_NON_LOGGED="SET_CART_NON_LOGGED",e.INC_QTY_NON_LOGGED="ADD_CART_NON_LOGGED",e.DEC_QTY_NON_LOGGED="DEQ_QTY_NON_LOGGED",e.DEL_ITEM_NON_LOGGED="DEL_ITEM_NON_LOGGED",e.UPDATE_QTY_BY_INPUT="UPDATE_QTY_BY_INPUT",e.UPDATE_QTY_BY_INT="UPDATE_QTY_BY_INT",e.CHANGE_REST="CHANGE_REST",e))(K||{});const Ze=e=>{if(e===null||typeof e!="object")return e;if(Array.isArray(e))return e.map(a=>Ze(a));const t={};for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=Ze(e[a]));return t},Qe=e=>{const t={...e,...Qu(e)};return localStorage.setItem("cartNonLogged",JSON.stringify(t)),{merged:t}},Qu=e=>{let t=0,a=0;if(!(e!=null&&e.items))return{totQty:t,totPrice:a};const n=[...e.items];let r=0;do t+=n[r].quantity,a+=n[r].price*n[r].quantity,r++;while(r<n.length);return{totQty:t,totPrice:+a.toFixed(2)}},Gu=(e,t)=>{const{dish:a,restId:n}=t.payload;if(!V(a)||!n)throw new Error("Miss data "+t.type);let r=null;!e.cartNonLogged||!V(e.cartNonLogged)?r={restaurant:n,items:[{dishId:a._id,name:a.name,price:a.price,quantity:1}]}:r=Ir(e.cartNonLogged,i=>{const c=i.items.findIndex(o=>o.dishId===a._id);c!==-1?i.items[c].quantity++:i.items.push({dishId:a._id,name:a.name,price:a.price,quantity:1})});const{merged:l}=Qe(r);return{...e,cartNonLogged:l}},zu=(e,t)=>{const{dish:a}=t.payload;if(!a||!V(a))throw new Error("Miss data "+t.type);if(!e.cartNonLogged)return e;const n=Er.cloneDeep(e.cartNonLogged),r=n.items.findIndex(i=>i.dishId===a._id);if(r===-1)return e;n.items[r].quantity<=1?n.items=n.items.filter((i,c)=>c!==r):n.items=n.items.map((i,c)=>c===r?{...i,quantity:i.quantity-1}:i);const{merged:l}=Qe(n);return{...e,cartNonLogged:l}},Yu=(e,t)=>{const{dish:a}=t.payload;if(!a||!V(a))throw new Error("Miss data "+t.type);if(!e.cartNonLogged||!V(e.cartNonLogged))return e;const n=Ze(e.cartNonLogged),r=n.items.findIndex(i=>i.dishId===(a.dishId??a._id));if(r===-1)return e;n.items=n.items.filter((i,c)=>c!==r);let l=null;return n.items.length?l=Qe(n).merged:(l=null,localStorage.removeItem("cartNonLogged")),{...e,cartNonLogged:l}},Hu=(e,t)=>{const{dishId:a,quantity:n}=t.payload;if(!a||!n)throw new Error("Miss data "+t.payload);if(!e.cartNonLogged||!V(e.cartNonLogged))return e;const r=e.cartNonLogged.items.findIndex(c=>c.dishId===a);if(r===-1)return e;const l=Ze(e.cartNonLogged);l.items=l.items.map((c,o)=>o===r?{...c,quantity:+n}:c);const{merged:i}=Qe(l);return{...e,cartNonLogged:i}},Ku=(e,t)=>{const{restId:a,dish:n,quantity:r}=t.payload;if(!a||!+r||!V(n))throw new Error("Miss data "+t.type);let l=null;const i={name:n.name,price:n.price,quantity:+r,dishId:n._id};if(!e.cartNonLogged)l={restaurant:a,items:[i]};else{l=Ze(e.cartNonLogged);const o=l.items.findIndex(d=>d.dishId===n._id);o!==-1?l.items=l.items.map((d,u)=>u===o?{...d,quantity:+r}:d):l.items=[...l.items,i]}const{merged:c}=Qe(l);return{...e,cartNonLogged:c}},Wu=(e,t)=>{const{dish:a,restId:n}=t.payload;if(!V(a)||!n)throw new Error("Miss data "+t.type);if(!e.cartNonLogged)return e;const r={restaurant:n,items:[{name:a.name,price:a.price,quantity:1,dishId:a._id}]},{merged:l}=Qe(r);return{...e,cartNonLogged:l}},Zu=(e,t)=>{switch(t.type){case Ns.SET_CART:return{...e,cart:t.payload.cart};case K.SET_CART_NON_LOGGED:{const{cart:a}=t.payload;return V(a)?{...e,cartNonLogged:t.payload.cart}:(localStorage.removeItem("cartNonLogged"),{...e,cartNonLogged:null})}case K.INC_QTY_NON_LOGGED:return Gu(e,t);case K.DEC_QTY_NON_LOGGED:return zu(e,t);case K.DEL_ITEM_NON_LOGGED:return Yu(e,t);case K.UPDATE_QTY_BY_INPUT:return Hu(e,t);case K.UPDATE_QTY_BY_INT:return Ku(e,t);case K.CHANGE_REST:return Wu(e,t);default:return e}},xn="SET_IS_POPUP",gn={popup:null},Xu=(e,t)=>{switch(t.type){case xn:{const a=t.payload;return a?{popup:a}:gn}default:return e}},Ge="SET_IS_TOAST",Ju=(e,t)=>{const{isToast:a,msg:n,type:r}=t.payload;if(!a)return{...e,isToast:a};if(a&&[n,r].some(l=>!l))throw new Error("Missing fields "+t.type);return{...e,isToast:a,msg:n??"",type:r??"SUCCESS"}},em=(e,t)=>{switch(t.type){case Ge:return Ju(e,t);default:return e}},Ls="SET_IS_LOGGED",Os="SET_CURR_USER",Us="SET_CAN_MANAGE_ACCOUNT",sm=(e,t)=>{switch(t.type){case Ls:return{...e,isLogged:t.payload};case Os:return{...e,currUser:t.payload};case Us:return{...e,canManageAccount:t.payload};default:return e}},tm=(e,t)=>({toastState:em(e.toastState,t),userState:sm(e.userState,t),popupState:Xu(e.popupState,t),cartState:Zu(e.cartState,t)}),jt=localStorage.getItem("cartNonLogged"),am={cart:null,cartNonLogged:jt?JSON.parse(jt):null},nm={isToast:!1,msg:"",type:"SUCCESS"},rm={currUser:null,isLogged:!!sessionStorage.getItem("accessToken"),canManageAccount:!!sessionStorage.getItem("manageAccountToken")},lm={toastState:nm,userState:rm,popupState:gn,cartState:am},im=(e,t)=>{const a=f.useRef(!1),n=f.useRef(!1),r=()=>{n.current=!1,t({type:Ge,payload:{isToast:!1}})},l=f.useCallback((i,c)=>{a.current=!1,n?(t({type:Ge,payload:{isToast:!1}}),setTimeout(()=>{t({type:Ge,payload:{isToast:!0,msg:i,type:c}})},100)):(n.current=!0,t({type:Ge,payload:{isToast:!0,msg:i,type:c}}))},[t,n]);return{closeToast:r,showToastMsg:l,clicked:a,wasToast:n,...e}},_t=["myRestaurantsSearch","myDishesSearch","searchAllUsersRest","accessToken","manageAccountToken","initName"],cm=(e,t)=>{const a=Q(),n=f.useCallback(()=>{let c=0;do sessionStorage.removeItem(_t[c]),c++;while(c<_t.length);t({type:Ls,payload:!1}),t({type:Os,payload:null}),t({type:Us,payload:!1}),t({type:Ns.SET_CART,payload:{cart:null}}),a.cancelQueries(),a.clear()},[t,a]),r=f.useCallback(c=>{c?(sessionStorage.setItem("accessToken",c),t({type:Ls,payload:!0}),a.cancelQueries(),a.clear()):n()},[t,n,a]),l=f.useCallback(({user:c})=>{c?sessionStorage.getItem("initName")||sessionStorage.setItem("initName",Ll(c)):sessionStorage.removeItem("initName"),t({type:Os,payload:c})},[t]),i=f.useCallback(c=>{c?sessionStorage.setItem("manageAccountToken",c):sessionStorage.removeItem("manageAccountToken"),t({type:Us,payload:!!c})},[t]);return{...e,setCurrUser:l,setUserLogged:r,setCanManageAccount:i,logoutUser:n}},om=(e,t)=>({setPopup:f.useCallback(n=>t({type:xn,payload:n}),[t]),...e}),dm=()=>{const e=sessionStorage.getItem("myRestaurantsSearch"),t=U({mode:"onChange",defaultValues:e?{...JSON.parse(e)}:{searchVals:["name"]}}),a=U({mode:"onChange",defaultValues:{restaurant:"",items:[{name:"",quantity:"",price:"",images:[]}]}}),n=U({mode:"onChange"}),r=sessionStorage.getItem("myDishesSearch"),l=U({mode:"onChange",defaultValues:r?{...JSON.parse(r)}:{searchVals:["name"]}}),i=sessionStorage.getItem("searchAllUsersRest"),c=U({mode:"onChange",defaultValues:i?{...JSON.parse(i)}:{searchVals:["name"]}}),o=U({mode:"onChange",defaultValues:{...Ta}}),d=sessionStorage.getItem("myOrdersSearch"),u=U({mode:"onChange",defaultValues:d?{...JSON.parse(d)}:Ma}),p=sessionStorage.getItem("manageOrdersSearch"),m=U({mode:"onChange",defaultValues:p?{...JSON.parse(p)}:{...La}});return{formContextMyRestaurants:t,formContextMyDishesAddItem:a,formContextMyDishesSearch:l,formContextMyDishesUpdate:n,formContextSearchRestAllUsers:c,formContextSearchDishesAllUSers:o,formContextSearchMyOrders:u,formContextManageOrdersSearch:m}},um=()=>{const[e,t]=f.useState(!1);return{isOpenSide:e,setIsOpenSide:t}},mm=(e,t)=>{const a=f.useCallback(d=>{t({type:Ns.SET_CART,payload:{cart:d}})},[t]),n=f.useCallback(d=>t({type:K.SET_CART_NON_LOGGED,payload:{cart:d}}),[t]),r=d=>{switch(d){case"inc":return K.INC_QTY_NON_LOGGED;case"dec":return K.DEC_QTY_NON_LOGGED;case"del-item":return K.DEL_ITEM_NON_LOGGED}};return{setCartLogged:a,setCartNonLogged:n,handleClickCartNonLogged:({action:d,dish:u,restId:p})=>t({type:r(d),payload:{restId:p,dish:u}}),handleUpdateByInput:({dishId:d,quantity:u})=>t({type:K.UPDATE_QTY_BY_INPUT,payload:{quantity:u,dishId:d}}),handleUpdateByInt:({dish:d,restId:u,quantity:p})=>t({type:K.UPDATE_QTY_BY_INT,payload:{dish:d,quantity:p,restId:u}}),changeRest:({dish:d,restId:u})=>t({type:K.CHANGE_REST,payload:{dish:d,restId:u}}),...e}},pm=()=>{const[e,t]=f.useState(null);return{notice:e,setNotice:t}},xm=()=>{const[e,t]=f.useState(null);return{infoPop:e,setInfoPop:t}},gm=()=>{const[e,t]=f.useReducer(tm,lm),a=im(e.toastState,t),n=cm(e.userState,t),r=om(e.popupState,t),l=um(),i=mm(e.cartState,t),c=pm(),o=xm(),d=dm(),u=Pr("pk_test_51QgpAp061CxjZlFAdqwshK5pV2PSFIKTWkHG0bpxUWxgyYzVrB6AfBXhIR1chotiBgAKYXL4rgzQvO9VOhu0aupl00dqTtuIHc");return{toastState:{...a},userState:{...n},popupState:{...r},sideState:{...l},cartState:{...i},noticeState:{...c},infoPopState:{...o},stripePromise:u,formsState:{...d}}},fm=({children:e})=>s.jsx(ea.Provider,{value:{...gm()},children:e}),hm=new Rr({defaultOptions:{queries:{retry:!1,refetchOnWindowFocus:!1},mutations:{retry:!1}}});wr.createRoot(document.getElementById("root")).render(s.jsx(br,{children:s.jsx(vr,{client:hm,children:s.jsx(fm,{children:s.jsx(Bu,{})})})}));
